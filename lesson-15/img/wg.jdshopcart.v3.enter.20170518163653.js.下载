define("zepto",function(require,exports,t){var _cacheThisModule_;var e=function(){var t,e,n,i,r=[],o=r.concat,a=r.filter,s=r.slice,u=window.document,f={},c={},l={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},h=/^\s*<(\w+|!)[^>]*>/,p=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,d=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,m=/^(?:body|html)$/i,v=/([A-Z])/g,g=["val","css","html","text","data","width","height","offset"],y=["after","prepend","before","append"],b=u.createElement("table"),w=u.createElement("tr"),x={tr:u.createElement("tbody"),tbody:b,thead:b,tfoot:b,td:w,th:w,"*":u.createElement("div")},E=/complete|loaded|interactive/,T=/^[\w-]*$/,S={},j=S.toString,C={},O,N,A=u.createElement("div"),P={tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},M=Array.isArray||function(t){return t instanceof Array};C.matches=function(t,e){if(!e||!t||t.nodeType!==1)return false;var n=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.oMatchesSelector||t.matchesSelector;if(n)return n.call(t,e);var i,r=t.parentNode,o=!r;if(o)(r=A).appendChild(t);i=~C.qsa(r,e).indexOf(t);o&&A.removeChild(t);return i};function D(t){return t==null?String(t):S[j.call(t)]||"object"}function k(t){return D(t)=="function"}function F(t){return t!=null&&t==t.window}function L(t){return t!=null&&t.nodeType==t.DOCUMENT_NODE}function $(t){return D(t)=="object"}function R(t){return $(t)&&!F(t)&&Object.getPrototypeOf(t)==Object.prototype}function _(t){var e=!!t&&"length"in t&&t.length,i=n.type(t);return"function"!=i&&!F(t)&&("array"==i||e===0||typeof e=="number"&&e>0&&e-1 in t)}function q(t){return a.call(t,function(t){return t!=null})}function z(t){return t.length>0?n.fn.concat.apply([],t):t}O=function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})};function I(t){return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}N=function(t){return a.call(t,function(e,n){return t.indexOf(e)==n})};function W(t){return t in c?c[t]:c[t]=new RegExp("(^|\\s)"+t+"(\\s|$)")}function Z(t,e){return typeof e=="number"&&!l[I(t)]?e+"px":e}function B(t){var e,n;if(!f[t]){e=u.createElement(t);u.body.appendChild(e);n=getComputedStyle(e,"").getPropertyValue("display");e.parentNode.removeChild(e);n=="none"&&(n="block");f[t]=n}return f[t]}function V(t){return"children"in t?s.call(t.children):n.map(t.childNodes,function(t){if(t.nodeType==1)return t})}function H(t,e){var n,i=t?t.length:0;for(n=0;n<i;n++)this[n]=t[n];this.length=i;this.selector=e||""}C.fragment=function(e,i,r){var o,a,f;if(p.test(e))o=n(u.createElement(RegExp.$1));if(!o){if(e.replace)e=e.replace(d,"<$1></$2>");if(i===t)i=h.test(e)&&RegExp.$1;if(!(i in x))i="*";f=x[i];f.innerHTML=""+e;o=n.each(s.call(f.childNodes),function(){f.removeChild(this)})}if(R(r)){a=n(o);n.each(r,function(t,e){if(g.indexOf(t)>-1)a[t](e);else a.attr(t,e)})}return o};C.Z=function(t,e){return new H(t,e)};C.isZ=function(t){return t instanceof C.Z};C.init=function(e,i){var r;if(!e)return C.Z();else if(typeof e=="string"){e=e.trim();if(e[0]=="<"&&h.test(e))r=C.fragment(e,RegExp.$1,i),e=null;else if(i!==t)return n(i).find(e);else r=C.qsa(u,e)}else if(k(e))return n(u).ready(e);else if(C.isZ(e))return e;else{if(M(e))r=q(e);else if($(e))r=[e],e=null;else if(h.test(e))r=C.fragment(e.trim(),RegExp.$1,i),e=null;else if(i!==t)return n(i).find(e);else r=C.qsa(u,e)}return C.Z(r,e)};n=function(t,e){return C.init(t,e)};function U(n,i,r){for(e in i)if(r&&(R(i[e])||M(i[e]))){if(R(i[e])&&!R(n[e]))n[e]={};if(M(i[e])&&!M(n[e]))n[e]=[];U(n[e],i[e],r)}else if(i[e]!==t)n[e]=i[e]}n.extend=function(t){var e,n=s.call(arguments,1);if(typeof t=="boolean"){e=t;t=n.shift()}n.forEach(function(n){U(t,n,e)});return t};C.qsa=function(t,e){var n,i=e[0]=="#",r=!i&&e[0]==".",o=i||r?e.slice(1):e,a=T.test(o);return t.getElementById&&a&&i?(n=t.getElementById(o))?[n]:[]:t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11?[]:s.call(a&&!i&&t.getElementsByClassName?r?t.getElementsByClassName(o):t.getElementsByTagName(e):t.querySelectorAll(e))};function X(t,e){return e==null?n(t):n(t).filter(e)}n.contains=u.documentElement.contains?function(t,e){return t!==e&&t.contains(e)}:function(t,e){while(e&&(e=e.parentNode))if(e===t)return true;return false};function Y(t,e,n,i){return k(e)?e.call(t,n,i):e}function G(t,e,n){n==null?t.removeAttribute(e):t.setAttribute(e,n)}function J(e,n){var i=e.className||"",r=i&&i.baseVal!==t;if(n===t)return r?i.baseVal:i;r?i.baseVal=n:e.className=n}function K(t){try{return t?t=="true"||(t=="false"?false:t=="null"?null:+t+""==t?+t:/^[\[\{]/.test(t)?n.parseJSON(t):t):t}catch(e){return t}}n.type=D;n.isFunction=k;n.isWindow=F;n.isArray=M;n.isPlainObject=R;n.isEmptyObject=function(t){var e;for(e in t)return false;return true};n.isNumeric=function(t){var e=Number(t),n=typeof t;return t!=null&&n!="boolean"&&(n!="string"||t.length)&&!isNaN(e)&&isFinite(e)||false};n.inArray=function(t,e,n){return r.indexOf.call(e,t,n)};n.camelCase=O;n.trim=function(t){return t==null?"":String.prototype.trim.call(t)};n.uuid=0;n.support={};n.expr={};n.noop=function(){};n.map=function(t,e){var n,i=[],r,o;if(_(t))for(r=0;r<t.length;r++){n=e(t[r],r);if(n!=null)i.push(n)}else for(o in t){n=e(t[o],o);if(n!=null)i.push(n)}return z(i)};n.each=function(t,e){var n,i;if(_(t)){for(n=0;n<t.length;n++)if(e.call(t[n],n,t[n])===false)return t}else{for(i in t)if(e.call(t[i],i,t[i])===false)return t}return t};n.grep=function(t,e){return a.call(t,e)};if(window.JSON)n.parseJSON=JSON.parse;n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){S["[object "+e+"]"]=e.toLowerCase()});n.fn={constructor:C.Z,length:0,forEach:r.forEach,reduce:r.reduce,push:r.push,sort:r.sort,splice:r.splice,indexOf:r.indexOf,concat:function(){var t,e,n=[];for(t=0;t<arguments.length;t++){e=arguments[t];n[t]=C.isZ(e)?e.toArray():e}return o.apply(C.isZ(this)?this.toArray():this,n)},map:function(t){return n(n.map(this,function(e,n){return t.call(e,n,e)}))},slice:function(){return n(s.apply(this,arguments))},ready:function(t){if(E.test(u.readyState)&&u.body)t(n);else u.addEventListener("DOMContentLoaded",function(){t(n)},false);return this},get:function(e){return e===t?s.call(this):this[e>=0?e:e+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){if(this.parentNode!=null)this.parentNode.removeChild(this)})},each:function(t){r.every.call(this,function(e,n){return t.call(e,n,e)!==false});return this},filter:function(t){if(k(t))return this.not(this.not(t));return n(a.call(this,function(e){return C.matches(e,t)}))},add:function(t,e){return n(N(this.concat(n(t,e))))},is:function(t){return this.length>0&&C.matches(this[0],t)},not:function(e){var i=[];if(k(e)&&e.call!==t)this.each(function(t){if(!e.call(this,t))i.push(this)});else{var r=typeof e=="string"?this.filter(e):_(e)&&k(e.item)?s.call(e):n(e);this.forEach(function(t){if(r.indexOf(t)<0)i.push(t)})}return n(i)},has:function(t){return this.filter(function(){return $(t)?n.contains(this,t):n(this).find(t).size()})},eq:function(t){return t===-1?this.slice(t):this.slice(t,+t+1)},first:function(){var t=this[0];return t&&!$(t)?t:n(t)},last:function(){var t=this[this.length-1];return t&&!$(t)?t:n(t)},find:function(t){var e,i=this;if(!t)e=n();else if(typeof t=="object")e=n(t).filter(function(){var t=this;return r.some.call(i,function(e){return n.contains(e,t)})});else if(this.length==1)e=n(C.qsa(this[0],t));else e=this.map(function(){return C.qsa(this,t)});return e},closest:function(t,e){var i=[],r=typeof t=="object"&&n(t);this.each(function(n,o){while(o&&!(r?r.indexOf(o)>=0:C.matches(o,t)))o=o!==e&&!L(o)&&o.parentNode;if(o&&i.indexOf(o)<0)i.push(o)});return n(i)},parents:function(t){var e=[],i=this;while(i.length>0)i=n.map(i,function(t){if((t=t.parentNode)&&!L(t)&&e.indexOf(t)<0){e.push(t);return t}});return X(e,t)},parent:function(t){return X(N(this.pluck("parentNode")),t)},children:function(t){return X(this.map(function(){return V(this)}),t)},contents:function(){return this.map(function(){return this.contentDocument||s.call(this.childNodes)})},siblings:function(t){return X(this.map(function(t,e){return a.call(V(e.parentNode),function(t){return t!==e})}),t)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(t){return n.map(this,function(e){return e[t]})},show:function(){return this.each(function(){this.style.display=="none"&&(this.style.display="");if(getComputedStyle(this,"").getPropertyValue("display")=="none")this.style.display=B(this.nodeName)})},replaceWith:function(t){return this.before(t).remove()},wrap:function(t){var e=k(t);if(this[0]&&!e)var i=n(t).get(0),r=i.parentNode||this.length>1;return this.each(function(o){n(this).wrapAll(e?t.call(this,o):r?i.cloneNode(true):i)})},wrapAll:function(t){if(this[0]){n(this[0]).before(t=n(t));var e;while((e=t.children()).length)t=e.first();n(t).append(this)}return this},wrapInner:function(t){var e=k(t);return this.each(function(i){var r=n(this),o=r.contents(),a=e?t.call(this,i):t;o.length?o.wrapAll(a):r.append(a)})},unwrap:function(){this.parent().each(function(){n(this).replaceWith(n(this).children())});return this},clone:function(){return this.map(function(){return this.cloneNode(true)})},hide:function(){return this.css("display","none")},toggle:function(e){return this.each(function(){var i=n(this);(e===t?i.css("display")=="none":e)?i.show():i.hide()})},prev:function(t){return n(this.pluck("previousElementSibling")).filter(t||"*")},next:function(t){return n(this.pluck("nextElementSibling")).filter(t||"*")},html:function(t){return 0 in arguments?this.each(function(e){var i=this.innerHTML;n(this).empty().append(Y(this,t,e,i))}):0 in this?this[0].innerHTML:null},text:function(t){return 0 in arguments?this.each(function(e){var n=Y(this,t,e,this.textContent);this.textContent=n==null?"":""+n}):0 in this?this.pluck("textContent").join(""):null},attr:function(n,i){var r;return typeof n=="string"&&!(1 in arguments)?0 in this&&this[0].nodeType==1&&(r=this[0].getAttribute(n))!=null?r:t:this.each(function(t){if(this.nodeType!==1)return;if($(n))for(e in n)G(this,e,n[e]);else G(this,n,Y(this,i,t,this.getAttribute(n)))})},removeAttr:function(t){return this.each(function(){this.nodeType===1&&t.split(" ").forEach(function(t){G(this,t)},this)})},prop:function(t,e){t=P[t]||t;return 1 in arguments?this.each(function(n){this[t]=Y(this,e,n,this[t])}):this[0]&&this[0][t]},removeProp:function(t){t=P[t]||t;return this.each(function(){delete this[t]})},data:function(e,n){var i="data-"+e.replace(v,"-$1").toLowerCase();var r=1 in arguments?this.attr(i,n):this.attr(i);return r!==null?K(r):t},val:function(t){if(0 in arguments){if(t==null)t="";return this.each(function(e){this.value=Y(this,t,e,this.value)})}else{return this[0]&&(this[0].multiple?n(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value)}},offset:function(t){if(t)return this.each(function(e){var i=n(this),r=Y(this,t,e,i.offset()),o=i.offsetParent().offset(),a={top:r.top-o.top,left:r.left-o.left};if(i.css("position")=="static")a["position"]="relative";i.css(a)});if(!this.length)return null;if(u.documentElement!==this[0]&&!n.contains(u.documentElement,this[0]))return{top:0,left:0};var e=this[0].getBoundingClientRect();return{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset,width:Math.round(e.width),height:Math.round(e.height)}},css:function(t,i){if(arguments.length<2){var r=this[0];if(typeof t=="string"){if(!r)return;return r.style[O(t)]||getComputedStyle(r,"").getPropertyValue(t)}else if(M(t)){if(!r)return;var o={};var a=getComputedStyle(r,"");n.each(t,function(t,e){o[e]=r.style[O(e)]||a.getPropertyValue(e)});return o}}var s="";if(D(t)=="string"){if(!i&&i!==0)this.each(function(){this.style.removeProperty(I(t))});else s=I(t)+":"+Z(t,i)}else{for(e in t)if(!t[e]&&t[e]!==0)this.each(function(){this.style.removeProperty(I(e))});else s+=I(e)+":"+Z(e,t[e])+";"}return this.each(function(){this.style.cssText+=";"+s})},index:function(t){return t?this.indexOf(n(t)[0]):this.parent().children().indexOf(this[0])},hasClass:function(t){if(!t)return false;return r.some.call(this,function(t){return this.test(J(t))},W(t))},addClass:function(t){if(!t)return this;return this.each(function(e){if(!("className"in this))return;i=[];var r=J(this),o=Y(this,t,e,r);o.split(/\s+/g).forEach(function(t){if(!n(this).hasClass(t))i.push(t)},this);i.length&&J(this,r+(r?" ":"")+i.join(" "))})},removeClass:function(e){return this.each(function(n){if(!("className"in this))return;if(e===t)return J(this,"");i=J(this);Y(this,e,n,i).split(/\s+/g).forEach(function(t){i=i.replace(W(t)," ")});J(this,i.trim())})},toggleClass:function(e,i){if(!e)return this;return this.each(function(r){var o=n(this),a=Y(this,e,r,J(this));a.split(/\s+/g).forEach(function(e){(i===t?!o.hasClass(e):i)?o.addClass(e):o.removeClass(e)})})},scrollTop:function(e){if(!this.length)return;var n="scrollTop"in this[0];if(e===t)return n?this[0].scrollTop:this[0].pageYOffset;return this.each(n?function(){this.scrollTop=e}:function(){this.scrollTo(this.scrollX,e)})},scrollLeft:function(e){if(!this.length)return;var n="scrollLeft"in this[0];if(e===t)return n?this[0].scrollLeft:this[0].pageXOffset;return this.each(n?function(){this.scrollLeft=e}:function(){this.scrollTo(e,this.scrollY)})},position:function(){if(!this.length)return;var t=this[0],e=this.offsetParent(),i=this.offset(),r=m.test(e[0].nodeName)?{top:0,left:0}:e.offset();i.top-=parseFloat(n(t).css("margin-top"))||0;i.left-=parseFloat(n(t).css("margin-left"))||0;r.top+=parseFloat(n(e[0]).css("border-top-width"))||0;r.left+=parseFloat(n(e[0]).css("border-left-width"))||0;return{top:i.top-r.top,left:i.left-r.left}},offsetParent:function(){return this.map(function(){var t=this.offsetParent||u.body;while(t&&!m.test(t.nodeName)&&n(t).css("position")=="static")t=t.offsetParent;return t})}};n.fn.detach=n.fn.remove;["width","height"].forEach(function(e){var i=e.replace(/./,function(t){return t[0].toUpperCase()});n.fn[e]=function(r){var o,a=this[0];if(r===t)return F(a)?a["inner"+i]:L(a)?a.documentElement["scroll"+i]:(o=this.offset())&&o[e];else return this.each(function(t){a=n(this);a.css(e,Y(this,r,t,a[e]()))})}});function Q(t,e){e(t);for(var n=0,i=t.childNodes.length;n<i;n++)Q(t.childNodes[n],e)}y.forEach(function(e,i){var r=i%2;n.fn[e]=function(){var e,o=n.map(arguments,function(i){var r=[];e=D(i);if(e=="array"){i.forEach(function(e){if(e.nodeType!==t)return r.push(e);else if(n.zepto.isZ(e))return r=r.concat(e.get());r=r.concat(C.fragment(e))});return r}return e=="object"||i==null?i:C.fragment(i)}),a,s=this.length>1;if(o.length<1)return this;return this.each(function(t,e){a=r?e:e.parentNode;e=i==0?e.nextSibling:i==1?e.firstChild:i==2?e:null;var f=n.contains(u.documentElement,a);o.forEach(function(t){if(s)t=t.cloneNode(true);else if(!a)return n(t).remove();a.insertBefore(t,e);if(f)Q(t,function(t){if(t.nodeName!=null&&t.nodeName.toUpperCase()==="SCRIPT"&&(!t.type||t.type==="text/javascript")&&!t.src){var e=t.ownerDocument?t.ownerDocument.defaultView:window;e["eval"].call(e,t.innerHTML)}})})})};n.fn[r?e+"To":"insert"+(i?"Before":"After")]=function(t){n(t)[e](this);return this}});C.Z.prototype=H.prototype=n.fn;C.uniq=N;C.deserializeValue=K;n.zepto=C;return n}();window.Zepto=e;window.$===undefined&&(window.$=e);(function(t){var e=1,n,i=Array.prototype.slice,r=t.isFunction,o=function(t){return typeof t=="string"},a={},s={},u="onfocusin"in window,f={focus:"focusin",blur:"focusout"},c={mouseenter:"mouseover",mouseleave:"mouseout"};s.click=s.mousedown=s.mouseup=s.mousemove="MouseEvents";function l(t){return t._zid||(t._zid=e++)}function h(t,e,n,i){e=p(e);if(e.ns)var r=d(e.ns);return(a[l(t)]||[]).filter(function(t){return t&&(!e.e||t.e==e.e)&&(!e.ns||r.test(t.ns))&&(!n||l(t.fn)===l(n))&&(!i||t.sel==i)})}function p(t){var e=(""+t).split(".");return{e:e[0],ns:e.slice(1).sort().join(" ")}}function d(t){return new RegExp("(?:^| )"+t.replace(" "," .* ?")+"(?: |$)")}function m(t,e){return t.del&&(!u&&t.e in f)||!!e}function v(t){return c[t]||u&&f[t]||t}function g(e,i,r,o,s,u,f){var h=l(e),d=a[h]||(a[h]=[]);i.split(/\s/).forEach(function(i){if(i=="ready")return t(document).ready(r);var a=p(i);a.fn=r;a.sel=s;if(a.e in c)r=function(e){var n=e.relatedTarget;if(!n||n!==this&&!t.contains(this,n))return a.fn.apply(this,arguments)};a.del=u;var l=u||r;a.proxy=function(t){t=T(t);if(t.isImmediatePropagationStopped())return;t.data=o;var i=l.apply(e,t._args==n?[t]:[t].concat(t._args));if(i===false)t.preventDefault(),t.stopPropagation();return i};a.i=d.length;d.push(a);if("addEventListener"in e)e.addEventListener(v(a.e),a.proxy,m(a,f))})}function y(t,e,n,i,r){var o=l(t);(e||"").split(/\s/).forEach(function(e){h(t,e,n,i).forEach(function(e){delete a[o][e.i];if("removeEventListener"in t)t.removeEventListener(v(e.e),e.proxy,m(e,r))})})}t.event={add:g,remove:y};t.proxy=function(e,n){var a=2 in arguments&&i.call(arguments,2);if(r(e)){var s=function(){return e.apply(n,a?a.concat(i.call(arguments)):arguments)};s._zid=l(e);return s}else if(o(n)){if(a){a.unshift(e[n],e);return t.proxy.apply(null,a)}else{return t.proxy(e[n],e)}}else{throw new TypeError("expected function")}};t.fn.bind=function(t,e,n){return this.on(t,e,n)};t.fn.unbind=function(t,e){return this.off(t,e)};t.fn.one=function(t,e,n,i){return this.on(t,e,n,i,1)};var b=function(){return true},w=function(){return false},x=/^([A-Z]|returnValue$|layer[XY]$|webkitMovement[XY]$)/,E={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};function T(e,i){if(i||!e.isDefaultPrevented){i||(i=e);t.each(E,function(t,n){var r=i[t];e[t]=function(){this[n]=b;return r&&r.apply(i,arguments)};e[n]=w});e.timeStamp||(e.timeStamp=Date.now());if(i.defaultPrevented!==n?i.defaultPrevented:"returnValue"in i?i.returnValue===false:i.getPreventDefault&&i.getPreventDefault())e.isDefaultPrevented=b}return e}function S(t){var e,i={originalEvent:t};for(e in t)if(!x.test(e)&&t[e]!==n)i[e]=t[e];return T(i,t)}t.fn.delegate=function(t,e,n){return this.on(e,t,n)};t.fn.undelegate=function(t,e,n){return this.off(e,t,n)};t.fn.live=function(e,n){t(document.body).delegate(this.selector,e,n);return this};t.fn.die=function(e,n){t(document.body).undelegate(this.selector,e,n);return this};t.fn.on=function(e,a,s,u,f){var c,l,h=this;if(e&&!o(e)){t.each(e,function(t,e){h.on(t,a,s,e,f)});return h}if(!o(a)&&!r(u)&&u!==false)u=s,s=a,a=n;if(u===n||s===false)u=s,s=n;if(u===false)u=w;return h.each(function(n,r){if(f)c=function(t){y(r,t.type,u);return u.apply(this,arguments)};if(a)l=function(e){var n,o=t(e.target).closest(a,r).get(0);if(o&&o!==r){n=t.extend(S(e),{currentTarget:o,liveFired:r});return(c||u).apply(o,[n].concat(i.call(arguments,1)))}};g(r,e,u,s,a,l||c)})};t.fn.off=function(e,i,a){var s=this;if(e&&!o(e)){t.each(e,function(t,e){s.off(t,i,e)});return s}if(!o(i)&&!r(a)&&a!==false)a=i,i=n;if(a===false)a=w;return s.each(function(){y(this,e,a,i)})};t.fn.trigger=function(e,n){e=o(e)||t.isPlainObject(e)?t.Event(e):T(e);e._args=n;return this.each(function(){if(e.type in f&&typeof this[e.type]=="function")this[e.type]();else if("dispatchEvent"in this)this.dispatchEvent(e);else t(this).triggerHandler(e,n)})};t.fn.triggerHandler=function(e,n){var i,r;this.each(function(a,s){i=S(o(e)?t.Event(e):e);i._args=n;i.target=s;t.each(h(s,e.type||e),function(t,e){r=e.proxy(i);if(i.isImmediatePropagationStopped())return false})});return r};("focusin focusout focus blur load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select keydown keypress keyup error").split(" ").forEach(function(e){t.fn[e]=function(t){return 0 in arguments?this.bind(e,t):this.trigger(e)}});t.Event=function(t,e){if(!o(t))e=t,t=e.type;var n=document.createEvent(s[t]||"Events"),i=true;if(e)for(var r in e)r=="bubbles"?i=!!e[r]:n[r]=e[r];n.initEvent(t,i,true);return T(n)}})(e);(function(t){var e=+new Date,n=window.document,i,r,o=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,a=/^(?:text|application)\/javascript/i,s=/^(?:text|application)\/xml/i,u="application/json",f="text/html",c=/^\s*$/,l=n.createElement("a");l.href=window.location.href;function h(e,n,i){var r=t.Event(n);t(e).trigger(r,i);return!r.isDefaultPrevented()}function p(t,e,i,r){if(t.global)return h(e||n,i,r)}t.active=0;function d(e){if(e.global&&t.active++===0)p(e,null,"ajaxStart")}function m(e){if(e.global&&!--t.active)p(e,null,"ajaxStop")}function v(t,e){var n=e.context;if(e.beforeSend.call(n,t,e)===false||p(e,n,"ajaxBeforeSend",[t,e])===false)return false;p(e,n,"ajaxSend",[t,e])}function g(t,e,n,i){var r=n.context,o="success";n.success.call(r,t,o,e);if(i)i.resolveWith(r,[t,o,e]);p(n,r,"ajaxSuccess",[e,n,t]);b(o,e,n)}function y(t,e,n,i,r){var o=i.context;i.error.call(o,n,e,t);if(r)r.rejectWith(o,[n,e,t]);p(i,o,"ajaxError",[n,i,t||e]);b(e,n,i)}function b(t,e,n){var i=n.context;n.complete.call(i,e,t);p(n,i,"ajaxComplete",[e,n]);m(n)}function w(t,e,n){if(n.dataFilter==x)return t;var i=n.context;return n.dataFilter.call(i,t,e)}function x(){}t.ajaxJSONP=function(i,r){if(!("type"in i))return t.ajax(i);var o=i.jsonpCallback,a=(t.isFunction(o)?o():o)||"Zepto"+e++,s=n.createElement("script"),u=window[a],f,c=function(e){t(s).triggerHandler("error",e||"abort")},l={abort:c},h;if(r)r.promise(l);t(s).on("load error",function(e,n){clearTimeout(h);t(s).off().remove();if(e.type=="error"||!f){y(null,n||"error",l,i,r)}else{g(f[0],l,i,r)}window[a]=u;if(f&&t.isFunction(u))u(f[0]);u=f=undefined});if(v(l,i)===false){c("abort");return l}window[a]=function(){f=arguments};s.src=i.url.replace(/\?(.+)=\?/,"?$1="+a);n.head.appendChild(s);if(i.timeout>0)h=setTimeout(function(){c("timeout")},i.timeout);return l};t.ajaxSettings={type:"GET",beforeSend:x,success:x,error:x,complete:x,context:null,global:true,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:u,xml:"application/xml, text/xml",html:f,text:"text/plain"},crossDomain:false,timeout:0,processData:true,cache:true,dataFilter:x};function E(t){if(t)t=t.split(";",2)[0];return t&&(t==f?"html":t==u?"json":a.test(t)?"script":s.test(t)&&"xml")||"text"}function T(t,e){if(e=="")return t;return(t+"&"+e).replace(/[&?]{1,2}/,"?")}function S(e){if(e.processData&&e.data&&t.type(e.data)!="string")e.data=t.param(e.data,e.traditional);if(e.data&&(!e.type||e.type.toUpperCase()=="GET"||"jsonp"==e.dataType))e.url=T(e.url,e.data),e.data=undefined}t.ajax=function(e){var o=t.extend({},e||{}),a=t.Deferred&&t.Deferred(),s,u;for(i in t.ajaxSettings)if(o[i]===undefined)o[i]=t.ajaxSettings[i];d(o);if(!o.crossDomain){s=n.createElement("a");s.href=o.url;s.href=s.href;o.crossDomain=l.protocol+"//"+l.host!==s.protocol+"//"+s.host}if(!o.url)o.url=window.location.toString();if((u=o.url.indexOf("#"))>-1)o.url=o.url.slice(0,u);S(o);var f=o.dataType,h=/\?.+=\?/.test(o.url);if(h)f="jsonp";if(o.cache===false||(!e||e.cache!==true)&&("script"==f||"jsonp"==f))o.url=T(o.url,"_="+Date.now());if("jsonp"==f){if(!h)o.url=T(o.url,o.jsonp?o.jsonp+"=?":o.jsonp===false?"":"callback=?");return t.ajaxJSONP(o,a)}var p=o.accepts[f],m={},b=function(t,e){m[t.toLowerCase()]=[t,e]},j=/^([\w-]+:)\/\//.test(o.url)?RegExp.$1:window.location.protocol,C=o.xhr(),O=C.setRequestHeader,N;if(a)a.promise(C);if(!o.crossDomain)b("X-Requested-With","XMLHttpRequest");b("Accept",p||"*/*");if(p=o.mimeType||p){if(p.indexOf(",")>-1)p=p.split(",",2)[0];C.overrideMimeType&&C.overrideMimeType(p)}if(o.contentType||o.contentType!==false&&o.data&&o.type.toUpperCase()!="GET")b("Content-Type",o.contentType||"application/x-www-form-urlencoded");if(o.headers)for(r in o.headers)b(r,o.headers[r]);C.setRequestHeader=b;C.onreadystatechange=function(){if(C.readyState==4){C.onreadystatechange=x;clearTimeout(N);var e,n=false;if(C.status>=200&&C.status<300||C.status==304||C.status==0&&j=="file:"){f=f||E(o.mimeType||C.getResponseHeader("content-type"));if(C.responseType=="arraybuffer"||C.responseType=="blob")e=C.response;else{e=C.responseText;try{e=w(e,f,o);if(f=="script")(1,eval)(e);else if(f=="xml")e=C.responseXML;else if(f=="json")e=c.test(e)?null:t.parseJSON(e)}catch(i){n=i}if(n)return y(n,"parsererror",C,o,a)}g(e,C,o,a)}else{y(C.statusText||null,C.status?"error":"abort",C,o,a)}}};if(v(C,o)===false){C.abort();y(null,"abort",C,o,a);return C}var A="async"in o?o.async:true;C.open(o.type,o.url,A,o.username,o.password);if(o.xhrFields)for(r in o.xhrFields)C[r]=o.xhrFields[r];for(r in m)O.apply(C,m[r]);if(o.timeout>0)N=setTimeout(function(){C.onreadystatechange=x;C.abort();y(null,"timeout",C,o,a)},o.timeout);C.send(o.data?o.data:null);return C};function j(e,n,i,r){if(t.isFunction(n))r=i,i=n,n=undefined;if(!t.isFunction(i))r=i,i=undefined;return{url:e,data:n,success:i,dataType:r}}t.get=function(){return t.ajax(j.apply(null,arguments))};t.post=function(){var e=j.apply(null,arguments);e.type="POST";return t.ajax(e)};t.getJSON=function(){var e=j.apply(null,arguments);e.dataType="json";return t.ajax(e)};t.fn.load=function(e,n,i){if(!this.length)return this;var r=this,a=e.split(/\s/),s,u=j(e,n,i),f=u.success;if(a.length>1)u.url=a[0],s=a[1];u.success=function(e){r.html(s?t("<div>").html(e.replace(o,"")).find(s):e);f&&f.apply(r,arguments)};t.ajax(u);return this};var C=encodeURIComponent;function O(e,n,i,r){var o,a=t.isArray(n),s=t.isPlainObject(n);t.each(n,function(n,u){o=t.type(u);if(r)n=i?r:r+"["+(s||o=="object"||o=="array"?n:"")+"]";if(!r&&a)e.add(u.name,u.value);else if(o=="array"||!i&&o=="object")O(e,u,i,n);else e.add(n,u)})}t.param=function(e,n){var i=[];i.add=function(e,n){if(t.isFunction(n))n=n();if(n==null)n="";this.push(C(e)+"="+C(n))};O(i,e,n);return i.join("&").replace(/%20/g,"+")}})(e);(function(t){t.fn.serializeArray=function(){var e,n,i=[],r=function(t){if(t.forEach)return t.forEach(r);i.push({name:e,value:t})};if(this[0])t.each(this[0].elements,function(i,o){n=o.type,e=o.name;if(e&&o.nodeName.toLowerCase()!="fieldset"&&!o.disabled&&n!="submit"&&n!="reset"&&n!="button"&&n!="file"&&(n!="radio"&&n!="checkbox"||o.checked))r(t(o).val())});return i};t.fn.serialize=function(){var t=[];this.serializeArray().forEach(function(e){t.push(encodeURIComponent(e.name)+"="+encodeURIComponent(e.value))});return t.join("&")};t.fn.submit=function(e){if(0 in arguments)this.bind("submit",e);else if(this.length){var n=t.Event("submit");this.eq(0).trigger(n);if(!n.isDefaultPrevented())this.get(0).submit()}return this}})(e);(function(){try{getComputedStyle(undefined)}catch(t){var e=getComputedStyle;window.getComputedStyle=function(t,n){try{return e(t,n)}catch(i){return null}}}})();(function(t){function e(t,e){var n=this.os={},i=this.browser={},r=t.match(/Web[kK]it[\/]{0,1}([\d.]+)/),o=t.match(/(Android);?[\s\/]+([\d.]+)?/),a=!!t.match(/\(Macintosh\; Intel /),s=t.match(/(iPad).*OS\s([\d_]+)/),u=t.match(/(iPod)(.*OS\s([\d_]+))?/),f=!s&&t.match(/(iPhone\sOS)\s([\d_]+)/),c=t.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),l=/Win\d{2}|Windows/.test(e),h=t.match(/Windows Phone ([\d.]+)/),p=c&&t.match(/TouchPad/),d=t.match(/Kindle\/([\d.]+)/),m=t.match(/Silk\/([\d._]+)/),v=t.match(/(BlackBerry).*Version\/([\d.]+)/),g=t.match(/(BB10).*Version\/([\d.]+)/),y=t.match(/(RIM\sTablet\sOS)\s([\d.]+)/),b=t.match(/PlayBook/),w=t.match(/Chrome\/([\d.]+)/)||t.match(/CriOS\/([\d.]+)/),x=t.match(/Firefox\/([\d.]+)/),E=t.match(/\((?:Mobile|Tablet); rv:([\d.]+)\).*Firefox\/[\d.]+/),T=t.match(/MSIE\s([\d.]+)/)||t.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),S=!w&&t.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),j=S||t.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);if(i.webkit=!!r)i.version=r[1];if(o)n.android=true,n.version=o[2];if(f&&!u)n.ios=n.iphone=true,n.version=f[2].replace(/_/g,".");if(s)n.ios=n.ipad=true,n.version=s[2].replace(/_/g,".");if(u)n.ios=n.ipod=true,n.version=u[3]?u[3].replace(/_/g,"."):null;if(h)n.wp=true,n.version=h[1];if(c)n.webos=true,n.version=c[2];if(p)n.touchpad=true;if(v)n.blackberry=true,n.version=v[2];if(g)n.bb10=true,n.version=g[2];if(y)n.rimtabletos=true,n.version=y[2];if(b)i.playbook=true;if(d)n.kindle=true,n.version=d[1];if(m)i.silk=true,i.version=m[1];if(!m&&n.android&&t.match(/Kindle Fire/))i.silk=true;if(w)i.chrome=true,i.version=w[1];if(x)i.firefox=true,i.version=x[1];if(E)n.firefoxos=true,n.version=E[1];if(T)i.ie=true,i.version=T[1];if(j&&(a||n.ios||l)){i.safari=true;if(!n.ios)i.version=j[1]}if(S)i.webview=true;n.tablet=!!(s||b||o&&!t.match(/Mobile/)||x&&t.match(/Tablet/)||T&&!t.match(/Phone/)&&t.match(/Touch/));n.phone=!!(!n.tablet&&!n.ipod&&(o||f||c||v||g||w&&t.match(/Android/)||w&&t.match(/CriOS\/([\d.]+)/)||x&&t.match(/Mobile/)||T&&t.match(/Touch/)))}e.call(t,navigator.userAgent,navigator.platform);t.__detect=e})(e);(function(t){var e=[],n;t.fn.remove=function(){return this.each(function(){if(this.parentNode){if(this.tagName==="IMG"){e.push(this);this.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";if(n)clearTimeout(n);n=setTimeout(function(){e=[]},6e4)}this.parentNode.removeChild(this)}})}})(e);(function(t){var e={},n=t.fn.data,i=t.camelCase,r=t.expando="Zepto"+ +new Date,o=[];function a(o,a){var u=o[r],f=u&&e[u];if(a===undefined)return f||s(o);else{if(f){if(a in f)return f[a];var c=i(a);if(c in f)return f[c]}return n.call(t(o),a)}}function s(n,o,a){var s=n[r]||(n[r]=++t.uuid),f=e[s]||(e[s]=u(n));if(o!==undefined)f[i(o)]=a;return f}function u(e){var n={};t.each(e.attributes||o,function(e,r){if(r.name.indexOf("data-")==0)n[i(r.name.replace("data-",""))]=t.zepto.deserializeValue(r.value)});return n}t.fn.data=function(e,n){return n===undefined?t.isPlainObject(e)?this.each(function(n,i){t.each(e,function(t,e){s(i,t,e)})}):0 in this?a(this[0],e):undefined:this.each(function(){s(this,e,n)})};t.data=function(e,n,i){return t(e).data(n,i)};t.hasData=function(n){var i=n[r],o=i&&e[i];return o?!t.isEmptyObject(o):false};t.fn.removeData=function(n){if(typeof n=="string")n=n.split(/\s+/);return this.each(function(){var o=this[r],a=o&&e[o];if(a)t.each(n||a,function(t){delete a[n?i(this):t]})})};["remove","empty"].forEach(function(e){var n=t.fn[e];t.fn[e]=function(){var t=this.find("*");if(e==="remove")t=t.add(this);t.removeData();return n.call(this)}})})(e);(function(t){var e=Array.prototype.slice;function n(e){var i=[["resolve","done",t.Callbacks({once:1,memory:1}),"resolved"],["reject","fail",t.Callbacks({once:1,memory:1}),"rejected"],["notify","progress",t.Callbacks({memory:1})]],r="pending",o={state:function(){return r},always:function(){a.done(arguments).fail(arguments);return this},then:function(){var e=arguments;return n(function(n){t.each(i,function(i,r){var s=t.isFunction(e[i])&&e[i];a[r[1]](function(){var e=s&&s.apply(this,arguments);if(e&&t.isFunction(e.promise)){e.promise().done(n.resolve).fail(n.reject).progress(n.notify)}else{var i=this===o?n.promise():this,a=s?[e]:arguments;n[r[0]+"With"](i,a)}})});e=null}).promise()},promise:function(e){return e!=null?t.extend(e,o):o}},a={};t.each(i,function(t,e){var n=e[2],s=e[3];o[e[1]]=n.add;if(s){n.add(function(){r=s},i[t^1][2].disable,i[2][2].lock)}a[e[0]]=function(){a[e[0]+"With"](this===a?o:this,arguments);return this};a[e[0]+"With"]=n.fireWith});o.promise(a);if(e)e.call(a,a);return a}t.when=function(i){var r=e.call(arguments),o=r.length,a=0,s=o!==1||i&&t.isFunction(i.promise)?o:0,u=s===1?i:n(),f,c,l,h=function(t,n,i){return function(r){n[t]=this;i[t]=arguments.length>1?e.call(arguments):r;if(i===f){u.notifyWith(n,i)}else if(!--s){u.resolveWith(n,i)}}};if(o>1){f=new Array(o);c=new Array(o);l=new Array(o);for(;a<o;++a){if(r[a]&&t.isFunction(r[a].promise)){r[a].promise().done(h(a,l,r)).fail(u.reject).progress(h(a,c,f))}else{
--s}}}if(!s)u.resolveWith(l,r);return u.promise()};t.Deferred=n})(e);(function(t){t.Callbacks=function(e){e=t.extend({},e);var n,i,r,o,a,s,u=[],f=!e.once&&[],c=function(t){n=e.memory&&t;i=true;s=o||0;o=0;a=u.length;r=true;for(;u&&s<a;++s){if(u[s].apply(t[0],t[1])===false&&e.stopOnFalse){n=false;break}}r=false;if(u){if(f)f.length&&c(f.shift());else if(n)u.length=0;else l.disable()}},l={add:function(){if(u){var i=u.length,s=function(n){t.each(n,function(t,n){if(typeof n==="function"){if(!e.unique||!l.has(n))u.push(n)}else if(n&&n.length&&typeof n!=="string")s(n)})};s(arguments);if(r)a=u.length;else if(n){o=i;c(n)}}return this},remove:function(){if(u){t.each(arguments,function(e,n){var i;while((i=t.inArray(n,u,i))>-1){u.splice(i,1);if(r){if(i<=a)--a;if(i<=s)--s}}})}return this},has:function(e){return!!(u&&(e?t.inArray(e,u)>-1:u.length))},empty:function(){a=u.length=0;return this},disable:function(){u=f=n=undefined;return this},disabled:function(){return!u},lock:function(){f=undefined;if(!n)l.disable();return this},locked:function(){return!f},fireWith:function(t,e){if(u&&(!i||f)){e=e||[];e=[t,e.slice?e.slice():e];if(r)f.push(e);else c(e)}return this},fire:function(){return l.fireWith(this,arguments)},fired:function(){return!!i}};return l}})(e);(function(t){var e=t.zepto,n=e.qsa,i=e.matches;function r(e){e=t(e);return!!(e.width()||e.height())&&e.css("display")!=="none"}var o=t.expr[":"]={visible:function(){if(r(this))return this},hidden:function(){if(!r(this))return this},selected:function(){if(this.selected)return this},checked:function(){if(this.checked)return this},parent:function(){return this.parentNode},first:function(t){if(t===0)return this},last:function(t,e){if(t===e.length-1)return this},eq:function(t,e,n){if(t===n)return this},contains:function(e,n,i){if(t(this).text().indexOf(i)>-1)return this},has:function(t,n,i){if(e.qsa(this,i).length)return this}};var a=new RegExp("(.*):(\\w+)(?:\\(([^)]+)\\))?$\\s*"),s=/^\s*>/,u="Zepto"+ +new Date;function f(t,e){t=t.replace(/=#\]/g,'="#"]');var n,i,r=a.exec(t);if(r&&r[2]in o){n=o[r[2]],i=r[3];t=r[1];if(i){var s=Number(i);if(isNaN(s))i=i.replace(/^["']|["']$/g,"");else i=s}}return e(t,n,i)}e.qsa=function(i,r){return f(r,function(o,a,f){try{var c;if(!o&&a)o="*";else if(s.test(o))c=t(i).addClass(u),o="."+u+" "+o;var l=n(i,o)}catch(h){console.error("error performing selector: %o",r);throw h}finally{if(c)c.removeClass(u)}return!a?l:e.uniq(t.map(l,function(t,e){return a.call(t,e,l,f)}))})};e.matches=function(t,e){return f(e,function(e,n,r){return(!e||i(t,e))&&(!n||n.call(t,null,r)===t)})}})(e);(function(t){var e={},n,i,r,o,a=750,s;function u(t,e,n,i){return Math.abs(t-e)>=Math.abs(n-i)?t-e>0?"Left":"Right":n-i>0?"Up":"Down"}function f(){o=null;if(e.last){e.el.trigger("longTap");e={}}}function c(){if(o)clearTimeout(o);o=null}function l(){if(n)clearTimeout(n);if(i)clearTimeout(i);if(r)clearTimeout(r);if(o)clearTimeout(o);n=i=r=o=null;e={}}function h(t){return(t.pointerType=="touch"||t.pointerType==t.MSPOINTER_TYPE_TOUCH)&&t.isPrimary}function p(t,e){return t.type=="pointer"+e||t.type.toLowerCase()=="mspointer"+e}t(document).ready(function(){var d,m,v=0,g=0,y,b;if("MSGesture"in window){s=new MSGesture;s.target=document.body}t(document).bind("MSGestureEnd",function(t){var n=t.velocityX>1?"Right":t.velocityX<-1?"Left":t.velocityY>1?"Down":t.velocityY<-1?"Up":null;if(n){e.el.trigger("swipe");e.el.trigger("swipe"+n)}}).on("touchstart MSPointerDown pointerdown",function(i){if((b=p(i,"down"))&&!h(i))return;y=b?i:i.touches[0];if(i.touches&&i.touches.length===1&&e.x2){e.x2=undefined;e.y2=undefined}d=Date.now();m=d-(e.last||d);e.el=t("tagName"in y.target?y.target:y.target.parentNode);n&&clearTimeout(n);e.x1=y.pageX;e.y1=y.pageY;if(m>0&&m<=250)e.isDoubleTap=true;e.last=d;o=setTimeout(f,a);if(s&&b)s.addPointer(i.pointerId)}).on("touchmove MSPointerMove pointermove",function(t){if((b=p(t,"move"))&&!h(t))return;y=b?t:t.touches[0];c();e.x2=y.pageX;e.y2=y.pageY;v+=Math.abs(e.x1-e.x2);g+=Math.abs(e.y1-e.y2)}).on("touchend MSPointerUp pointerup",function(o){if((b=p(o,"up"))&&!h(o))return;c();if(e.x2&&Math.abs(e.x1-e.x2)>30||e.y2&&Math.abs(e.y1-e.y2)>30)r=setTimeout(function(){if(e.el){e.el.trigger("swipe");e.el.trigger("swipe"+u(e.x1,e.x2,e.y1,e.y2))}e={}},0);else if("last"in e)if(v<30&&g<30){i=setTimeout(function(){var i=t.Event("tap");i.pageX=e.x2||e.x1||0;i.pageY=e.y2||e.y1||0;i.cancelTouch=l;if(e.el)e.el.trigger(i);if(e.isDoubleTap){if(e.el)e.el.trigger("doubleTap");e={}}else{n=setTimeout(function(){n=null;if(e.el)e.el.trigger("singleTap");e={}},250)}},0)}else{e={}}v=g=0}).on("touchcancel MSPointerCancel pointercancel",l);t(window).on("scroll",l)});["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(e){t.fn[e]=function(t){return this.on(e,t)}})})(e);(function(t){if(t.os.ios){var e={},n;function i(t){return"tagName"in t?t:t.parentNode}t(document).bind("gesturestart",function(t){var r=Date.now(),o=r-(e.last||r);e.target=i(t.target);n&&clearTimeout(n);e.e1=t.scale;e.last=r}).bind("gesturechange",function(t){e.e2=t.scale}).bind("gestureend",function(n){if(e.e2>0){Math.abs(e.e1-e.e2)!=0&&t(e.target).trigger("pinch")&&t(e.target).trigger("pinch"+(e.e1-e.e2>0?"In":"Out"));e.e1=e.e2=e.last=0}else if("last"in e){e={}}});["pinch","pinchIn","pinchOut"].forEach(function(e){t.fn[e]=function(t){return this.bind(e,t)}})}})(e);(function(t){t.fn.end=function(){return this.prevObject||t()};t.fn.andSelf=function(){return this.add(this.prevObject||t())};"filter,add,not,eq,first,last,find,closest,parents,parent,children,siblings".split(",").forEach(function(e){var n=t.fn[e];t.fn[e]=function(){var t=n.apply(this,arguments);t.prevObject=this;return t}})})(e);(function(t){if(String.prototype.trim===t)String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};if(Array.prototype.reduce===t)Array.prototype.reduce=function(e){if(this===void 0||this===null)throw new TypeError;var n=Object(this),i=n.length>>>0,r=0,o;if(typeof e!="function")throw new TypeError;if(i==0&&arguments.length==1)throw new TypeError;if(arguments.length>=2)o=arguments[1];else do{if(r in n){o=n[r++];break}if(++r>=i)throw new TypeError}while(true);while(r<i){if(r in n)o=e.call(t,o,n[r],r,n);r++}return o}})();return t.exports=exports=e});define('formatJson',function(require,exports,module){var _cacheThisModule_;var _formatJson_cache={};$formatJson=function(str,data){var fn=!/\W/.test(str)?_formatJson_cache[str]=_formatJson_cache[str]||$formatJson(document.getElementById(str).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+str.replace(/[\r\t\n]/g," ").split("<%").join(String.fromCharCode(9)).replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split(String.fromCharCode(9)).join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return data?fn(data):fn;}
exports.formatJson=$formatJson;});
define('wg.jdpromote',function(require,exports,module){var _cacheThisModule_;exports.getMzchgProTitle=function(oSuit){var sTitle='',actDesc='',arrSelectedGif=[];if(oSuit.manGiftSkus&&oSuit.manGiftSkus.length>0){arrSelectedGif=oSuit.manGiftSkus.filter(function(element){return element.giftSelectState=="2";});}
if(oSuit.isAchieved=='1'&&oSuit.checkType==1){actDesc='<a class="btn" attr-href="//wqs.jd.com/item/add_buy.shtml?activity_id='+oSuit.promotion.pid+'" attr-tag="jumpEvent">'+(arrSelectedGif.length?"重新换购":"换购商品")+'</a>';sTitle='<header class="head head_act"><span class="tag">换购</span><p class="title">已购满1件，可用优惠价换购商品</p>'+actDesc+'</header>';}else{actDesc='<a class="btn" attr-href="//wqs.jd.com/item/add_buy.shtml?activity_id='+oSuit.promotion.pid+'" attr-tag="jumpEvent">换购商品</a>';sTitle='<header class="head head_act"><span class="tag">换购</span><p class="title">购满1件，可用优惠价换购商品</p>'+actDesc+'</header>';}
for(var i=0;i<arrSelectedGif.length;i++){var item=arrSelectedGif[i];sTitle+='<div class="goods type_additional" attr-tag="jumpEvent" attr-href="//wqitem.jd.com/item/view?sku='+item.id+'"><i class="icon_select"></i><img class="image" src="//img10.360buyimg.com/n4/'+item.image
+'" width="75" height="75"><div class="name"><i class="mod_sign_tip bor"><span>换购商品</span></i> '+item.name
+'</div><p class="price">¥ <em class="int">'+fmtMoney(item.promoPrice).split('.')[0]+'</em>.'+fmtMoney(item.promoPrice).split('.')[1]
+'<span class="count">× '+item.num+'</span></p></div>';}
JD.report.rd('7014.19.1');return{title:sTitle}}
exports.getMzPromoteTitle=function(oSuit){var sTitle='',sGift='',actDesc='查看活动';var arrSelectedGif;if(oSuit.manGiftSkus&&oSuit.manGiftSkus.length>0)
{arrSelectedGif=oSuit.manGiftSkus.filter(function(element){return element.giftSelectState=="2";});}
if(oSuit.mfmzFullType==='106'){if(oSuit.isAchieved==='1'&&oSuit.checkType==1){sTitle+='满'+fmtMoney(oSuit.needMoney)+'元已减 '+fmtMoney(oSuit.promotion.manfan)+'元';if(oSuit.hitLevel==1){sTitle+='，减后满'+fmtMoney(oSuit.mzExtNeedMoney)+'元';}else if(oSuit.hitLevel==3){sTitle+='，减后已满'+fmtMoney(oSuit.mzExtNeedMoney)+'元';}
if(oSuit.addMoney>0){sTitle+='，可用优惠价换购商品';}else{sTitle+='，可领取赠品';}}else{sTitle+='满'+fmtMoney(oSuit.needMoney)+'元立减'+fmtMoney(oSuit.reward)+'元，减后满'+fmtMoney(oSuit.mzExtNeedMoney)+'元';if(oSuit.addMoney>0){sTitle+='，可用优惠价换购商品';}else{sTitle+='，可领取赠品';}}}else if(oSuit.mfmzFullType==='107'){if(oSuit.isAchieved==='1'&&oSuit.checkType==1){sTitle+='满'+oSuit.needNum+'件';if(oSuit.hitLevel==1){sTitle+='，已减'+fmtMoney(oSuit.promotion.manfan)+'元';}else if(oSuit.hitLevel==2){sTitle+='，打'+oSuit.rebate+'折';}else if(oSuit.hitLevel==3){sTitle+='，已减'+fmtMoney(oSuit.promotion.manfan)+'元';}
if(oSuit.addMoney>0){sTitle+='，可用优惠价换购商品';}else{sTitle+='，可领取赠品';}}else{sTitle+='满'+oSuit.needNum+'件打'+oSuit.rebate+'折';if(oSuit.needNum!=oSuit.mzExtNeedNum){sTitle+='，满'+oSuit.mzExtNeedNum+'件，';}
if(oSuit.addMoney>0){sTitle+='，可用优惠价换购商品';}else{sTitle+='，可领取赠品';}}}else if(oSuit.isAchieved==='1'&&oSuit.checkType==1){if(oSuit.needNum!='0'){sTitle+='已购满'+oSuit.needNum+'件';}else{sTitle+='已购满'+fmtMoney(oSuit.needMoney)+'元';}
if(oSuit.addMoney>0){sTitle+='，可用优惠价换购商品'+oSuit.canSelectedGiftNum+'件';actDesc='换购商品';}else{sTitle+='，可领取赠品'+oSuit.canSelectedGiftNum+'件';actDesc='领取赠品';}
if(arrSelectedGif&&arrSelectedGif.length>0){actDesc=oSuit.addMoney>0?'重新换购':'更换赠品';}
JD.report.rd('7014.2.41');}else{actDesc='去凑单';if(oSuit.addMoney>0&&oSuit.checkType==1){if(oSuit.needNum!=0){sTitle+='购满'+oSuit.needNum+'件即可享受满减，再加'+fmtMoney(oSuit.addMoney)+'元，即可换购商品';}else if(oSuit.mfmzFullType==108){sTitle+='购满'+fmtMoney(oSuit.needMoney)+'元，即可减钱、领取赠品';}else{sTitle+='购满'+fmtMoney(oSuit.needMoney)+'元，即可优惠价换购商品';if((oSuit.fullBalance*1>0)&&oSuit.checkType==1){sTitle+='，还差'+fmtMoney(oSuit.fullBalance*1)+'元';}}}else if(oSuit.needNum!=0){sTitle+='购满'+oSuit.needNum+'件';if(oSuit.addMoney>0){sTitle+='即可享受满减，再加'+fmtMoney(oSuit.addMoney)+'元，即可换购商品';}else{sTitle+='，可领取赠品，先到先得';}}else{sTitle+='购满'+fmtMoney(oSuit.needMoney)+'元，'+(oSuit.addMoney>0?'可用优惠价换购商品':'即可领取赠品');if((oSuit.fullBalance*1>0)&&oSuit.checkType==1){sTitle+='，还差'+fmtMoney(oSuit.fullBalance*1)+'元';}}}
sGift+=getGifts(oSuit,actDesc,sTitle,arrSelectedGif);sTitle=sGift.replace('{#event#}','//wq.jd.com/search/searchpr?activity_id='+oSuit.promotion.pid+'&promotion_aggregation=yes&pro_d='+getJiaJiaGouTitle(oSuit)+'&pro_s='+getPnote(oSuit));return{title:sTitle};}
exports.getMfPromoteTitle=function(oSuit){var sTitle='',actDesc='查看活动';if(oSuit.multiPromo=="8"){if(oSuit.isAchieved==='1'&&oSuit.checkType==1){sTitle+='已购满'+oSuit.needNum+'件，已减'+fmtMoney(oSuit.promotion.manfan)+'元';}else{sTitle+='购满'+oSuit.needNum+'件，可享受'+fmtMoney(oSuit.rebate)+'折';actDesc='去凑单';}}else if(oSuit.multiPromo=="7"){if(oSuit.isAchieved==='1'&&oSuit.checkType==1){sTitle+='已购满'+oSuit.needNum+'件，已减'+fmtMoney(oSuit.promotion.manfan)+'元';}else{sTitle+='购满'+oSuit.needNum+'件，可减价格最低'+oSuit.deliverNum+'件商品价格';actDesc='去凑单';}}else{if(oSuit.isAchieved==='1'&&oSuit.checkType==1){if(oSuit.needNum==='0'&&oSuit.NeedCategoryNum==='0'&&oSuit.moneyDeliverNum==='0'){sTitle+='已购满'+fmtMoney(oSuit.needMoney)+'元，已减'+fmtMoney(oSuit.promotion.manfan)+'元 ';}else if(oSuit.NeedCategoryNum!=='0'){sTitle+='购满'+oSuit.NeedCategoryNum+' 类、'+fmtMoney(oSuit.needMoney)+'元，';if(oSuit.maxSkuNumInPool>0)
sTitle+='每类最多'+oSuit.maxSkuNumInPool+'件';if(oSuit.minSkuNum>1){sTitle+='满'+oSuit.minSkuNum+'件';}
sTitle+='已减'+fmtMoney(oSuit.promotion.manfan)+'元';}else if(oSuit.needNum!='0'){sTitle+='已购满'+oSuit.needNum+'件，已减'+fmtMoney(oSuit.promotion.manfan)+'元';}else if(oSuit.moneyDeliverNum!='0'){sTitle+=fmtMoney(oSuit.needMoney)+'元可买'+oSuit.moneyDeliverNum+'件，已减'+fmtMoney(oSuit.promotion.manfan)+'元';}
sTitle+=getShipTxt(oSuit,1);}else{if(oSuit.NeedCategoryNum!='0'){sTitle+='购满'+oSuit.NeedCategoryNum+'类、'+fmtMoney(oSuit.needMoney)+'元，';if(oSuit.maxSkuNumInPool>0){sTitle+='每类最多'+oSuit.maxSkuNumInPool+'件';}
if(oSuit.minSkuNum>1){sTitle+='且不少于'+oSuit.minSkuNum+'件，';}
sTitle+='即可享受满减';}else if(oSuit.needNum!='0'){sTitle+='购满'+oSuit.needNum+'件，即可享受满减';}else if(oSuit.moneyDeliverNum!='0'){sTitle+=''+fmtMoney(oSuit.needMoney)+'元可买'+oSuit.moneyDeliverNum+'件';}else{sTitle+='购满'+fmtMoney(oSuit.needMoney)+'元'+(oSuit.reward>0&&oSuit.checkType==1?('，可减'+fmtMoney(oSuit.reward)+'元'):'，即可享受优惠');if((oSuit.fullBalance*1>0)&&oSuit.checkType==1){sTitle+='，还差'+fmtMoney(oSuit.fullBalance*1)+'元';}}
sTitle+=getShipTxt(oSuit,2);actDesc='去凑单';}}
sTitle='<p class="title">'+sTitle+'</p> <a class="btn" attr-href="{#event#}" attr-tag="jumpEvent" >'+actDesc+'</a>';sTitle=sTitle.replace('{#event#}',getActLink(oSuit));return{title:sTitle};}
function getActLink(oSuit){var promotionId=oSuit.promotion.pid;var actLink='';if(['1','7','8'].indexOf(oSuit.multiPromo)==-1||window._isApp){actLink='//wq.jd.com/search/searchpr?activity_id='+oSuit.promotion.pid+'&promotion_aggregation=yes&pro_d=满减&pro_s='+getPnote(oSuit);return actLink;}else{var data=window.promotionArr,iitem={},jitem={},promoItem={},nowTime=new Date().getTime();if(!data.length)return;for(var i=0,leni=data.length;i<leni;i++){iitem=data[i];if(!iitem||!iitem.id)continue;if(promotionId==iitem.id){jitem=iitem.list.filter(function(item){return~item.env.indexOf(_iswx?'1':'2')&&(nowTime>new Date(item.bdate).getTime()&&nowTime<new Date(item.edate));})[0];if(jitem&&jitem.url){actLink=jitem.url;}
break;}}
if(!actLink&&oSuit.actLinkUrl&&oSuit.actLinkUrl!="null"){if(ppms_grayControl&&ppms_grayControl.filter(function(e){return e.grayName=="promoUrlPpms"&&e.grayIsOpen=="1";}).length>0){var item=ppms_grayControl.filter(function(e){return e.grayName=="promoUrlPpms"&&e.grayIsOpen=="1";})[0],wid=getCookie("wq_uin")||getCookie('wg_uin');if(item&&grayFunc(wid,item.grayFil/100)){try{actLink=adverTransfer((oSuit.actLinkUrl||'').replace(/\s/g,''),true);}catch(e){}}}}
if(!actLink){actLink='//wq.jd.com/search/searchpr?activity_id='+oSuit.promotion.pid+'&promotion_aggregation=yes&pro_d=满减&pro_s='+getPnote(oSuit);}
return actLink;}}
function getShipTxt(oSuit,type){if(type===1){return oSuit.freeShipping==='1'?'已免邮':'';}else if(type===2){return oSuit.freeShipping==='1'?'、免邮':'';}}
function adverTransfer(ad,flag){if(!ad)return'';var urlReg=/^(https*:){0,1}\/\//,out='',transferUrl=function(url){if(!url)return'';if(!urlReg.test(url))return'';var jshopReg=/^(https*:){0,1}\/\/sale.jd.(com|hk)\/(wq\/|m\/|app\/){0,1}act\/\w{1,}.html/,outUrl='',itemReg=/^(https*:){0,1}\/\/item(.m){0,1}.jd.com\/(product\/){0,1}\d{1,}.html/,hkItemReg=/^(https*:){0,1}\/\/(item.jd.hk|m.hk.com)\/(product\/){0,1}\d{1,}.html/,wqReg=/^(https*:){0,1}\/\/(wqs|wq|wqitem|wqmitem|wqsou).jd.(com\/|hk\/)/,skuId='';if(wqReg.test(url)){outUrl=url.replace(/(https*:){0,1}/,'');}else if(jshopReg.test(url)){outUrl=url.replace(/(https*:){0,1}/,'');}else if(itemReg.test(url)||hkItemReg.test(url)){skuId=(url.match(/\d{1,}/)||[])[0];outUrl=(skuId>0?'//wqitem.jd.com/item/view?sku='+skuId:'');}
return outUrl;};flag=flag||urlReg.test(ad);if(flag){out=transferUrl(ad);}else{var linkReg=/<a([^>]+)href\s*=\s*"([^"]+)"(.*\/a>[，？。！：,\?\.!:]*)/ig,linkUrl='';out=ad.replace(/\\*'/ig,'"').replace(linkReg,function($0,$1,$2,$3){linkUrl=transferUrl($2);return(linkUrl?('<a'+$1+'href="'+linkUrl+'" '+$3).replace('_blank','_self'):'');});}
return out;}
function getJiaJiaGouTitle(oSuit){if(oSuit.addMoney>0){return'加价购';}else{return'满赠';}}
function getPnote(oSuit){var filPro={};if(oSuit.suits&&oSuit.suits.length&&oSuit.suits[0].selectPromotion){filPro=oSuit.suits[0].selectPromotion.filter(function(el){return el.pid==oSuit.promotion.pid;})[0]||{};}else if(oSuit.products&&oSuit.products.length&&oSuit.products[0].selectPromotion){filPro=oSuit.products[0].selectPromotion.filter(function(el){return el.pid==oSuit.promotion.pid;})[0]||{};}
return filPro.pnote?encodeURIComponent(filPro.pnote):'';}
function getGifts(oSuit,actDesc,sTitle,arrSelectedGif){var arrSelectedGif=arrSelectedGif||oSuit.manGiftSkus.filter(function(element){return element.giftSelectState=="2";}),sGiftHtml='',pid=oSuit.promotion.pid;if(oSuit.isAchieved=='1'&&oSuit.checkType==1){for(var i=0;i<arrSelectedGif.length;i++){var oCmdty=arrSelectedGif[i];sGiftHtml+='<div class="goods type_additional" attr-tag="jumpEvent" attr-href="//wqitem.jd.com/item/view?sku='+oCmdty.id+'" ><i class="icon_select"></i><img class="image" src="//img10.360buyimg.com/n4/'+oCmdty.image
+'" width="75" height="75"><div class="name"><i class="mod_sign_tip bor"><span>'+getJiaJiaGouTitle(oSuit)+'</span></i> '+oCmdty.name
+'</div><p class="price">¥ <em class="int">'+fmtMoney(oCmdty.promoPrice).split('.')[0]+'</em>.'+fmtMoney(oCmdty.promoPrice).split('.')[1]
+'<span class="count">× '+oCmdty.num+'</span></p></div>';}}
sGiftHtml='<header class="head head_act" id="mzgift_'+pid+'" ><span class="tag">'+getJiaJiaGouTitle(oSuit)+'</span><p class="title">'+sTitle+'</p><a class="btn" attr-href="{#event#}" attr-tag="jumpEvent" >'+actDesc+'</a></header>'+sGiftHtml;return sGiftHtml;}
function fmtMoney(sMoney){return(sMoney*1/100).toFixed(2);}});
define('q',function(require,exports,module){var __cacheThisModule__;!function(a){"use strict";if("function"==typeof bootstrap)bootstrap("promise",a);else if("object"==typeof exports&&"object"==typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=a}else{if("undefined"==typeof window&&"undefined"==typeof self)throw new Error("This environment was not anticipated by Q. Please file a bug.");var b="undefined"!=typeof window?window:self,c=b.Q;b.Q=a(),b.Q.noConflict=function(){return b.Q=c,this}}}(function(){"use strict";function a(a){return function(){return W.apply(a,arguments)}}function b(a){return a===Object(a)}function c(a){return"[object StopIteration]"===ca(a)||a instanceof S}function d(a,b){if(P&&b.stack&&"object"==typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(da)){for(var c=[],d=b;d;d=d.source)d.stack&&c.unshift(d.stack);c.unshift(a.stack);var f=c.join("\n"+da+"\n");a.stack=e(f)}}function e(a){for(var b=a.split("\n"),c=[],d=0;d<b.length;++d){var e=b[d];h(e)||f(e)||!e||c.push(e)}return c.join("\n")}function f(a){return-1!==a.indexOf("(module.js:")||-1!==a.indexOf("(node.js:")}function g(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b)return[b[1],Number(b[2])];var c=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a);if(c)return[c[1],Number(c[2])];var d=/.*@(.+):(\d+)$/.exec(a);return d?[d[1],Number(d[2])]:void 0}function h(a){var b=g(a);if(!b)return!1;var c=b[0],d=b[1];return c===R&&d>=T&&ia>=d}function i(){if(P)try{throw new Error}catch(a){var b=a.stack.split("\n"),c=b[0].indexOf("@")>0?b[1]:b[2],d=g(c);if(!d)return;return R=d[0],d[1]}}function j(a,b,c){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(b+" is deprecated, use "+c+" instead.",new Error("").stack),a.apply(a,arguments)}}function k(a){return a instanceof o?a:s(a)?B(a):A(a)}function l(){function a(a){b=a,f.source=a,Y(c,function(b,c){k.nextTick(function(){a.promiseDispatch.apply(a,c)})},void 0),c=void 0,d=void 0}var b,c=[],d=[],e=_(l.prototype),f=_(o.prototype);if(f.promiseDispatch=function(a,e,f){var g=X(arguments);c?(c.push(g),"when"===e&&f[1]&&d.push(f[1])):k.nextTick(function(){b.promiseDispatch.apply(b,g)})},f.valueOf=function(){if(c)return f;var a=q(b);return r(a)&&(b=a),a},f.inspect=function(){return b?b.inspect():{state:"pending"}},k.longStackSupport&&P)try{throw new Error}catch(g){f.stack=g.stack.substring(g.stack.indexOf("\n")+1)}return e.promise=f,e.resolve=function(c){b||a(k(c))},e.fulfill=function(c){b||a(A(c))},e.reject=function(c){b||a(z(c))},e.notify=function(a){b||Y(d,function(b,c){k.nextTick(function(){c(a)})},void 0)},e}function m(a){if("function"!=typeof a)throw new TypeError("resolver must be a function.");var b=l();try{a(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}return b.promise}function n(a){return m(function(b,c){for(var d=0,e=a.length;e>d;d++)k(a[d]).then(b,c)})}function o(a,b,c){void 0===b&&(b=function(a){return z(new Error("Promise does not support operation: "+a))}),void 0===c&&(c=function(){return{state:"unknown"}});var d=_(o.prototype);if(d.promiseDispatch=function(c,e,f){var g;try{g=a[e]?a[e].apply(d,f):b.call(d,e,f)}catch(h){g=z(h)}c&&c(g)},d.inspect=c,c){var e=c();"rejected"===e.state&&(d.exception=e.reason),d.valueOf=function(){var a=c();return"pending"===a.state||"rejected"===a.state?d:a.value}}return d}function p(a,b,c,d){return k(a).then(b,c,d)}function q(a){if(r(a)){var b=a.inspect();if("fulfilled"===b.state)return b.value}return a}function r(a){return a instanceof o}function s(a){return b(a)&&"function"==typeof a.then}function t(a){return r(a)&&"pending"===a.inspect().state}function u(a){return!r(a)||"fulfilled"===a.inspect().state}function v(a){return r(a)&&"rejected"===a.inspect().state}function w(){ea.length=0,fa.length=0,ha||(ha=!0)}function x(a,b){ha&&("object"==typeof process&&"function"==typeof process.emit&&k.nextTick.runAfter(function(){-1!==Z(fa,a)&&(process.emit("unhandledRejection",b,a),ga.push(a))}),fa.push(a),b&&"undefined"!=typeof b.stack?ea.push(b.stack):ea.push("(no stack) "+b))}function y(a){if(ha){var b=Z(fa,a);-1!==b&&("object"==typeof process&&"function"==typeof process.emit&&k.nextTick.runAfter(function(){var c=Z(ga,a);-1!==c&&(process.emit("rejectionHandled",ea[b],a),ga.splice(c,1))}),fa.splice(b,1),ea.splice(b,1))}}function z(a){var b=o({when:function(b){return b&&y(this),b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});return x(b,a),b}function A(a){return o({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return ba(a)}},void 0,function(){return{state:"fulfilled",value:a}})}function B(a){var b=l();return k.nextTick(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}}),b.promise}function C(a){return o({isDef:function(){}},function(b,c){return I(a,b,c)},function(){return k(a).inspect()})}function D(a,b,c){return k(a).spread(b,c)}function E(a){return function(){function b(a,b){var g;if("undefined"==typeof StopIteration){try{g=d[a](b)}catch(h){return z(h)}return g.done?k(g.value):p(g.value,e,f)}try{g=d[a](b)}catch(h){return c(h)?k(h.value):z(h)}return p(g,e,f)}var d=a.apply(this,arguments),e=b.bind(b,"next"),f=b.bind(b,"throw");return e()}}function F(a){k.done(k.async(a)())}function G(a){throw new S(a)}function H(a){return function(){return D([this,J(arguments)],function(b,c){return a.apply(b,c)})}}function I(a,b,c){return k(a).dispatch(b,c)}function J(a){return p(a,function(a){var b=0,c=l();return Y(a,function(d,e,f){var g;r(e)&&"fulfilled"===(g=e.inspect()).state?a[f]=g.value:(++b,p(e,function(d){a[f]=d,0===--b&&c.resolve(a)},c.reject,function(a){c.notify({index:f,value:a})}))},void 0),0===b&&c.resolve(a),c.promise})}function K(a){if(0===a.length)return k.resolve();var b=k.defer(),c=0;return Y(a,function(d,e,f){function g(a){b.resolve(a)}function h(){c--,0===c&&b.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))}function i(a){b.notify({index:f,value:a})}var j=a[f];c++,p(j,g,h,i)},void 0),b.promise}function L(a){return p(a,function(a){return a=$(a,k),p(J($(a,function(a){return p(a,U,U)})),function(){return a})})}function M(a){return k(a).allSettled()}function N(a,b){return k(a).then(void 0,void 0,b)}function O(a,b){return k(a).nodeify(b)}var P=!1;try{throw new Error}catch(Q){P=!!Q.stack}var R,S,T=i(),U=function(){},V=function(){function a(){for(var a,d;c.next;)c=c.next,a=c.task,c.task=void 0,d=c.domain,d&&(c.domain=void 0,d.enter()),b(a,d);for(;h.length;)a=h.pop(),b(a);e=!1}function b(b,c){try{b()}catch(d){if(g)throw c&&c.exit(),setTimeout(a,0),c&&c.enter(),d;setTimeout(function(){throw d},0)}c&&c.exit()}var c={task:void 0,next:null},d=c,e=!1,f=void 0,g=!1,h=[];if(V=function(a){d=d.next={task:a,domain:g&&process.domain,next:null},e||(e=!0,f())},"object"==typeof process&&"[object process]"===process.toString()&&process.nextTick)g=!0,f=function(){process.nextTick(a)};else if("function"==typeof setImmediate)f="undefined"!=typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!=typeof MessageChannel){var i=new MessageChannel;i.port1.onmessage=function(){f=j,i.port1.onmessage=a,a()};var j=function(){i.port2.postMessage(0)};f=function(){setTimeout(a,0),j()}}else f=function(){setTimeout(a,0)};return V.runAfter=function(a){h.push(a),e||(e=!0,f())},V}(),W=Function.call,X=a(Array.prototype.slice),Y=a(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length)for(;;){if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError}for(;d>c;c++)c in this&&(b=a(b,this[c],c));return b}),Z=a(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),$=a(Array.prototype.map||function(a,b){var c=this,d=[];return Y(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0),d}),_=Object.create||function(a){function b(){}return b.prototype=a,new b},aa=a(Object.prototype.hasOwnProperty),ba=Object.keys||function(a){var b=[];for(var c in a)aa(a,c)&&b.push(c);return b},ca=a(Object.prototype.toString);S="undefined"!=typeof ReturnValue?ReturnValue:function(a){this.value=a};var da="From previous event:";k.resolve=k,k.nextTick=V,k.longStackSupport=!1,"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(k.longStackSupport=!0),k.defer=l,l.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):arguments.length>2?a.resolve(X(arguments,1)):a.resolve(c)}},k.Promise=m,k.promise=m,m.race=n,m.all=J,m.reject=z,m.resolve=k,k.passByCopy=function(a){return a},o.prototype.passByCopy=function(){return this},k.join=function(a,b){return k(a).join(b)},o.prototype.join=function(a){return k([this,a]).spread(function(a,b){if(a===b)return a;throw new Error("Can't join: not the same: "+a+" "+b)})},k.race=n,o.prototype.race=function(){return this.then(k.race)},k.makePromise=o,o.prototype.toString=function(){return"[object Promise]"},o.prototype.then=function(a,b,c){function e(b){try{return"function"==typeof a?a(b):b}catch(c){return z(c)}}function f(a){if("function"==typeof b){d(a,h);try{return b(a)}catch(c){return z(c)}}return z(a)}function g(a){return"function"==typeof c?c(a):a}var h=this,i=l(),j=!1;return k.nextTick(function(){h.promiseDispatch(function(a){j||(j=!0,i.resolve(e(a)))},"when",[function(a){j||(j=!0,i.resolve(f(a)))}])}),h.promiseDispatch(void 0,"when",[void 0,function(a){var b,c=!1;try{b=g(a)}catch(d){if(c=!0,!k.onerror)throw d;k.onerror(d)}c||i.notify(b)}]),i.promise},k.tap=function(a,b){return k(a).tap(b)},o.prototype.tap=function(a){return a=k(a),this.then(function(b){return a.fcall(b).thenResolve(b)})},k.when=p,o.prototype.thenResolve=function(a){return this.then(function(){return a})},k.thenResolve=function(a,b){return k(a).thenResolve(b)},o.prototype.thenReject=function(a){return this.then(function(){throw a})},k.thenReject=function(a,b){return k(a).thenReject(b)},k.nearer=q,k.isPromise=r,k.isPromiseAlike=s,k.isPending=t,o.prototype.isPending=function(){return"pending"===this.inspect().state},k.isFulfilled=u,o.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},k.isRejected=v,o.prototype.isRejected=function(){return"rejected"===this.inspect().state};var ea=[],fa=[],ga=[],ha=!0;k.resetUnhandledRejections=w,k.getUnhandledReasons=function(){return ea.slice()},k.stopUnhandledRejectionTracking=function(){w(),ha=!1},w(),k.reject=z,k.fulfill=A,k.master=C,k.spread=D,o.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,b)},b)},k.async=E,k.spawn=F,k["return"]=G,k.promised=H,k.dispatch=I,o.prototype.dispatch=function(a,b){var c=this,d=l();return k.nextTick(function(){c.promiseDispatch(d.resolve,a,b)}),d.promise},k.get=function(a,b){return k(a).dispatch("get",[b])},o.prototype.get=function(a){return this.dispatch("get",[a])},k.set=function(a,b,c){return k(a).dispatch("set",[b,c])},o.prototype.set=function(a,b){return this.dispatch("set",[a,b])},k.del=k["delete"]=function(a,b){return k(a).dispatch("delete",[b])},o.prototype.del=o.prototype["delete"]=function(a){return this.dispatch("delete",[a])},k.mapply=k.post=function(a,b,c){return k(a).dispatch("post",[b,c])},o.prototype.mapply=o.prototype.post=function(a,b){return this.dispatch("post",[a,b])},k.send=k.mcall=k.invoke=function(a,b){return k(a).dispatch("post",[b,X(arguments,2)])},o.prototype.send=o.prototype.mcall=o.prototype.invoke=function(a){return this.dispatch("post",[a,X(arguments,1)])},k.fapply=function(a,b){return k(a).dispatch("apply",[void 0,b])},o.prototype.fapply=function(a){return this.dispatch("apply",[void 0,a])},k["try"]=k.fcall=function(a){return k(a).dispatch("apply",[void 0,X(arguments,1)])},o.prototype.fcall=function(){return this.dispatch("apply",[void 0,X(arguments)])},k.fbind=function(a){var b=k(a),c=X(arguments,1);return function(){return b.dispatch("apply",[this,c.concat(X(arguments))])}},o.prototype.fbind=function(){var a=this,b=X(arguments);return function(){return a.dispatch("apply",[this,b.concat(X(arguments))])}},k.keys=function(a){return k(a).dispatch("keys",[])},o.prototype.keys=function(){return this.dispatch("keys",[])},k.all=J,o.prototype.all=function(){return J(this)},k.any=K,o.prototype.any=function(){return K(this)},k.allResolved=j(L,"allResolved","allSettled"),o.prototype.allResolved=function(){return L(this)},k.allSettled=M,o.prototype.allSettled=function(){return this.then(function(a){return J($(a,function(a){function b(){return a.inspect()}return a=k(a),a.then(b,b)}))})},k.fail=k["catch"]=function(a,b){return k(a).then(void 0,b)},o.prototype.fail=o.prototype["catch"]=function(a){return this.then(void 0,a)},k.progress=N,o.prototype.progress=function(a){return this.then(void 0,void 0,a)},k.fin=k["finally"]=function(a,b){return k(a)["finally"](b)},o.prototype.fin=o.prototype["finally"]=function(a){if(!a||"function"!=typeof a.apply)throw new Error("Can't apply finally callback");return a=k(a),this.then(function(b){return a.fcall().then(function(){return b})},function(b){return a.fcall().then(function(){throw b})})},k.done=function(a,b,c,d){return k(a).done(b,c,d)},o.prototype.done=function(a,b,c){var e=function(a){k.nextTick(function(){if(d(a,f),!k.onerror)throw a;k.onerror(a)})},f=a||b||c?this.then(a,b,c):this;"object"==typeof process&&process&&process.domain&&(e=process.domain.bind(e)),f.then(void 0,e)},k.timeout=function(a,b,c){return k(a).timeout(b,c)},o.prototype.timeout=function(a,b){var c=l(),d=setTimeout(function(){b&&"string"!=typeof b||(b=new Error(b||"Timed out after "+a+" ms"),b.code="ETIMEDOUT"),c.reject(b)},a);return this.then(function(a){clearTimeout(d),c.resolve(a)},function(a){clearTimeout(d),c.reject(a)},c.notify),c.promise},k.delay=function(a,b){return void 0===b&&(b=a,a=void 0),k(a).delay(b)},o.prototype.delay=function(a){return this.then(function(b){var c=l();return setTimeout(function(){c.resolve(b)},a),c.promise})},k.nfapply=function(a,b){return k(a).nfapply(b)},o.prototype.nfapply=function(a){var b=l(),c=X(a);return c.push(b.makeNodeResolver()),this.fapply(c).fail(b.reject),b.promise},k.nfcall=function(a){var b=X(arguments,1);return k(a).nfapply(b)},o.prototype.nfcall=function(){var a=X(arguments),b=l();return a.push(b.makeNodeResolver()),this.fapply(a).fail(b.reject),b.promise},k.nfbind=k.denodeify=function(a){var b=X(arguments,1);return function(){var c=b.concat(X(arguments)),d=l();return c.push(d.makeNodeResolver()),k(a).fapply(c).fail(d.reject),d.promise}},o.prototype.nfbind=o.prototype.denodeify=function(){var a=X(arguments);return a.unshift(this),k.denodeify.apply(void 0,a)},k.nbind=function(a,b){var c=X(arguments,2);return function(){function d(){return a.apply(b,arguments)}var e=c.concat(X(arguments)),f=l();return e.push(f.makeNodeResolver()),k(d).fapply(e).fail(f.reject),f.promise}},o.prototype.nbind=function(){var a=X(arguments,0);return a.unshift(this),k.nbind.apply(void 0,a)},k.nmapply=k.npost=function(a,b,c){return k(a).npost(b,c)},o.prototype.nmapply=o.prototype.npost=function(a,b){var c=X(b||[]),d=l();return c.push(d.makeNodeResolver()),this.dispatch("post",[a,c]).fail(d.reject),d.promise},k.nsend=k.nmcall=k.ninvoke=function(a,b){var c=X(arguments,2),d=l();return c.push(d.makeNodeResolver()),k(a).dispatch("post",[b,c]).fail(d.reject),d.promise},o.prototype.nsend=o.prototype.nmcall=o.prototype.ninvoke=function(a){var b=X(arguments,1),c=l();return b.push(c.makeNodeResolver()),this.dispatch("post",[a,b]).fail(c.reject),c.promise},k.nodeify=O,o.prototype.nodeify=function(a){return a?void this.then(function(b){k.nextTick(function(){a(null,b)})},function(b){k.nextTick(function(){a(b)})}):this},k.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var ia=i();return k});});
define("report",function(require,exports,module){var _cacheThisModule_;var REPORT_VERSON='1.1',goodsExposureList=[],logJSONList=[];function extend(target,source){for(var key in source){target[key]=source[key];}}
function $getCookie(name){var reg=new RegExp("(^| )"+name+"(?:=([^;]*))?(;|$)"),val=document.cookie.match(reg);return val?(val[2]?unescape(val[2]):""):null;}
function pvReport(bjInfo,szInfo){try{window.MANUAL_PV=true;if(!bjInfo){return;}
if(!(window.ECC_cloud_report_pv&&FOOTDETECT&&FOOTDETECT.objMsgPv)){setTimeout(function(){pvReport(bjInfo,szInfo);},50);return;}
var objData={};extend(objData,FOOTDETECT.objMsgPv||{});if(bjInfo.vurl){if(bjInfo.vurl.indexOf("http")==-1){bjInfo.vurl=window.location.protocol+bjInfo.vurl;}
extend(objData,bjInfo);window._vurl=bjInfo.vurl;ECC.cloud.report.pvPortal(objData);}else{if(szInfo){window.jdPvLog(bjInfo);extend(objData,szInfo);ECC.cloud.report.pv(objData);}else{window.jdPvLog(bjInfo);extend(objData,bjInfo);ECC.cloud.report.pv(objData);}}}catch(e){}}
function pvPortal(vurl){if(typeof vurl!='string'){return;}
var ptag=/[&?]ptag=([^&#]*)/gi.exec(vurl);ptag=ptag?ptag[1]:'';pvReport({vurl:vurl,ptag:ptag});}
function logJSON(obj){function task(){if(!task.hasInit){task.counter=setInterval(function(){if(window.ECC_cloud_report_pv){if(!logJSONList.length){clearInterval(task.counter);task.counter=0;return;}
var data=logJSONList.shift();log(data);}},40);task.hasInit=true;}}
function log(data){var mark='wg_wx.000002';data.mark&&(mark=data.mark,delete data.mark);window.ja&&window.ja.logJSON(mark,REPORT_VERSON,data);}
if(window.ECC_cloud_report_pv){log(obj);}else{if(!obj||({}).toString.call(obj)!='[object Object]'){return;}
logJSONList.push(obj);task();}}
function setCookiePtag(ptag){if(!window.ECC_cloud_report_pv){setTimeout(function(){setCookiePtag(ptag);},100);return;}
setTimeout(function(){ECC.cloud.report.synCookiePtag({ptag:ptag,notNeedPvReport:true});},200);}
function getPPRD_PValue(prefix){var regs={QZGDT:/QZGDT\.([^\.\-]+)/gim,QZZTC:/QZZTC\.([^\.\-]+)/gim,ADKEY:/ADKEY\.([^\.\-]+)/gim,WQVERSION:/WQVERSION\.([^\.\-]+)/gim},pprd_p=$getCookie('PPRD_P')||'',paramIsArr=Array.isArray(prefix),str='',rs={};prefix=paramIsArr?prefix:[prefix];pprd_p&&prefix.forEach(function(elem){if(regs[elem]&&regs[elem].test(pprd_p)){rs[elem]=RegExp.$1||'';}});return paramIsArr?rs:rs[prefix[0]];}
function logGoodsExposure(ptags){function task(){if(!logGoodsExposure.hasInit){logGoodsExposure.counter=setInterval(function(){if(window.ECC_cloud_report_pv){clearInterval(logGoodsExposure.counter);logGoodsExposure.counter=0;log();}},80);logGoodsExposure.hasInit=true;}}
function log(){if(!goodsExposureList.length){return;}
window.ja&&window.ja.logGoodsExposure(goodsExposureList.join('_'));logGoodsExposure.goodsExposureList=goodsExposureList=[];}
if(!ptags){return;}!logGoodsExposure.goodsExposureList&&(logGoodsExposure.goodsExposureList=[]);!Array.isArray(ptags)&&(ptags=[ptags]);var goodsExposureList=logGoodsExposure.goodsExposureList;[].push.apply(goodsExposureList,ptags);if(window.ECC_cloud_report_pv){log();}else{task();}}
function logShopJSON(data){data=data||{};data.mark='wg_wx.000004';logJSON(data);}
function trace(data){if(!window.ECC_cloud_report_pv){return;}
window.ja&&window.ja.trace(data);}
function skuRecomExposure(obj){if(!skuRecomExposure.datas){skuRecomExposure.datas=[];}
obj&&skuRecomExposure.datas.push(obj);if(!window.ECC_cloud_report_pv){skuRecomExposure.timer=setTimeout(function(){skuRecomExposure();},200);}else{skuRecomExposure.timer&&clearTimeout(skuRecomExposure.timer);skuRecomExposure.timer=null;while(obj=skuRecomExposure.datas.pop()){window.ja&&window.ja.skuRecomExposure&&window.ja.skuRecomExposure(obj);}}}
function guessyoulikeReport(obj){if(!guessyoulikeReport.datas){guessyoulikeReport.datas=[];}
obj&&guessyoulikeReport.datas.push(obj);if(!window.ECC_cloud_report_pv){guessyoulikeReport.timer=setTimeout(function(){guessyoulikeReport();},200);}else{guessyoulikeReport.timer&&clearTimeout(guessyoulikeReport.timer);guessyoulikeReport.timer=null;while(obj=guessyoulikeReport.datas.pop()){window.ja&&window.ja.guessyoulikeReport&&window.ja.guessyoulikeReport(obj);}}}
exports.pvReport=pvReport;exports.pvPortal=pvPortal;exports.trace=trace;exports.logJSON=logJSON;exports.logGoodsExposure=logGoodsExposure;exports.logShopJSON=logShopJSON;exports.setCookiePtag=setCookiePtag;exports.getADKEY=function(){return getPPRD_PValue('ADKEY')||'';}
exports.skuRecomExposure=skuRecomExposure;exports.guessyoulikeReport=guessyoulikeReport;});
define('login',function(require,exports,module){var _cacheThisModule_;exports.isLogin=isLogin;exports.validateLogin=function(callback){if(!isLogin()){callback(false);return true;}
validateLogin(callback);}
exports.login=login;function isLogin(){return getWqUin()&&getWqSkey();}
function validateLogin(callback){window.validateLoginCallback=function(data){callback(data.iRet!=9999)}
JD.sendJs("//wq.jd.com/mlogin/wxv3/LoginCheckJsonp?callback=validateLoginCallback&_t="+Math.random());}
function login(opt){var option={env:getEnv(),scope:false,rurl:location.href};for(var i in opt){option[i]=opt[i];}
if(!/^\/\/|^http(?:s?):\/\//.test(option.rurl)){option.rurl=location.href;}
option.rurl=option.rurl.replace(/^http(?:s?):\/\//,"//");option.rurl=location.protocol+option.rurl;if(option.env=="weixin"){var rurl="//wq.jd.com/mlogin/wxv3/login_BJ?rurl="+encodeURIComponent(option.rurl)+"&appid=1"+(option.scope?"&scope=snsapi_userinfo":"");location.href=rurl;setTimeout(function(){location.href=rurl;},1000)
return true;}
else if(window.WQAPI&&option.env=="ycapp"){WQAPI.user.login(function(){if(option.rurl){if(option.rurl==location.href){location.reload();}
else{location.href=option.rurl.replace(/^http(s?):/,"");}}});}
else if(option.env=="jdapp"){var rurl="//wq.jd.com/mlogin/mpage/Login?rurl="+encodeURIComponent(option.rurl);location.href=rurl;setTimeout(function(){location.href=rurl;},1000);}
else{if(getUrlParam("_mlogin")&&option.env!="qq"){var rurl="//wq.jd.com/mlogin/mpage/Login?rurl="+encodeURIComponent(option.rurl);}else{var rurl="//wq.jd.com/mlogin/h5v1/cpLogin_BJ?rurl="+encodeURIComponent(option.rurl);}
location.href=rurl;setTimeout(function(){location.href=rurl;},1000);}}
function getUrlParam(name,url){var u=arguments[1]||window.location.search,reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)",'i'),r=u.substr(u.indexOf("\?")+1).match(reg);return r!=null?r[2]:"";}
function getWqUin(){return getCookie("wq_uin");}
function getWqSkey(){return getCookie("wq_skey");}
function getCookie(name){var reg=new RegExp("(^| )"+name+"(?:=([^;]*))?(;|$)"),val=document.cookie.match(reg);return val?(val[2]?unescape(val[2]):""):null;}
function getEnv(){var ua=navigator.userAgent.toLowerCase();if(/micromessenger(\/[\d\.]+)*/.test(ua)){return"weixin";}else if(/qq\/(\/[\d\.]+)*/.test(ua)||/qzone\//.test(ua)){return"qq";}else if(/jzyc/.test(ua)){return"ycapp";}else if(/jdapp;/.test(ua)){return"jdapp";}else{return"h5";}}});
define('scrollCtrl',function(require,exports,module){var _cacheThisModule_;function throttle(delay,action,tail,debounce){var now=Date.now,last_call=0,last_exec=0,timer=null,curr,diff,ctx,args,exec=function(){last_exec=now();action.apply(ctx,args);};return function(){ctx=this,args=arguments,curr=now(),diff=curr-(debounce?last_call:last_exec)-delay;clearTimeout(timer);if(debounce){if(tail){timer=setTimeout(exec,delay);}else if(diff>=0){exec();}}else{if(diff>=0){exec();}else if(tail){timer=setTimeout(exec,-diff);}}
last_call=curr;}}
function scrollCtrl(context){var _guid=(new Date()).getTime(),_items={},_fix=window.screen.height,_activeTypes={'beforeTop':1,'beforeBottom':2,'all':0},me=this,isArray=Array.isArray||function(object){return object instanceof Array};!context&&(context=document.body);this.on=function(objs,activeType,callback){if(!arguments[2]){callback=arguments[1];activeType=null;}
if(arguments[0].length==undefined){objs=[arguments[0]];}
if(objs.pos){_items[_guid++]={target:objs,callback:callback,enable:true,activeType:activeType||'all'}}else{for(var i=0;i<objs.length;i++){var obj=objs[i],key=obj.id||(_guid++);obj.setAttribute('attr-autoload',1);_items[key]={target:obj,callback:callback,enable:true,activeType:activeType||'all'}}}
this.watch();};this.watch=function(){var pageHeight=document.documentElement.clientHeight,pageTop=$(context).scrollTop(),pageBottom=pageHeight+pageTop;for(var key in _items){var item=_items[key];if(!item||(item.enable!==true))continue;var target,offset,itemTop,itemBottom;if(item.target.pos){itemTop=item.target[0];itemBottom=item.target[1];}else{target=$(item.target),offset=target.offset(),itemTop=offset.top+(context==document.body?0:pageTop),itemBottom=itemTop+offset.height;}
itemTop-=_fix;itemBottom+=_fix;if(this.checkIsInScreen(itemTop,itemBottom,pageTop,pageBottom,item.activeType)){if(item.enable===true){delete _items[key];}
item.callback.apply(item.target,[item]);item.target.removeAttribute('attr-autoload');}}};this.checkIsInScreen=function(itemTop,itemBottom,pageTop,pageBottom,activeType){if(activeType==='all'){if((itemTop<pageBottom&&itemTop>pageTop)||(itemBottom<pageBottom&&itemBottom>pageTop)){return true;}else if(itemTop<pageTop&&itemBottom>pageBottom){return true;}}else if(activeType==='beforeTop'&&itemBottom>pageTop){return true;}else if(activeType==='beforeBottom'&&itemTop<pageBottom){return true;}
return false;};this.clear=function(){_items={};};$(!context||context===document.body?document:context).on('scroll',throttle(80,function(){me.watch();},true));};exports.init=function(context){return new scrollCtrl(context);}});
define('md5',function(require,exports,module){var _cacheThisModule_;exports.getHash=getHash;var rotateLeft=function(lValue,iShiftBits){return(lValue<<iShiftBits)|(lValue>>>(32-iShiftBits));}
var addUnsigned=function(lX,lY){var lX4,lY4,lX8,lY8,lResult;lX8=(lX&0x80000000);lY8=(lY&0x80000000);lX4=(lX&0x40000000);lY4=(lY&0x40000000);lResult=(lX&0x3FFFFFFF)+(lY&0x3FFFFFFF);if(lX4&lY4)return(lResult^0x80000000^lX8^lY8);if(lX4|lY4){if(lResult&0x40000000)return(lResult^0xC0000000^lX8^lY8);else return(lResult^0x40000000^lX8^lY8);}else{return(lResult^lX8^lY8);}}
var F=function(x,y,z){return(x&y)|((~x)&z);}
var G=function(x,y,z){return(x&z)|(y&(~z));}
var H=function(x,y,z){return(x^y^z);}
var I=function(x,y,z){return(y^(x|(~z)));}
var FF=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(F(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b);};var GG=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(G(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b);};var HH=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(H(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b);};var II=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(I(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b);};var convertToWordArray=function(string){var lWordCount;var lMessageLength=string.length;var lNumberOfWordsTempOne=lMessageLength+8;var lNumberOfWordsTempTwo=(lNumberOfWordsTempOne-(lNumberOfWordsTempOne%64))/64;var lNumberOfWords=(lNumberOfWordsTempTwo+1)*16;var lWordArray=Array(lNumberOfWords-1);var lBytePosition=0;var lByteCount=0;while(lByteCount<lMessageLength){lWordCount=(lByteCount-(lByteCount%4))/4;lBytePosition=(lByteCount%4)*8;lWordArray[lWordCount]=(lWordArray[lWordCount]|(string.charCodeAt(lByteCount)<<lBytePosition));lByteCount++;}
lWordCount=(lByteCount-(lByteCount%4))/4;lBytePosition=(lByteCount%4)*8;lWordArray[lWordCount]=lWordArray[lWordCount]|(0x80<<lBytePosition);lWordArray[lNumberOfWords-2]=lMessageLength<<3;lWordArray[lNumberOfWords-1]=lMessageLength>>>29;return lWordArray;};var wordToHex=function(lValue){var WordToHexValue="",WordToHexValueTemp="",lByte,lCount;for(lCount=0;lCount<=3;lCount++){lByte=(lValue>>>(lCount*8))&255;WordToHexValueTemp="0"+lByte.toString(16);WordToHexValue=WordToHexValue+WordToHexValueTemp.substr(WordToHexValueTemp.length-2,2);}
return WordToHexValue;};var uTF8Encode=function(string){string=string.replace(/\x0d\x0a/g,"\x0a");var output="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){output+=String.fromCharCode(c);}else if((c>127)&&(c<2048)){output+=String.fromCharCode((c>>6)|192);output+=String.fromCharCode((c&63)|128);}else{output+=String.fromCharCode((c>>12)|224);output+=String.fromCharCode(((c>>6)&63)|128);output+=String.fromCharCode((c&63)|128);}}
return output;};function getHash(string){var x=Array();var k,AA,BB,CC,DD,a,b,c,d;var S11=7,S12=12,S13=17,S14=22;var S21=5,S22=9,S23=14,S24=20;var S31=4,S32=11,S33=16,S34=23;var S41=6,S42=10,S43=15,S44=21;string=uTF8Encode(string);x=convertToWordArray(string);a=0x67452301;b=0xEFCDAB89;c=0x98BADCFE;d=0x10325476;for(k=0;k<x.length;k+=16){AA=a;BB=b;CC=c;DD=d;a=FF(a,b,c,d,x[k+0],S11,0xD76AA478);d=FF(d,a,b,c,x[k+1],S12,0xE8C7B756);c=FF(c,d,a,b,x[k+2],S13,0x242070DB);b=FF(b,c,d,a,x[k+3],S14,0xC1BDCEEE);a=FF(a,b,c,d,x[k+4],S11,0xF57C0FAF);d=FF(d,a,b,c,x[k+5],S12,0x4787C62A);c=FF(c,d,a,b,x[k+6],S13,0xA8304613);b=FF(b,c,d,a,x[k+7],S14,0xFD469501);a=FF(a,b,c,d,x[k+8],S11,0x698098D8);d=FF(d,a,b,c,x[k+9],S12,0x8B44F7AF);c=FF(c,d,a,b,x[k+10],S13,0xFFFF5BB1);b=FF(b,c,d,a,x[k+11],S14,0x895CD7BE);a=FF(a,b,c,d,x[k+12],S11,0x6B901122);d=FF(d,a,b,c,x[k+13],S12,0xFD987193);c=FF(c,d,a,b,x[k+14],S13,0xA679438E);b=FF(b,c,d,a,x[k+15],S14,0x49B40821);a=GG(a,b,c,d,x[k+1],S21,0xF61E2562);d=GG(d,a,b,c,x[k+6],S22,0xC040B340);c=GG(c,d,a,b,x[k+11],S23,0x265E5A51);b=GG(b,c,d,a,x[k+0],S24,0xE9B6C7AA);a=GG(a,b,c,d,x[k+5],S21,0xD62F105D);d=GG(d,a,b,c,x[k+10],S22,0x2441453);c=GG(c,d,a,b,x[k+15],S23,0xD8A1E681);b=GG(b,c,d,a,x[k+4],S24,0xE7D3FBC8);a=GG(a,b,c,d,x[k+9],S21,0x21E1CDE6);d=GG(d,a,b,c,x[k+14],S22,0xC33707D6);c=GG(c,d,a,b,x[k+3],S23,0xF4D50D87);b=GG(b,c,d,a,x[k+8],S24,0x455A14ED);a=GG(a,b,c,d,x[k+13],S21,0xA9E3E905);d=GG(d,a,b,c,x[k+2],S22,0xFCEFA3F8);c=GG(c,d,a,b,x[k+7],S23,0x676F02D9);b=GG(b,c,d,a,x[k+12],S24,0x8D2A4C8A);a=HH(a,b,c,d,x[k+5],S31,0xFFFA3942);d=HH(d,a,b,c,x[k+8],S32,0x8771F681);c=HH(c,d,a,b,x[k+11],S33,0x6D9D6122);b=HH(b,c,d,a,x[k+14],S34,0xFDE5380C);a=HH(a,b,c,d,x[k+1],S31,0xA4BEEA44);d=HH(d,a,b,c,x[k+4],S32,0x4BDECFA9);c=HH(c,d,a,b,x[k+7],S33,0xF6BB4B60);b=HH(b,c,d,a,x[k+10],S34,0xBEBFBC70);a=HH(a,b,c,d,x[k+13],S31,0x289B7EC6);d=HH(d,a,b,c,x[k+0],S32,0xEAA127FA);c=HH(c,d,a,b,x[k+3],S33,0xD4EF3085);b=HH(b,c,d,a,x[k+6],S34,0x4881D05);a=HH(a,b,c,d,x[k+9],S31,0xD9D4D039);d=HH(d,a,b,c,x[k+12],S32,0xE6DB99E5);c=HH(c,d,a,b,x[k+15],S33,0x1FA27CF8);b=HH(b,c,d,a,x[k+2],S34,0xC4AC5665);a=II(a,b,c,d,x[k+0],S41,0xF4292244);d=II(d,a,b,c,x[k+7],S42,0x432AFF97);c=II(c,d,a,b,x[k+14],S43,0xAB9423A7);b=II(b,c,d,a,x[k+5],S44,0xFC93A039);a=II(a,b,c,d,x[k+12],S41,0x655B59C3);d=II(d,a,b,c,x[k+3],S42,0x8F0CCC92);c=II(c,d,a,b,x[k+10],S43,0xFFEFF47D);b=II(b,c,d,a,x[k+1],S44,0x85845DD1);a=II(a,b,c,d,x[k+8],S41,0x6FA87E4F);d=II(d,a,b,c,x[k+15],S42,0xFE2CE6E0);c=II(c,d,a,b,x[k+6],S43,0xA3014314);b=II(b,c,d,a,x[k+13],S44,0x4E0811A1);a=II(a,b,c,d,x[k+4],S41,0xF7537E82);d=II(d,a,b,c,x[k+11],S42,0xBD3AF235);c=II(c,d,a,b,x[k+2],S43,0x2AD7D2BB);b=II(b,c,d,a,x[k+9],S44,0xEB86D391);a=addUnsigned(a,AA);b=addUnsigned(b,BB);c=addUnsigned(c,CC);d=addUnsigned(d,DD);}
var tempValue=wordToHex(a)+wordToHex(b)+wordToHex(c)+wordToHex(d);return tempValue.toLowerCase();}});
define("cookie",function(require,exports,module){var _cacheThisModule_;exports.get=getCookie;exports.set=setCookie;exports.del=delCookie;function getCookie(name){var reg=new RegExp("(^| )"+name+"(?:=([^;]*))?(;|$)"),val=document.cookie.match(reg);if(!val||!val[2]){return"";}
var res=val[2];try{if(/(%[0-9A-F]{2}){2,}/.test(res)){return decodeURIComponent(res);}else{return unescape(res);}}catch(e){return unescape(res);}}
function setCookie(name,value,expires,path,domain,secure){var exp=new Date(),expires=arguments[2]||null,path=arguments[3]||"/",domain=arguments[4]||null,secure=arguments[5]||false;expires?exp.setMinutes(exp.getMinutes()+parseInt(expires)):"";document.cookie=name+'='+escape(value)+(expires?';expires='+exp.toGMTString():'')+(path?';path='+path:'')+(domain?';domain='+domain:'')+(secure?';secure':'');}
function delCookie(name,path,domain,secure){var value=getCookie(name);if(value!=null){var exp=new Date();exp.setMinutes(exp.getMinutes()-1000);path=path||"/";document.cookie=name+'=;expires='+exp.toGMTString()+(path?';path='+path:'')+(domain?';domain='+domain:'')+(secure?';secure':'');}}});
define('loadJs',function(require,exports,module){var _cacheThisModule_;var ck=require('cookie');var callbackNameCount={},letterMap=['Z','A','B','C','D','E','F','G','H','I'];function transToLetter(num){var arr=(num+'').split(''),v=[];for(var i=0;i<arr.length;i++){v.push(letterMap[arr[i]])}
return v.join('');}
function callbackNameUnique(str){if(!callbackNameCount[str]){callbackNameCount[str]=1;}else{callbackNameCount[str]+=1;}
return str+transToLetter(callbackNameCount[str]);}
function ignoreUrl(url){return url.indexOf('wq.360buyimg.com')>-1||url.indexOf('wqs.jd.com')>-1||url.indexOf("/mcoss/mmart/show")>-1||url.indexOf("/mcoss/mmart/mshow")>-1||url.indexOf("/mcoss/spematerial/spematerialshow")>-1||url.indexOf("/mcoss/keyword/keywordsearch")>-1||url.indexOf("/mcoss/focusbi/show")>-1||url.indexOf("/mcoss/brandspecial/show")>-1||url.indexOf("btshow.jd.com/queryBtPlanInfo.do")>-1||url.indexOf("/mcoss/focusbi/show_new")>-1||url.indexOf("/mcoss/seckill/show")>-1;}
function sendJs(url,opt){var option={onLoad:null,onError:null,onTimeout:null,timeout:8000,isToken:true,keepProtocol:false,charset:"utf-8",setReportUrl:""};var timer;var clear=function(){if(!el){return;}
timer&&clearTimeout(timer);el.onload=el.onreadystatechange=el.onerror=null;el.parentNode&&(el.parentNode.removeChild(el));el=null;}
if(arguments.length==1){if(typeof arguments[0]=="object"){opt=arguments[0];url=opt.url;}else{opt={};}}
if(typeof(opt.data)=='object'){var param=[];for(var k in opt.data){param.push(k+'='+opt.data[k])}
if(param.length>0){param=param.join('&');url+=(url.indexOf('?')>0?'&':'?')+param;}}
for(var i in opt){if(opt.hasOwnProperty(i)){option[i]=opt[i];}}
var el=document.createElement("script");el.charset=option.charset||"utf-8";var needCheck=false;var cgiLoadOK=false;var reportUrl="";if(opt.setReportUrl&&typeof opt.setReportUrl=="function"){reportUrl=opt.setReportUrl();!reportUrl&&(reportUrl=url);}else{reportUrl=window.CGI302ReportKeepUrl?url:url.replace(/\?.*/,'');}
el.onload=el.onreadystatechange=function(){if(/loaded|complete/i.test(this.readyState)||navigator.userAgent.toLowerCase().indexOf("msie")==-1){option.onLoad&&option.onLoad();if(needCheck&&!cgiLoadOK){if(window.JD){JD.report.umpBiz({bizid:24,operation:3,result:"1",source:0,message:reportUrl});}
option.onError&&option.onError();window.onerror('','','','',{stack:'servererror:'+reportUrl});console.log('loadJs Failed:'+url);}
clear();}};el.onerror=function(){option.onError&&option.onError();clear();};var targetUrl=option.isToken?addToken(url,"ls"):url;if(!ignoreUrl(targetUrl)){var originFunctionName;var newFunctionName;var originFunction;var newUrl=targetUrl.replace(/callback=([^&]+)/,function(a,b){originFunctionName=b;newFunctionName=callbackNameUnique(originFunctionName);return'callback='+newFunctionName;});if(originFunctionName&&window[originFunctionName]){needCheck=true;targetUrl=newUrl;originFunction=window[originFunctionName];window[newFunctionName]=function(d){cgiLoadOK=true;originFunction(d);};}}
targetUrl=huidu(targetUrl);el.src=option.keepProtocol?targetUrl:targetUrl.replace(/^http(s?):/,"");document.getElementsByTagName('head')[0].appendChild(el);if(typeof option.onTimeout=="function"){timer=setTimeout(function(){option.onTimeout();},option.timeout);}
console.log('loadJs request:'+el.src);};function huidu(url){var posturl=url;if(window.huidu_cgi&&window.huidu_cgi.length>0){var filtercgi=window.huidu_cgi.filter(function(el){return window.location.href.indexOf(el.pageUrl)>=0&&window.location.href.indexOf(el.pageUrl)<10;});if(filtercgi.length>0&&(filtercgi[0].isAll=='1'||filtercgi[0].cgiList.filter(function(el){return url.indexOf(el.cgi)>=0&&url.indexOf(el.cgi)<10;}).length>0)){var uin=ck.get("wq_uin")||ck.get('wg_uin'),tmp=(uin||'0').substr(-3);if(parseInt(tmp)<parseInt(filtercgi[0].ratio)||filtercgi[0].whitelist.split(';').indexOf(uin)>=0){posturl='//wq.jd.com/httpsproxy/showinfo?url='+encodeURIComponent(location.protocol+url.replace(/^http(s?):/,""));posturl=addToken(posturl,"ls");}}}
return posturl;}
function addToken(url,type){var token=getToken();if(url==""||(url.indexOf("://")<0?location.href:url).indexOf("http")!=0){return url;}
if(url.indexOf("#")!=-1){var f1=url.match(/\?.+\#/);if(f1){var t=f1[0].split("#"),newPara=[t[0],"&g_tk=",token,"&g_ty=",type,"#",t[1]].join("");return url.replace(f1[0],newPara);}else{var t=url.split("#");return[t[0],"?g_tk=",token,"&g_ty=",type,"#",t[1]].join("");}}
return token==""?(url+(url.indexOf("?")!=-1?"&":"?")+"g_ty="+type):(url+(url.indexOf("?")!=-1?"&":"?")+"g_tk="+token+"&g_ty="+type);};function getToken(){var skey=ck.get("wq_skey"),token=skey==null?"":time33(skey);return token;};function time33(str){for(var i=0,len=str.length,hash=5381;i<len;++i){hash+=(hash<<5)+str.charAt(i).charCodeAt();}
return hash&0x7fffffff;}
exports.loadScript=function(url,opt){var args=[].slice.call(arguments);setTimeout(function(){sendJs.apply(null,args);},0);};exports.addToken=addToken;});
define('wg.jdshopcart.model',function(require,exports,module){var _cacheThisModule_;var $=require('zepto'),mLoad=require('loadJs'),md5=require('md5'),isDrugCart=false,jdDomian3=function(){var jdDomian="//wq.jd.com/deal/drugcart/";if(location.href.indexOf('rxDrug')==-1){jdDomian=(window.userRouter&&window.userRouter.getHost&&window.userRouter.getHost())||'//wq.jd.com/';jdDomian=jdDomian+'deal/mshopcart/';}else{isDrugCart=true;}
return jdDomian;},gParam={cgi:{'GetStockNew':'//ss.jd.com/ss/areaStockState/mget?','getFavor':'//diviner.jd.com/diviner?','getFavorNew':'//mixer.jd.com/mixer?','queryCoupon':'//wq.jd.com/mshop/QueryCoupon?','queryBatchCoupon':'//wq.jd.com/deal/couponquery/querycoupon?','AddToFavor':'//wq.jd.com/fav/comm/FavCommBatchAdd?','obtainShopCoupon':'//wq.jd.com/activeapi/obtainjdshopfreecouponv2?','findCanUseCoupon':'//wq.jd.com/deal/couponquery/findcanusecoupon?','getskubase':'//wqitem.jd.com/item/view2?cgi_source=deal&','getP3price':'//pe.3.cn/prices/mgets?','getBeanVerify':'//wq.jd.com/vipplus/BeanVerifyAuthUser?','getGiftCart':'//wq.jd.com/commodity/extension/getgreetings?','saveGiftCart':'//wq.jd.com/commodity/extension/savegreetings?','QueryPinStatus':'//wq.jd.com/pinbind/QueryPinStatus?',reflesh:function(){this['AddCmdy']=jdDomian3()+'addcmdy?';this['RmvCmdy']=jdDomian3()+'rmvcmdy?';this['ModifyCmdyNum']=jdDomian3()+'modifycmdynum?';this['CheckCmdy']=jdDomian3()+'checkcmdy?';this['UnCheckCmdy']=jdDomian3()+'uncheckcmdy?';this['CartView']=jdDomian3()+'cartview?';this['ModifyCmdyPromo']=jdDomian3()+'modifycmdypromo?';this['queryShopName']=jdDomian3()+'getveninfos?';this['GetJiangJia']=jdDomian3()+'getmargin?';this['getybitems']=jdDomian3()+'getybitems?';this['replaceItem']=jdDomian3()+'replaceitems?';this['GetFreightConfig']=jdDomian3()+'GetFreightConfig?';}}},goItilConfig={bizid:'15',source:'0',message:''},sNetwork=JD.cookie.get("network")||'wifi',giTimeout=sNetwork==='wifi'?10000:20000;gParam.cgi.reflesh();window.goShopCartData;window.popInfoData;window.ybObj={};window.shopCouponData;window.shopNameData={};window.batchShopCoupon;window.jdUserInfo;window.jiangjiaObj;window.stockCacheObj;window.CGI302Report=true;window.isHasPin=false;window.hasDeal=false;window.samsImgObj={};window.g_pinStatus=null;function refleshHost(d){window.userRouter&&window.userRouter.getHost&&window.userRouter.setHost(d);gParam.cgi.reflesh();}
var model={allSkuId:[],loadList:function(opt,cb){var _opt=$.extend({locationid:'',callback:'cartview_cb',t:Math.random()},opt),me=this,ct;ct=cutDown(giTimeout,function(){setItilConfig({res:["3:1"]});cb&&cb({errId:'44444'});});window[_opt.callback]=function(obj){ct&&ct.stop();if(obj.pin&&obj.pin.length>0){window.isHasPin=true;}
if(obj.dealRecord&&parseInt(obj.dealRecord)>0){window.hasDeal=true;}
if(obj.errId==='0'){refleshHost(obj);setItilConfig({res:["0:1"]});if(obj.debugswitch=='1'){JD.cookie.set('_debug_switch','1',0,"/",'jd.com');}else{JD.cookie.set('_debug_switch','0',0,"/",'jd.com');}
window.goShopCartData={};window.popInfoData={};chuliData(obj);model.updateData(obj);}else{if(obj.errId!='13'){if(getErrType(obj)==1){setItilConfig({res:["2:1"]});}else{setItilConfig({res:["1:1"]});}}}
cb&&cb(obj);}
mLoad.loadScript({url:gParam.cgi.CartView+buildParams(_opt),charset:'utf-8'});},addCmdty:function(opt,cb){var _opt=$.extend({commlist:'',type:'',locationid:'',scene:0,action:0,callback:'addcmdty_cb',t:Math.random()},opt);var ct=cutDown(giTimeout,function(){setItilConfig({res:["3:2"]});cb&&cb({errId:'44444'});});window[_opt.callback]=function(obj){ct&&ct.stop();if(obj.errId!=='0'){if(getErrType(obj)==1){setItilConfig({res:["2:2"]});}else{setItilConfig({res:["1:2"]});}}else{refleshHost(obj);setItilConfig({res:["0:2"]});setCartCookie(obj);var oNewCart=obj.cart;if(!(oNewCart.products)){oNewCart.products=[];}
if(!(oNewCart.suits)){oNewCart.suits=[];}
if(!(oNewCart.mfsuits)){oNewCart.mfsuits=[];}
if(!(oNewCart.mzsuits)){oNewCart.mzsuits=[];}
chuliData(obj);}
cb&&cb(obj,_opt.commlist);}
mLoad.loadScript({url:gParam.cgi.AddCmdy+buildParams(_opt),charset:'utf-8'});},removeCmdty:function(opt,cb){var _opt=$.extend({commlist:'',type:'',locationid:'',checked:0,callback:'removecmdty_cb',t:Math.random()},opt);var ct=cutDown(giTimeout,function(){setItilConfig({res:["3:3"]});cb&&cb({errId:'44444'});});window[_opt.callback]=function(obj){ct&&ct.stop();if(obj.errId!=='0'){if(getErrType(obj)==1){setItilConfig({res:["2:3"]});}else{setItilConfig({res:["1:3"]});}}else{refleshHost(obj);setItilConfig({res:["0:3"]});setCartCookie(obj);}
chuliData(obj);cb&&cb(obj,_opt.commlist);}
mLoad.loadScript({url:gParam.cgi.RmvCmdy+buildParams(_opt),charset:'utf-8'});},modifyCmdyNum:function(opt,cb){var _opt=$.extend({commlist:'',type:'',locationid:'',scene:0,callback:'modifycmdtynum_cb',t:Math.random()},opt);var ct=cutDown(giTimeout,function(){setItilConfig({res:["3:4"]});cb&&cb({errId:'44444'});});window[_opt.callback]=function(obj){ct&&ct.stop();if(obj.errId!=='0'){if(getErrType(obj)==1){setItilConfig({res:["2:4"]});}else{setItilConfig({res:["1:4"]});}}else{refleshHost(obj);setItilConfig({res:["0:4"]});setCartCookie(obj);var oNewCart=obj.cart;if(!(oNewCart.products)){oNewCart.products=[];}
if(!(oNewCart.suits)){oNewCart.suits=[];}
if(!(oNewCart.mfsuits)){oNewCart.mfsuits=[];}
if(!(oNewCart.mzsuits)){oNewCart.mzsuits=[];}
chuliData(obj);}
cb&&cb(obj,_opt.commlist);}
mLoad.loadScript({url:gParam.cgi.ModifyCmdyNum+buildParams(_opt),charset:'utf-8'});},uncheckCmdty:function(opt,cb){var _opt=$.extend({commlist:'',type:'',locationid:'',all:0,callback:'uncheckcmdty_cb',t:Math.random()},opt);var ct=cutDown(giTimeout,function(){setItilConfig({res:["3:5"]});cb&&cb({errId:'44444'});});window[_opt.callback]=function(obj){ct&&ct.stop();if(obj.errId!=='0'){if(getErrType(obj)==1){setItilConfig({res:["2:5"]});}else{setItilConfig({res:["1:5"]});}}else{refleshHost(obj);setItilConfig({res:["0:5"]});var oNewCart=obj.cart;if(!(oNewCart.products)){oNewCart.products=[];}
if(!(oNewCart.suits)){oNewCart.suits=[];}
if(!(oNewCart.mfsuits)){oNewCart.mfsuits=[];}
if(!(oNewCart.mzsuits)){oNewCart.mzsuits=[];}
chuliData(obj);}
cb&&cb(obj,_opt.commlist);}
mLoad.loadScript({url:gParam.cgi.UnCheckCmdy+buildParams(_opt),charset:'utf-8'});},checkCmdty:function(opt,cb){var _opt=$.extend({commlist:'',type:'',locationid:'',all:0,callback:'checkcmdty_cb',t:Math.random()},opt);var ct=cutDown(giTimeout,function(){setItilConfig({res:["3:6"]});cb&&cb({errId:'44444'});});window[_opt.callback]=function(obj){ct&&ct.stop();if(obj.errId!=='0'){if(getErrType(obj)==1){setItilConfig({res:["2:6"]});}else{setItilConfig({res:["1:6"]});}}else{refleshHost(obj);setItilConfig({res:["0:6"]});var oNewCart=obj.cart;if(!(oNewCart.products)){oNewCart.products=[];}
if(!(oNewCart.suits)){oNewCart.suits=[];}
if(!(oNewCart.mfsuits)){oNewCart.mfsuits=[];}
if(!(oNewCart.mzsuits)){oNewCart.mzsuits=[];}
chuliData(obj);}
cb&&cb(obj,_opt.commlist);}
mLoad.loadScript({url:gParam.cgi.CheckCmdy+buildParams(_opt),charset:'utf-8'});},modGift:function(opt){var _opt=$.extend({sSuitId:'',sGiftId:'',sSuitType:'',sAddrId:'',cb:function(){}},opt);var oSuit=goShopCartData[_opt.sSuitId],me=this;var arrSelectedGif;if(oSuit.manGiftSkus&&oSuit.manGiftSkus.length>0){arrSelectedGif=oSuit.manGiftSkus.filter(function(element){return element.giftSelectState=="2";});}
if(!_opt.sGiftId&&(!arrSelectedGif||arrSelectedGif.length===0)){_opt.cb(null,null,'none');return;}
if(!_opt.sGiftId&&arrSelectedGif&&arrSelectedGif.length>0){this.removeCmdty({commlist:me.serializeCommList(arrSelectedGif,{suitId:_opt.sSuitId,suitType:_opt.sSuitType,cmdtyType:'selectedgift'}),type:1,locationid:_opt.sAddrId},function(obj,sCommList){if(obj.errId!=='0'){_opt.cb(obj,null,'del');}else{chuliData(obj);var oSuit=me.updateData(obj,sCommList)[0];_opt.cb(obj,oSuit,'del');}});}else if(me.isModGift(oSuit,_opt.sGiftId)){me.addCmdty({commlist:me.serializeCommList(me.getGiftById(_opt.sSuitId,_opt.sGiftId),{suitId:_opt.sSuitId,suitType:_opt.sSuitType,cmdtyType:'canselectgift'}),type:1,locationid:_opt.sAddrId},function(obj,sCommList){if(obj.errId!=='0'){_opt.cb(obj,null,'add');}else{chuliData(obj);var oSuit=me.updateData(obj,sCommList)[0];_opt.cb(obj,oSuit,'add');}});}else{_opt.cb(null,null,'none');return;}},getStock:function(opt,cb){var _opt=$.extend({callback:'getstockscb',app:'',skuNum:this.allSkuId.join(';'),area:'',ch:JD.device.scene=='weixin'?4:5,t:Math.random()},opt);if(opt.isGetCatch&&window.stockCacheObj){cb&&cb(window.stockCacheObj);return;}
window[_opt.callback]=function(obj){if(obj){window.stockCacheObj=obj;}
cb&&cb(obj);}
var stockurl=gParam.cgi.GetStockNew+buildParams(_opt);mLoad.loadScript({url:stockurl,charset:'utf-8'});},getJiangJia:function(opt,cb){var _opt={commlist:opt.commlist,callback:'getJiangJia_cb',t:Math.random()};if(window.jiangjiaObj){cb&&cb(window.jiangjiaObj);return;}
window[_opt.callback]=function(obj){if(obj.errId=='0'){window.jiangjiaObj=obj;cb&&cb(obj);}}
mLoad.loadScript({url:gParam.cgi.GetJiangJia+buildParams(_opt),charset:'utf-8'});},addToFavor:function(opt,cb){var _opt={commId:opt.commId,callback:'addToFavorcb',t:Math.random()};window[_opt.callback]=function(obj){cb&&cb(obj);}
mLoad.loadScript({url:gParam.cgi.AddToFavor+buildParams(_opt),charset:'utf-8'});},getOperItemType:function(sSuitType,sCmdtyType){var iType=0;switch(sSuitType){case'suit':if(sCmdtyType==='cmdty'){iType=5;}else{iType=4;}
break;case'mf':if(sCmdtyType==='cmdty'){iType=11;}else if(sCmdtyType==='gift'){iType=10;}else{iType=9;}
break;case'mz':if(sCmdtyType==='cmdty'){iType=13;}else if(sCmdtyType==='canselectgift'){iType=15;}else if(sCmdtyType==='selectedgift'){iType=16;}else{iType=12;}
break;}
if(iType==0){console.error('iType error');}
return iType;},updateData:function(obj,sCommList){var oNewCart=obj.cart,products=[],suits=[],mfsuits=[],mzsuits=[],poplist=[];if(oNewCart.venderCart.length>0){oNewCart.venderCart.forEach(function(element){poplist.push(element.popInfo);element.products&&element.products.length&&element.products.forEach(function(el){products.push(el);});element.suits&&element.suits.length&&element.suits.forEach(function(el){suits.push(el);});element.mfsuits&&element.mfsuits.length&&element.mfsuits.forEach(function(el){mfsuits.push(el);});element.mzsuits&&element.mzsuits.length&&element.mzsuits.forEach(function(el){mzsuits.push(el);});});}
oNewCart.products=products;oNewCart.suits=suits;oNewCart.mfsuits=mfsuits;oNewCart.mzsuits=mzsuits;window.allChecked=oNewCart.allChecked;if(sCommList){var oDataTag=this.unserializeCommList(sCommList),arrData,list=[];oDataTag.forEach(function(item){if(item.sSuitType==='cmdty'){list.push(updateCmdty(oNewCart.products,item.sId));}else{switch(item.sSuitType){case'suit':arrData=oNewCart.suits;break;case'mf':arrData=oNewCart.mfsuits;break;case'mz':arrData=oNewCart.mzsuits;break;}
list.push(updateSuit(arrData,item.sSuitId));}});return list;}else{window.goShopCartData={};window.popInfoData=poplist;updateCmdty(oNewCart.products);updateSuit([].concat(oNewCart.suits,oNewCart.mfsuits,oNewCart.mzsuits));}
function updateCmdty(arrData,sTarId){for(var i=0;i<arrData.length;i++){if(sTarId){if(arrData[i].mainSku.id==sTarId){oData=arrData[i];goShopCartData[sTarId]=arrData[i];return oData;}}else{goShopCartData[arrData[i].mainSku.id]=arrData[i];if(model.allSkuId.indexOf(arrData[i].mainSku.id)<0){model.allSkuId.push(arrData[i].mainSku.id);samsImgObj["_"+arrData[i].mainSku.id]=arrData[i].mainSku.image;}}}}
function updateSuit(arrData,sTarId){for(var i=0;i<arrData.length;i++){if(!arrData[i])continue;if(sTarId){var origPid=arrData[i].promotion.pid,newPid=arrData[i].promotion.pid;if(arrData[i].promotion.origPid&&arrData[i].promotion.origPid!='0'){origPid=arrData[i].promotion.origPid;newPid=arrData[i].promotion.pid;}
if(origPid==sTarId){oData=arrData[i];goShopCartData[newPid]=arrData[i];return oData;}}else{goShopCartData[arrData[i].promotion.pid]=arrData[i];if(arrData[i].products){for(var j=0;j<arrData[i].products.length;j++){if(model.allSkuId.indexOf(arrData[i].products[j].mainSku.id)<0){model.allSkuId.push(arrData[i].products[j].mainSku.id);samsImgObj["_"+arrData[i].products[j].mainSku.id]=arrData[i].products[j].mainSku.image;}}}
if(arrData[i].suits){var tmpItem,cItem;for(var j=0;j<arrData[i].suits.length;j++){tmpItem=arrData[i].suits[j];for(var t=0;t<tmpItem.products.length;t++){cItem=tmpItem.products[t];if(model.allSkuId.indexOf(cItem.mainSku.id)<0){model.allSkuId.push(cItem.mainSku.id);samsImgObj["_"+cItem.mainSku.id]=cItem.mainSku.image;}}}}}}}},serializeCommList:function(arrItem,opt){var arrCommList=[];if(!$.isArray(arrItem)){arrItem=[arrItem];}
for(var i=0;i<arrItem.length;i++){var oItem=arrItem[i],_opt=$.extend({ppitemid:0,itemattr:0,type:0,suitId:0,packid:0,num:0,suitType:0,cmdtyType:'cmdty'},$.isArray(opt)?opt[i]:opt);if(_opt.suitType==='suit'){_opt.type=4;oItem.id=oItem.promotion.pid;}else if(oItem.vSkuId){_opt.type=_opt.suitType=='mf'?24:29;oItem.id=oItem.vSkuId;}else if(_opt.suitType===''){_opt.type=1;}else{_opt.type=this.getOperItemType(_opt.suitType,_opt.cmdtyType);}
sItemId=oItem.mainSku?oItem.mainSku.id:oItem.id,arrCommList.push([sItemId,_opt.itemattr,_opt.num||oItem.num,_opt.type===4?'':sItemId,_opt.type,_opt.suitId,_opt.packid].join(','));}
return encodeURIComponent(arrCommList.join('$'));},unserializeCommList:function(sCommList){var list=[];decodeURIComponent(sCommList).split('$').forEach(function(item){var arrCommList=item.split(','),type=arrCommList[4]*1,sSuitId='',sId='',sSuitType='';if(type===4){sSuitId=arrCommList[0].split('_')[0];sSuitType='suit';}else if(type===1){sId=arrCommList[0];sSuitType='cmdty';}else{sId=arrCommList[0];sSuitId=arrCommList[5];sSuitType=(type>11&&type!=24)?'mz':'mf';}
list.push({sId:sId,sSuitId:sSuitId,sSuitType:sSuitType});});return list;},isModGift:function(oSuit,sGiftId){var arrSelectedGif;if(oSuit.manGiftSkus&&oSuit.manGiftSkus.length>0){arrSelectedGif=oSuit.manGiftSkus.filter(function(element){return element.giftSelectState=="2";});}
var arrGiftId=sGiftId.split(',');if(arrSelectedGif.length!==arrGiftId.length)return true;for(var i=0;i<arrSelectedGif.length;i++){var giftId=arrSelectedGif[i].id;for(var j=0;j<arrGiftId.length;j++){if(giftId!==arrGiftId[j]){return true;}}}
return false;},getGiftById:function(sSuitId,sGiftId){var oSuit=goShopCartData[sSuitId],arrGiftId=sGiftId.split(','),arrGift=[],arrSelectedGift=[];if(oSuit){arrGift=oSuit.manGiftSkus;for(var i=0;i<arrGiftId.length;i++){var sSelGiftId=arrGiftId[i];for(var j=0;j<arrGift.length;j++){if(arrGift[j].id===sSelGiftId){arrSelectedGift.push(arrGift[j]);break;}}}
return arrSelectedGift;}
return[];},getCmdtyObjById:function(sId,sPid,sSuitType){if(!sPid||sSuitType=='suit'){return goShopCartData[sId];}else{var oSuit=goShopCartData[sPid],arrCmdty=oSuit.products||[],arrXnztSuit=oSuit.suits||[];for(var i=0;i<arrCmdty.length;i++){if(arrCmdty[i].mainSku.id==sId){return arrCmdty[i];}}
for(var i=0;i<arrXnztSuit.length;i++){if(arrXnztSuit[i].vSkuId==sId){return arrXnztSuit[i];}}}},getSuitById:function(sSuitId){return goShopCartData[sId];},modifyCmdyPromo:function(opt,cb){var _opt=$.extend({commlist:'',type:'',locationid:'',checked:0,callback:'modifycmdypromo_cb',t:Math.random()},opt);var ct=cutDown(giTimeout,function(){cb&&cb({errId:'44444'});});window[_opt.callback]=function(obj){ct&&ct.stop();if(obj.errId=='0'){refleshHost(obj);chuliData(obj);model.updateData(obj);cb&&cb(obj);}}
mLoad.loadScript({url:gParam.cgi.ModifyCmdyPromo+buildParams(_opt),charset:'utf-8'});},getYB:function(opt,cb){if(!opt)opt={};var _opt=$.extend({callback:'getYb_cb',t:Math.random()},opt),me=this,ct;ct=cutDown(giTimeout,function(){cb&&cb({errId:'44444'});});window[_opt.callback]=function(obj){ct&&ct.stop();if(obj.errId=='0'){refleshHost(obj);}
cb&&cb(obj);}
mLoad.loadScript({url:gParam.cgi.getYb+buildParams(_opt),charset:'utf-8'});},setYB:function(opt,cb){var _opt=$.extend({commlist:'',type:'2',locationid:'',scene:0,action:0,callback:'setYb_cb',t:Math.random()},opt);var ct=cutDown(giTimeout,function(){cb&&cb({errId:'44444'});});window[_opt.callback]=function(obj){ct&&ct.stop();if(obj.errId=='0'){refleshHost(obj);}
cb&&cb(obj);}
mLoad.loadScript({url:gParam.cgi.AddCmdy+buildParams(_opt),charset:'utf-8'});},rmvYB:function(opt,cb){var _opt=$.extend({commlist:'',type:'2',locationid:'',checked:0,callback:'rmvYb_cb',t:Math.random()},opt);var ct=cutDown(giTimeout,function(){cb&&cb({errId:'44444'});});window[_opt.callback]=function(obj){ct&&ct.stop();if(obj.errId=='0'){refleshHost(obj);}
cb&&cb(obj);}
mLoad.loadScript({url:gParam.cgi.RmvCmdy+buildParams(_opt),charset:'utf-8'});},setYbGift:function(opt,cb){var _opt=$.extend({commlist:'',ybcommlist:'',type:'7',locationid:'',scene:0,action:0,callback:'setYbGift_cb',t:Math.random()},opt);var ct=cutDown(giTimeout,function(){cb&&cb({errId:'44444'});});window[_opt.callback]=function(obj){ct&&ct.stop();if(obj.errId=='0'){refleshHost(obj);}
cb&&cb(obj);}
mLoad.loadScript({url:gParam.cgi.AddCmdy+buildParams(_opt),charset:'utf-8'});},getFavor:function(opt,cb){window.isMixerCgi=true;var isWX=JD.device.scene=='weixin';if(opt.p!='630003'&&opt.p!='635016')window.isMixerCgi=false;var openid=isWX?JD.cookie.get('open_id'):(JD.cookie.get('open_id')||JD.cookie.get('sq_open_id'));if(opt.location_info){opt.location_info=(opt.location_info+'').replace(/_/g,'-');}
var _opt=(isMixerCgi?$.extend({p:'630003',uuid:(JD.cookie.get('jd_uuid')||JD.cookie.get('visitkey')),skus:this.allSkuId,pin:encodeURIComponent(JD.cookie.get('jdpin')),lid:(opt.lid?opt.lid:''),lim:'6',ec:'utf-8',ad_ids:(isWX?'1789':'1792'),mobile_type:(isWX?'3':'4'),device_type:(isWX?'512':'1024'),device_id:openid,location_info:'19-1607-3155-0',callback:'cbGetFavor',hi:'visitkey:'+JD.cookie.get('visitkey')+',pin:'+encodeURIComponent(JD.cookie.get('jdpin'))+',openid:'+openid},opt):$.extend({p:'630003',uuid:'',skus:this.allSkuId,lid:'',ec:'utf-8',lim:'6',pin:'',callback:'cbGetFavor',hi:'visitkey:'+JD.cookie.get('visitkey')+',pin:'+encodeURIComponent(JD.cookie.get('jdpin'))+',openid:'+openid,t:Math.random()},opt));var ct=cutDown(giTimeout,function(){cb&&cb({errId:'44444'});});window[_opt.callback]=function(obj){ct&&ct.stop();cb&&cb(obj);}
mLoad.loadScript({url:gParam.cgi[window.isMixerCgi?'getFavorNew':'getFavor']+buildParams(_opt),charset:'utf-8'});},queryShopCoupon:function(venderId,cb,callbackname){if(!window.shopCouponData){window.shopCouponData={};}
if(window.shopCouponData[venderId]){return function(){cb&&cb(window.shopCouponData[venderId],venderId);}}else{return function(){var svenderId=venderId;var _opt={callback:callbackname,venderId:venderId};window[_opt.callback]=function(obj){if(obj.errcode==0){window.shopCouponData[svenderId]=obj;cb&&cb(obj,svenderId);}}
mLoad.loadScript({url:gParam.cgi.queryCoupon+buildParams(_opt),charset:'utf-8'});}}},queryBatchShopCoupon:function(opt,cb){var _opt={callback:'couponcb',commlist:opt.commlist,t:Math.random()};if(window.batchShopCoupon&&opt.isGetCatch){cb&&cb(window.batchShopCoupon);return;}
window.couponcb=function(obj){if(obj.errId==0){window.batchShopCoupon=obj;cb&&cb(obj);}}
mLoad.loadScript({url:gParam.cgi.queryBatchCoupon+buildParams(_opt),charset:'utf-8'});},obtainShopCoupon:function(key,roleid,sceneid,cb){var _opt={callback:'obtainShopCoupon'+key,key:key,roleid:roleid,scene:sceneid||3};window[_opt.callback]=function(obj){cb&&cb(obj);try{wa('shDeviceId',{type:1,activeInfo:{key:key,roleid:roleid}});}catch(e){};}
mLoad.loadScript({url:gParam.cgi.obtainShopCoupon+buildParams(_opt),charset:'utf-8'});},findCanUseCoupon:function(commlist,cb){var _opt={callback:'findCanUseCb',commlist:commlist,t:Math.random()};window.findCanUseCb=function(obj){if(obj.errId==0){cb&&cb(obj);}}
mLoad.loadScript({url:gParam.cgi.findCanUseCoupon+buildParams(_opt),charset:'utf-8'});},queryJDUserInfo:function(opt,cb){var me=this;if(window.jdUserInfo){cb(window.jdUserInfo);return;}
var _source=1,_wid=JD.cookie.get('wq_uin')||'0',_rurl=location.href,_checkSrc=_wid+location.href+'pinstatus@20140917',_url,data,_check=md5.getHash(_checkSrc);if(JD.device.scene=='weixin'){_source=2;}
data=$.extend({callback:'cbQueryPinStatus',wid:_wid,url:_rurl,base:1,r:Math.random()},opt);_url='//wq.jd.com/user/info/QueryJDUserInfo?'+$.param(data);mLoad.loadScript(_url,{isToken:true});window[data.callback]=function(d){if(d.retcode==0&&d.base){window.jdUserInfo=d;cb(d);};}},getPinStatus:function(opt,cb){var _opt=$.extend({wid:JD.cookie.get('wq_uin'),rurl:'',sceneid:'',source:(JD.device.scene=='weixin'?'2':'1'),callback:'pinStatusCB',t:Math.random()},opt);if(window.g_pinStatus){cb&&cb(window.g_pinStatus);return;}
window[_opt.callback]=function(obj){window.g_pinStatus=obj;cb&&cb(obj);}
mLoad.loadScript({url:gParam.cgi.QueryPinStatus+buildParams(_opt),charset:'utf-8'});},getYunFeiMoreItemCount:function(opt,cb){var sAddrId=JD.cookie.get('jdAddrId')||JD.cookie.get('jdLOCAddrId')||'19_1607_3155_0',area=sAddrId.split("_").join(',');var _opt=$.extend({p:'635025',uuid:(JD.cookie.get('jd_uuid')||JD.cookie.get('visitkey'))||(-1),lid:1,ec:'utf-8',lim:'50',hi:'{"max":"499","min":"0","area":"'+area+'","wt":"50","fr":"'+opt.fr+'"}',callback:'cbGetYunFeiMoreItemCount',skus:'',t:Math.random()},opt);window[_opt.callback]=function(obj){cb&&cb(obj);}
mLoad.loadScript({url:'//diviner.jd.com/diviner?ro=&sp=&pin=&c3=&fe=&fne=&c2=&'+buildParams(_opt),charset:'utf-8'});},queryShopName:function(vidArr,lsidArr,cb){var _vid=vidArr||[],lsidsArr=lsidArr||[];var _opt={callback:'cbshopname',vid:_vid.join(','),lsids:lsidsArr.join(','),t:Math.random()};window[_opt.callback]=function(obj){if(obj.errId==='0'&&obj.venInfos&&obj.venInfos.length>0){obj.venInfos.forEach(function(item){window.shopNameData[item.vid]=item.shopname;});obj.locShops&&obj.locShops.forEach(function(item){window.shopNameData['ls'+item.id]=item.name;});cb&cb();}}
mLoad.loadScript({url:gParam.cgi.queryShopName+buildParams(_opt),charset:'utf-8'});},getskubase:function(opt,cb,cacheData){if(cacheData){cb&&cb(cacheData);return;}
var _opt=$.extend({datatype:'1',sku:'',areaid:'',u_source:'qq',callback:'getskubase_cb',t:Math.random()},opt);window[_opt.callback]=function(obj){cb&&cb(obj);}
mLoad.loadScript({url:gParam.cgi.getskubase+buildParams(_opt),charset:'utf-8'});},getybitems:function(opt,cb){var _opt=$.extend({locationid:'',reg:'1',isnewyb:'1',callback:'getybitems_cb',t:Math.random()},opt);window[_opt.callback]=function(obj){if(obj&&obj.errId=='0'){cb&&cb(obj);}}
mLoad.loadScript({url:gParam.cgi.getybitems+buildParams(_opt),charset:'utf-8'});},getP3price:function(opt,cb){var _opt=$.extend({skuids:'',origin:'',area:'',callback:'getP3priceCb',t:Math.random()},opt);window[_opt.callback]=function(obj){cb&&cb(obj);}
mLoad.loadScript({url:gParam.cgi.getP3price+buildParams(_opt),charset:'utf-8'});},replaceItem:function(opt,cb){var _opt=$.extend({locationid:'',commlist:'',type:'',callback:'replaceItem_cb',t:Math.random()},opt);var ct=cutDown(giTimeout,function(){cb&&cb({errId:'44444'});});window[_opt.callback]=function(obj){ct&&ct.stop();if(obj.errId=='0'){setCartCookie(obj);var oNewCart=obj.cart;if(!(oNewCart.products)){oNewCart.products=[];}
if(!(oNewCart.suits)){oNewCart.suits=[];}
if(!(oNewCart.mfsuits)){oNewCart.mfsuits=[];}
if(!(oNewCart.mzsuits)){oNewCart.mzsuits=[];}
chuliData(obj);}
cb&&cb(obj,_opt.commlist);}
mLoad.loadScript({url:gParam.cgi.replaceItem+buildParams(_opt),charset:'utf-8'});},GetFreightConfig:function(opt,cb){var _opt=$.extend({locationid:'',userlevel:'',freightconfig:'',reg:'1',callback:'getYunfeiStaCb',t:Math.random()},opt);window[_opt.callback]=function(obj){cb&&cb(obj);}
mLoad.loadScript({url:gParam.cgi.GetFreightConfig+buildParams(_opt),charset:'utf-8'});},getBeanVerify:function(opt,cb){var _opt=$.extend({callback:'getBeanVerifyCb',t:Math.random()},opt);window[_opt.callback]=function(obj){cb&&cb(obj);}
mLoad.loadScript({url:gParam.cgi.getBeanVerify+buildParams(_opt),charset:'utf-8'});},getGiftCart:function(opt,cb){var _opt=$.extend({skuid:'',callback:'getGiftCartCb',t:Math.random()},opt);if(_opt.cacheData&&_opt.cacheData[_opt.skuid]){cb&&cb(_opt.cacheData[_opt.skuid]);}
window[_opt.callback]=function(obj){cb&&cb(obj);}
mLoad.loadScript({url:gParam.cgi.getGiftCart+buildParams(_opt),charset:'utf-8'});},saveGiftCart:function(opt,cb){var _opt=$.extend({skuid:'',receiver:'',sender:'',content:'',callback:'saveGiftCartCb',t:Math.random()},opt);window[_opt.callback]=function(obj){cb&&cb(obj);}
mLoad.loadScript({url:gParam.cgi.saveGiftCart+buildParams(_opt),charset:'utf-8'});}}
function chuliData(obj){if(obj.cart&&obj.cart.venderCart){obj.cart.venderCart.forEach(function(el){if(el.popInfo&&el.mfsuits.length>0&&parseInt(el.popInfo.vid)<0){el.popInfo.vid="-"+el.mfsuits[0].promotion.pid;}});}}
function setCartCookie(obj){if(obj.cart&&obj.cart.mainSkuCount&&obj.cart.mainSkuNum){JD.cookie.set('mainSkuCount',obj.cart.mainSkuCount,999999,"/",'jd.com');JD.cookie.set('cartNum',obj.cart.mainSkuNum,999999,"/",'jd.com');localStorage.setItem('cartNum',obj.cart.mainSkuNum);if(isDrugCart){JD.store.setItem("drugCartNum",obj.cart.mainSkuNum,999999);}}}
function buildParams(opt){if(opt.locationid&&opt.locationid.length>0){opt.locationid=opt.locationid.split("_").join("-");}
var arrParam=[];for(var key in opt){arrParam.push(key+'='+opt[key]);}
return arrParam.join('&');}
function getErrType(obj){var iErrId=obj.errId*1;if(iErrId>=8449&&iErrId<=8703){return 1;}else{return 2;}}
function setItilConfig(opt){goItilConfig.result=opt.res[0].split(':')[0];goItilConfig.operation=opt.res[0].split(':')[1];JD.report.umpBiz(goItilConfig);}
function cutDown(time,out,stop){clearTimeout(cutDown.tag);cutDown.tag=setTimeout(function(){out&&out();},time);return{stop:function(){clearTimeout(cutDown.tag);stop&&stop();}}}
exports.init=function(){return model;}
exports.chuliData=chuliData;exports.setCartCookie=setCartCookie;});
define("wq.skuSwitch",function(require,exports,e){var _cacheThisModule_,s=require("zepto"),t=require("loadJs"),r=require("login"),a=/micromessenger(\/[\d\.]+)*/.test(navigator.userAgent.toLowerCase()),u={skuCon:"",sku:0,isDist:false,optionTpl:"",optionItem:"",selectedClass:"",disabledClass:"",skuTpl:"",cgiSource:"",needFav:false,needCheaper:false,cb:function(){},clickEvent:"click",numInputSelector:"",numMinusSelector:"",numPlusSelector:"",numMinusDisableCls:"",numPlusDisableCls:"",numChangeCB:null,numChangeTipCB:null,buyNum:1},i={skuChooseArr:[],noSkuArea:{},item:{},buyNum:1,skuData:{},sizeData:{},skuId:0,price:{},jdSkuStatus:true},n={jdSkuInfo:{},skuPro:{},skuId:0,changeSkuId:0,isBind:false,jdSkuStatus:true,addrId:(w().id||"").split("_"),holdAdd:false,holdCheaper:false};function o(){window.skuInfoCB=function(e){n.jdSkuInfo[n.changeSkuId]=e;n.skuId=n.changeSkuId;i.skuId=n.skuId;i.price[n.skuId]=e.price;var s=e.item||{};i.item[n.skuId]=s;i.skuData[n.skuId]={};if(!n.skuPro.id){d();f()}if(!n.isBind){h()}C();p(i.buyNum);u.cb&&u.cb()};if(n.jdSkuInfo[n.changeSkuId]){window.skuInfoCB(n.jdSkuInfo[n.changeSkuId])}else{t.loadScript(["//wqitem.jd.com/item/view2?datatype=1&callback=skuInfoCB","sku="+n.changeSkuId,"dist="+(u.isDist?"jd":""),"u_source="+(a?"weixin":"qq"),"cgi_source="+u.cgiSource,"t="+Math.random()].join("&"))}}function d(){var e=i.item[n.skuId]||{};try{i.noSkuArea[u.sku]=2;var t=function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},r=function(){var s=e.ColorSize&&e.ColorSize.length&&e.ColorSize[0].SpecName||"";return[l("颜色",e.Color),l("尺寸",e.Size),l(s,e.Spec)]},a=function(){var s=[],r=e.salePropSeq,a=e.saleProp,u=[];for(var i in a){if(a.hasOwnProperty(i)&&a[i]){u.push(i)}}u.sort();var o="",d=[],c="";for(var f=0,k=u.length;f<k;f++){o=u[f];d=(r[o]||[]).filter(function(e){return t(e||"")});r[o]=d;if(d.length>0){c=a[o]||"";if(c.length>2){c=c.replace(/^选择/,"").substr(0,4)}s.push(l(c,d))}else{u[f]=""}}u=u.filter(function(e){return e!==""});n.skuPro={propArr:[],propSeq:{}};n.skuPro.propArr=u;n.skuPro.propSeq=r;return s};var o=1,d=a().join("");if(d){s("#"+u.skuCon).html(d)}else{i.noSkuArea[u.sku]=3}function l(e,s){if(!s||!s.length)return"";var r=[],a="",n=o;for(var d=0,l=s.length;d<l;d++){if(t(s[d]||""))r.push(s[d])}if(r.length>0){if(r.length>1)i.noSkuArea[u.sku]=1;o++;var c=[];for(var d=0,l=r.length;d<l;d++){c.push(N({no:n,name:r[d]},u.optionTpl))}a=N({no:n,name:e,option:c.join("")},u.skuTpl)}return a}}catch(c){}}function l(){var e=i.item[n.skuId]||{},t=e&&e.ColorSize;t=t||[];n.skuPro={color:{},size:{},name:{},id:{}};if(!t||!t.length||i.noSkuArea[u.sku]==3)return;var r=[],a={},o=[];for(var d=0;d<t.length;d++){a=t[d];o=[a.Color&&a.Color.toString(),a.Size&&a.Size.toString(),a.Spec&&a.Spec.toString()].filter(function(e){return e&&e.replace(/\s+/g,"")});n.skuPro.name[o.join("~~")]=a.SkuId;n.skuPro.id[a.SkuId]=o;if(a.SkuId==u.sku)r=o}s.each([1,2,3],function(e,t){var a=s("#sku"+t+" "+u.optionItem),i="";if(a.length>0){for(var n=0,o=a.length;n<o;n++){i=a.eq(n);if(i.text()==r[t-1]){i.addClass(u.selectedClass);break}}}});var l=r[0]?1:2;c(l,r[l-1]);s("#sku"+l+" "+u.optionItem).removeClass(u.disabledClass)}function c(e,t){var r=[],a=e-1;s.each(n.skuPro.id,function(e,s){if(s[a]==t)r.push(s)});var i="",o=false,d="",l="";s.each([1,2,3],function(t,a){if(e==a)return;i=s("#sku"+a+" "+u.optionItem);if(i.length>0){s.each(i,function(e){o=false;l=i.eq(e);d=l.text();s.each(r,function(){o=o||this[t]==d});if(o){l.removeClass(u.disabledClass)}else{l.addClass(u.disabledClass)}})}});if(!s("#sku3 "+u.optionItem).length)return;var c=[0,2,1,1][e],f=[0,3,3,2][e],k=s("#sku"+c+" ."+u.selectedClass).text();if(!k)return;i=s("#sku"+f+" "+u.optionItem);i.addClass(u.disabledClass);if(i.length>0){s.each(r,function(){var e=this;s.each(i,function(s){if(e[c-1]==k&&e[a]==t&&e[f-1]==i.eq(s).text()){i.eq(s).removeClass(u.disabledClass)}})})}}function f(){if(i.noSkuArea[u.sku]===3)return;var e=i.item[n.skuId]||{},t=e.newColorSize,r=n.skuPro.propSeq,a=n.skuPro.propArr,o=[],d="";n.skuPro.name={};n.skuPro.id={};var l={},c=[],f=[];for(var m=0,h=t.length;m<h;m++){l=t[m];c=[];for(var p=0,C=a.length;p<C;p++){c.push(l[a[p]])}c=c.filter(function(e){return s.trim(e||"")});if(c.length>0){n.skuPro.name[c.join("~~")]=l.skuId;n.skuPro.id[l.skuId]=c;if(l.skuId==n.skuId)f=c}}i.skuChooseArr=f;for(var m=0,h=a.length;m<h;m++){d=a[m];for(var p=0,C=r[d].length;p<C;p++){if(f[m]===s.trim(r[d][p]||"")){s("#sku"+(m+1)+" "+u.optionItem).eq(p).addClass(u.selectedClass);break}}}k()}function k(e){e=e||{};var t=e.skuNo,r=e.cName,a=n.skuPro.propArr,i=n.skuPro.id,o=[],d=n.skuPro.propSeq,l="",c=u.disabledClass,f=u.selectedClass,k=function(e,t){for(var r in i){if(i.hasOwnProperty(r)&&i[r]&&i[r][e-1]){if(i[r][e-1]===t){o.push(i[r])}}}var n=false,k="",m="";for(var h=0,p=a.length;h<p;h++){if(e-1===h)continue;l=s("#sku"+(h+1)+" "+u.optionItem);for(var C=0,I=d[a[h]].length;C<I;C++){k=d[a[h]][C];n=false;for(var v=0,S=o.length;v<S;v++){if(o[v][h]===k){n=true;break}}m=l.eq(C);if(n){if(m.attr("dis")!=="1"&&m.removeClass(c).attr("dissel")==="1"){m.addClass(f).attr("dissel","0")}}else{m.attr("dis","1");if(m.addClass(c).hasClass(f)){m.removeClass(f).attr("dissel","1")}}}}};s("#"+u.skuCon+" "+u.optionItem).attr("dis","0");if(t>0&&r){k(t,r)}var m="";for(var h=0,p=a.length;h<p;h++){if(t-1===h)continue;l=s("#sku"+(h+1));m=l.find(u.optionItem+"."+f);if(m.length>0){k(h+1,m.text())}}}function m(e){var r=i.item[n.skuId]||{},a=r.category||[];if(!r.description||" 11729 1315 1318 1319 ".indexOf(" "+a[0]+" ")==-1)return;var o=r.description.replace(/^d/,"");window.sizeInfoCB=function(t){if(!t||!t.cmdetail||!t.cmdetail.oResult)return;var r="",a=true,d="";if(t.cmdetail.oResult.RecommendList&&t.cmdetail.oResult.RecommendList.length==0){a=false}if(t.errcode==0){if(!t.personcminfo||!t.personcminfo.vecCmInfoPoList||t.personcminfo.vecCmInfoPoList.length===0){r="";d="//wqs.jd.com/item/sizeedit.shtml?istab=1&ptag=7001.1.63&sku="+n.skuId}else{var l=t.personcminfo.vecCmInfoPoList,c=0;a=false;r=l[0];if(r){c=r.ddwCmId;a=true;d="//wqs.jd.com/item/sizecenter.shtml?ptag=7001.1.64&wareid="+o+"&cmid="+c+"&sku="+n.skuId}else{a=false}}}else{a=false}i.sizeData[u.sku]=i.sizeData[u.sku]||{};s.extend(i.sizeData[u.sku],{isSizeShow:a,sizeUrl:d,recommendItem:r});e&&e()};if(i.sizeData[u.sku]){e&&e()}else{t.loadScript("//wq.jd.com/cmdetail/GetAllCmdetail?callback=sizeInfoCB&wareid="+o)}}function h(){n.isBind=true;var e=function(e){var t=e.text(),r=e.attr("no")||"",a=function(){if(e.hasClass(u.disabledClass)){if(r=="1"&&s("#sku2 "+u.optionItem).length){s("#sku1 "+u.optionItem).removeClass(u.disabledClass);e.removeClass(u.disabledClass).addClass(u.selectedClass);c(r,t);n.jdSkuStatus=false}return[]}var a=r=="1"?"2":"1";if(e.hasClass(u.selectedClass)){e.removeClass(u.selectedClass);s("#sku"+a+" "+u.optionItem).removeClass(u.disabledClass)}else{e.addClass(u.selectedClass).siblings().removeClass(u.selectedClass);c(r,t)}return[s("#sku1 ."+u.selectedClass).text(),s("#sku2 ."+u.selectedClass).text(),s("#sku3 ."+u.selectedClass).text()].filter(function(e){return e})},d=function(){var a=s("#sku"+r+" "+u.optionItem),i=u.selectedClass;if(e.hasClass(i)){a.removeClass(i);k();return[]}a.removeClass(i).attr("dissel","0");e.removeClass(u.disabledClass).addClass(i);k({skuNo:r,cName:t});var n=s("#"+u.skuCon+" "+u.optionItem+"."+i),o=[];for(var d=0,l=n.length;d<l;d++){o.push(n.eq(d).text())}return o},l=d();var f=l.length>0?n.skuPro.name[l.join("~~")]:"";if(f){n.jdSkuStatus=true;n.changeSkuId=f;i.skuChooseArr=l;o()}else{n.jdSkuStatus=false}i.jdSkuStatus=n.jdSkuStatus};s("#"+u.skuCon).off().on(u.clickEvent,u.optionItem,function(){e(s(this))});var t=s(u.numInputSelector),r=s(u.numMinusSelector),a=s(u.numPlusSelector);if(t.length){t.off().on("input",function(){if(this.value&&i.skuData[n.skuId].minBuyNum==1){p(this.value,true)}}).on("blur",function(){p(this.value,true)})}if(r.length&&a.length){r.off().on(u.clickEvent,function(){var e=s(this);if(e.hasClass(u.numMinusDisableCls&&i.skuData[n.skuId].minBuyNum==1)){return}p(i.buyNum-1,true)});a.off().on(u.clickEvent,function(){var e=s(this);if(e.hasClass(u.numPlusDisableCls&&i.skuData[n.skuId].minBuyNum==1)){return}p(i.buyNum+1,true)})}}function p(e,t){var r=i.skuData[n.skuId],a=r.minBuyNum||1,o=Math.min(r.maxBuyNum||200,r.stockNum||200);e=e*1||a;var d=e;e=Math.max(a,e);e=Math.min(o,e);if(a>o){e=a}i.buyNum=e;u.numChangeCB&&u.numChangeCB();var l=s(u.numInputSelector),c=s(u.numMinusSelector),f=s(u.numPlusSelector);l.val(e);var k=a>o?"该商品"+a+"件起售，库存不足~":d<a&&a>1?"该商品"+a+"件起售，多买多优惠~":d>o?"该商品最多可买"+o+"件":"";if(k&&t){u.numChangeTipCB&&u.numChangeTipCB(k)}if(!c.length||!f.length){return}if(e==a){c.addClass(u.numMinusDisableCls)}else{c.removeClass(u.numMinusDisableCls)}if(o>e){f.removeClass(u.numPlusDisableCls)}else{f.addClass(u.numPlusDisableCls)}}function C(){var e=i.item[n.skuId]||{},t=e.spAttr||{},r=n.jdSkuInfo[n.skuId]||{},a=i.skuData[n.skuId]||{},u=e.category||[];s.extend(a,{isCart:true,isBuy:true,hasStock:true,btnTxt:"立即购买",wareOff:false,isYushouNoWay:false,isYushou:false,isKO:false,maxBuyNum:200,stockNum:200,minBuyNum:1,cartTip:"",buyTip:""});if(r.huanUrl){a.isCart=false;a.isBuy=false;a.cartTip="该商品属于换区商品，暂不支持加车";a.buyTip="该商品属于换区商品，暂不支持购买";return}if(r.errCode=="20160304"){a.isCart=false;a.isBuy=false;a.cartTip="该商品信息不存在，暂不支持加车";a.buyTip="该商品信息不存在，暂不支持购买";return}if(r.pingou&&r.pingou==1){a.isCart=false;a.isBuy=false;a.cartTip="该商品属于拼购商品，暂不支持加车";a.buyTip="该商品属于拼购商品，暂不支持购买";return}if(u[2]=="6980"){a.isCart=false;a.isEcard=true;a.cartTip="e卡暂不支持加车"}if(e.warestatus!="1"){a.isCart=false;a.isBuy=false;a.wareOff=true;a.cartTip="该商品已下柜";a.buyTip="该商品已下柜";return}if(t.YuShouNoWay=="1"&&t.YuShou=="1"){a.isCart=false;a.isBuy=false;a.isYushouNoWay=true;a.btnTxt="支付定金";a.cartTip="该商品属于预售商品，暂不支持加车";a.buyTip="该商品属于预售商品，暂不支持购买";return}if(t.YuShou=="1"){a.isCart=false;a.isBuy=false;a.isYushou=true;a.btnTxt="立即预约";a.maxBuyNum=1;a.cartTip="该商品属于预约商品，暂不支持加车";a.buyTip="该商品属于预约商品，暂不支持购买";return}if(t.isKO=="1"||r.miao&&r.miao.isKo=="1"){a.isCart=false;a.isBuy=false;a.isKO=true;a.btnTxt="立即抢购";a.maxBuyNum=1;a.cartTip="该商品属于抢购商品，暂不支持加车";a.buyTip="该商品属于抢购商品，暂不支持购买";return}if(t.LowestBuy>1&&t.LowestBuy<200){a.minBuyNum=t.LowestBuy;if(i.buyNum<a.minBuyNum)i.buyNum=a.minBuyNum}var o=r.stock;if(o){a.stock=o;var d=o.rn||"200",l=o.StockState;if(d<6&&d>0){a.stockNum=d*1;if(a.minBuyNum>a.stockNum){l=34}}switch(l){case 33:case 39:case 40:case 36:a.hasStock=true;break;case 0:case 34:default:a.hasStock=false;a.isCart=false;a.isBuy=false;break}}if(!a.hasStock){var c=w().name.split("_");c=c[0]+c[1];a.cartTip="无货，或此商品不支持配送至"+c;a.buyTip="无货，或此商品不支持配送至"+c}}function I(e){var t=(w().id||"").split("_");if(t[1]&&t[1]!=n.addrId[1]){s.extend(i,{skuChooseArr:[],noSkuArea:{},item:{},skuData:{},skuId:u.sku,price:{},buyNum:u.buyNum});s.extend(n,{jdSkuInfo:{},skuPro:{},skuId:u.sku,changeSkuId:u.sku,isBind:true,jdSkuStatus:true,addrId:t});o()}if(e&&(e.sku!=u.sku||e.isForceChg)){s.extend(u,e);s.extend(i,{skuChooseArr:[],skuId:u.sku,buyNum:u.buyNum});s.extend(n,{skuPro:{},skuId:u.sku,changeSkuId:u.sku,isBind:false,jdSkuStatus:true});o()}else{u.cb&&u.cb(true)}}function v(){var e=i.skuData[n.skuId];if(!e)return false;if(!e.isCart){return false}if(!n.jdSkuStatus){return false}return["//wq.jd.com/deal/mshopcart/addcmdy?callback=addCartCB&scene=2&reg=1&type=0","commlist="+[n.skuId,"",i.buyNum,n.skuId,"1,0,0"].join(","),"locationid="+[n.addrId.slice(0,3).join("-")],"t="+Math.random()].join("&")}function S(e){var s="";var a=i.skuData[n.skuId],o=a?n.jdSkuStatus?a.cartTip:"请选择商品属性":"商品信息未加载，请稍后再试";if(o){e&&e({msg:o,code:"systemError"});return}if(n.holdAdd)return;n.holdAdd=true;if(u.needFav){y()}if(u.needCheaper){b()}setTimeout(function(){n.holdAdd=false},500);window.addCartEventCB=function(t){n.holdAdd=false;if(t.errId=="0"){o="添加成功";s="success"}else if(t.errId=="13"){r.login()}else if(t.errId=="8968"){o="商品数量最大超过200";s="systemError"}else if(t.errId=="8969"){o="添加商品失败，已超出购物车最大容量！";s="systemError"}else{o="添加失败，请稍后再试";s="systemError"}e&&e({msg:o,code:s})};t.loadScript(["//wq.jd.com/deal/mshopcart/addcmdy?callback=addCartEventCB&scene=2&reg=1&type=0","commlist="+[n.skuId,"",i.buyNum,n.skuId,"1,0,0"].join(","),"locationid="+[n.addrId.slice(0,3).join("-")],"t="+Math.random()].join("&"))}function g(){var e=i.skuData[n.skuId];if(!e)return false;if(!e.isBuy){return false}if(!n.jdSkuStatus){return false}var s="";if(P("weixinadkey")){s="&weixinadkey="+P.get("weixinadkey")}var t="&wdref="+encodeURIComponent(location.href);var r=["//wqs.jd.com/order/wq.confirm.shtml?bid="+s+t,"scene=jd&isCanEdit=1&EncryptInfo=&Token=&commlist="+[n.skuId,"",i.buyNum,n.skuId,"1,0,0"].join(","),"locationid="+n.addrId.slice(0,3).join("-"),"type=0&lg=0&supm=0"];if(e.isEcard)r.push("eCard=1");if(u.cgiSource=="broadcast"&&B("roomId"))r.push("roomId="+B("roomId"));return r.join("&")+"#wechat_redirect"}function y(){if(n.jdSkuInfo["fav"+n.skuId])return;var e=i.item[n.skuId]||{};window.addFavCB=function(e){if(e.iRet=="0"||e.iRet=="3"){n.jdSkuInfo["fav"+n.skuId]=true}};t.loadScript("//wq.jd.com/fav/comm/FavCommAdd?callback=addFavCB&commId="+n.skuId+"&category="+(e.category||[]).slice(0,3).join("_")+"&t="+Math.random())}function b(){if(n.jdSkuInfo["cheaper"+n.skuId])return;var e=i.price[n.skuId]||{};if(e.p>0){window.cheaperCB=function(e){if(e.errcode==0){n.jdSkuInfo["cheaper"+n.skuId]=true}};t.loadScript("//wq.jd.com/commodity/notify/SubscribePrice?sku="+n.skuId+"&callback=cheaperCB&src=coss&price="+e.p*100+"&addr="+n.addrId.join("_")+"&t="+Math.random())}}function j(e){if(!e||!e.sku||!(e.actPrice>0)){console.log("订阅参数有问题");return}if(n.jdSkuInfo["actCheaper"+e.sku])return;if(n.holdCheaper)return;n.holdCheaper=true;setTimeout(function(){n.holdCheaper=false},500);e.actPrice=(e.actPrice*1+1).toFixed(2);e.src=e.src||"coss";var s="actCheaperCB";while(window[s]){s+="Az"}window[s]=function(s){n.holdCheaper=false;if(s&&s.errcode==0){n.jdSkuInfo["actCheaper"+e.sku]=true}};t.loadScript("//wq.jd.com/commodity/notify/SubscribePrice?sku="+e.sku+"&callback="+s+"&src="+e.src+"&price="+e.actPrice*100+"&addr="+n.addrId.join("_")+"&t="+Math.random())}function w(){var e=(P("wq_addr")||"").split("|"),s=function(e,s){if(!e)return"";var t=e.split("_");for(var r=0;r<4;r++){t[r]=t[r]||s}t=t.slice(0,4);return t.join("_")};if(e.length>4){var t=e.slice(3);e[3]=t.join("|")}e=e.slice(0,4);if(e.length!=4)e=[];return{addrId:e[0]||"0",addrName:e[3]||"",id:s(e[1]||P("jdAddrId"),"0")||"19_1607_3155_0",name:s(e[2]||P("jdAddrName"),"")||"广东_深圳市_南山区_"}}function B(e,s){var t=arguments[1]||window.location.search,r=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),a=t.substr(t.indexOf("?")+1).match(r);return a!=null?a[2]:""}function N(e,s){return s.replace(/{#(\w+)#}/g,function(s,t){return e[t]===0?"0":e[t]||""})}function P(e){var s=new RegExp("(^| )"+e+"(?:=([^;]*))?(;|$)"),t=document.cookie.match(s);return t?t[2]?unescape(t[2]):"":""}exports.outVar=i;exports.resetOpt=I;exports.getBuyLink=g;exports.getCartLink=v;exports.addCartEvent=S;exports.loadSizeInfo=m;exports.getAddrInfo=w;exports.skuActCheaper=j});define('wg.jdgiftpool',function(require,exports,module){var _cacheThisModule_;var $=require('zepto'),mFJ=require('formatJson'),mShopcartModel=require('wg.jdshopcart.model'),gsPid,gsSkuid,gdList,oSuit,oSku,gsType,sGiftCmdtyTmpl,oScrollCtrl,oSCModel,gsSelectedGifId='',gdContainer;function showGiftList(){if(window.goShopCartData){document.title='赠品';$('#mainViewFoot').hide();if(gsPid>0){oSuit=goShopCartData[gsPid];oSku=oSuit.products.filter(function(el){return el.mainSku.id==gsSkuid;})[0];}else{oSku=goShopCartData[gsSkuid];}
if(oSku){gdList=$('#giftpooldiv');gdList.html(mFJ.formatJson(sGiftCmdtyTmpl,{listGiftPools:oSku.gifts.listGiftPools}));for(var i=0;i<oSku.gifts.listGiftPools.length;i++){checkSelectedGift(oSku.gifts.listGiftPools[i].PoolNo,oSku.gifts.listGiftPools[i].skus.filter(function(el){return el.selectState==2;})[0].id);}
$('#giftpooldiv li').on('click',function(){if(!$(this).hasClass('active')){$(this).parent().find('li').removeClass('active');$(this).addClass('active');var sid=$(this).attr('data-sid');checkSelectedGift(sid.split('_')[0],sid.split('_')[1]);}});$('#poolsubmit').unbind().on('click',function(){var idlist=[];$('#giftpooldiv li.active').forEach(function(item){idlist.push($(item).attr('data-sid').split('_')[1]);});oSCModel.addCmdty({commlist:gsSkuid+',,1,0,1,'+(gsPid>0?gsPid:'')+',,'+idlist.join('_'),type:6,locationid:gsAddrId},function(obj){window.IChangeGift(obj);});})}}else{location.href="#";}}
function checkSelectedGift(PoolNo,id){var poolitem=oSku.gifts.listGiftPools.filter(function(element){return element.PoolNo==PoolNo;})[0];var okuitem=poolitem.skus.filter(function(el){return el.id==id;})[0];$('#detail_'+PoolNo).attr('href','//wq.jd.com/item/view?sku='+id).html(' <img src="//img13.360buyimg.com/n3/'+okuitem.image+'" alt="'+okuitem.name+'"><div class="content"><h1 class="title">'+okuitem.name+'</h1><p class="prop_and_num"><em class="prop">赠品</em><span class="num">x'+okuitem.num+'</span></p></div>');}
function createCheckBoxGroup(){var oCBGroup=new checkbox({arrItem:gdList.find('.item'),max:oSuit.canSelectedGiftNum*1,onSelected:function(arrSelectedItem){var arrId=[];for(var i=0;i<arrSelectedItem.length;i++){arrId.push(arrSelectedItem[i].id);}
gsSelectedGifId=arrId.join(',');}});}
exports.show=function(view){oSCModel=mShopcartModel.init();view.html($('#giftpoolConTmpl').html());gdContainer=$(window);sGiftCmdtyTmpl=$('#giftpoolTmpl').html();gdContainer.scrollTop(0);gsPid=JD.url.getHashParam('pid');gsSkuid=JD.url.getHashParam('gsskuid');gsType=JD.url.getHashParam('type');showGiftList();}})
define("wq.skuImgPrice",function(require,exports,module){var _cacheThisModule_,mLs=require('loadJs'),isWX=/micromessenger(\/[\d\.]+)*/.test(navigator.userAgent.toLowerCase()),jdAddrId=getAddrInfo().id,cgiUrl={price:'//pe.3.cn/prices/pcpmgets?',imgTitle:'//yx.3.cn/service/info.action?'};function getCookie(name){var reg=new RegExp("(^| )"+name+"(?:=([^;]*))?(;|$)"),val=document.cookie.match(reg);return val?(val[2]?unescape(val[2]).replace(/(^")|("$)/g,""):""):null;}
function getAddrInfo(){var wq_addr=(getCookie('wq_addr')||'').split('|'),fourStr=function(str,flag){if(!str)return'';var arr=str.split('_');for(var i=0;i<4;i++){arr[i]=arr[i]||flag;}
arr=arr.slice(0,4);return arr.join('_');};if(wq_addr.length>4){var wq_detail=wq_addr.slice(3);wq_addr[3]=wq_detail.join('|');}
wq_addr=wq_addr.slice(0,4);if(wq_addr.length!=4)wq_addr=[];return{addrId:wq_addr[0]||'0',addrName:wq_addr[3]||'',id:fourStr(wq_addr[1]||getCookie('jdAddrId'),'0')||'19_1607_3155_0',name:fourStr(wq_addr[2]||getCookie('jdAddrName'),'')||'广东_深圳市_南山区_'};}
function getImgTitleBySkus(opt){opt=opt||{};var skus=opt.skus,imgIndex=opt.imgIndex,callback=opt.callback,skusImgTitle=[],cbKey='imgTitleBySkusCB',u_source=opt.u_source||'wxsqpage',abortRequset=false;while(window[cbKey]){cbKey+='Az';}
window[cbKey]=function(json){if(abortRequset)return;if(json){for(var skuId in json){skusImgTitle.push({sku:skuId,img:imgIndex?'//img10.360buyimg.com/n'+imgIndex+'/'+json[skuId].imagePath:json[skuId].imagePath,title:json[skuId].name});}
callback&&callback(skusImgTitle);}};mLs.loadScript({url:cgiUrl.imgTitle+'callback='+cbKey+'&u_source='+u_source+'&ids='+skus+'&area='+jdAddrId+'&origin='+(isWX?5:4)+'&t='+Math.random(),timeout:opt.timeout||8000,onError:function(){opt.onError&&opt.onError();},onTimeout:function(){abortRequset=true;opt.onTimeout&&opt.onTimeout();}});}
function getPriceBySkus(opt){opt=opt||{};var skus=opt.skus,callback=opt.callback,iitem={},skusPrice=[],cbKey='priceBySkusCB',abortRequset=false;while(window[cbKey]){cbKey+='Az';}
window[cbKey]=function(json){if(abortRequset)return;if(json){for(var i=0,leni=json.length;i<leni;i++){iitem=json[i];skusPrice.push({sku:iitem.id,price:iitem.p,marketPrice:iitem.m,pcPrice:iitem.pcp||''});}
callback&&callback(skusPrice);}};mLs.loadScript({url:cgiUrl.price+'callback='+cbKey+'&source='+(opt.source?opt.source:'wxsq')+'&skuids='+skus+'&area='+jdAddrId+'&origin='+(isWX?5:4)+'&t='+Math.random(),timeout:opt.timeout||8000,onError:function(){opt.onError&&opt.onError();},onTimeout:function(){abortRequset=true;opt.onTimeout&&opt.onTimeout();}});}
function getImgTitlePriceBySkus(opt){var skusImgTitle=null,skusPrice=null,callback=opt.callback,imgTitlePriceCB=function(){if(skusImgTitle&&skusPrice){for(var i=0,leni=skusImgTitle.length;i<leni;i++){for(var j=0,lenj=skusPrice.length;j<lenj;j++){if(skusImgTitle[i].sku==skusPrice[j].sku){skusImgTitle[i].price=skusPrice[j].price;skusImgTitle[i].marketPrice=skusPrice[j].marketPrice;skusImgTitle[i].pcPrice=skusPrice[j].pcPrice;}}}
callback&&callback(skusImgTitle);}};getImgTitleBySkus({skus:opt.skus,timeout:opt.timeout,onTimeout:opt.onTimeout4ImgTitle,onError:opt.onError4ImgTitle,imgIndex:opt.imgIndex,callback:function(d){skusImgTitle=d;imgTitlePriceCB();}});getPriceBySkus({skus:opt.skus,timeout:opt.timeout,onTimeout:opt.onTimeout4Price,onError:opt.onError4Price,callback:function(d){skusPrice=d;imgTitlePriceCB();}});}
exports.jdAddrId=jdAddrId;exports.getImgTitleBySkus=getImgTitleBySkus;exports.getPriceBySkus=getPriceBySkus;exports.getImgTitlePriceBySkus=getImgTitlePriceBySkus;});
define('wq.uiforcart',function(require,exports,module){var _cacheThisModule_,container=document.body;var alertCoverDiv=document.createElement('div');alertCoverDiv.style.cssText="position: fixed; width: 100%; height: 100%; top: 0px; left: 0px; z-index: 109; background: rgba(0, 0, 0, 0.3);";function showTip(obj){if(!obj)return;var className=obj.className||'g_small_tips',tips=document.querySelector("."+className),t=obj.t||2000,title=obj.title||'操作成功!';if(!tips){tips=document.createElement('div');tips.className=className;document.body.appendChild(tips);}
tips.innerText=title;tips.style.display='block';setTimeout(function(){tips.style.display='none';},t);}
function extend(a,b){for(var i in b){if(b.hasOwnProperty(i)){a[i]=b[i];}}
return a;}
function info(opts){var option={msg:"",icon:"none",delay:2000};opts=opts||{};extend(option,opts);var el=document.createElement('div');el.className="mod_alert show fixed";el.innerHTML=(option.icon!='none'?('<i class="icon'+(option.icon!='info'?(' icon_'+option.icon):'')+'"></i>'):'')+'<p>'+option.msg+'</p>';container.appendChild(el);setTimeout(function(){el.style.display='none';container.removeChild(el);},option.delay);}
function alert(opts){var option={msg:"",submsg:"",confirmText:'确认',icon:"none",onConfirm:null,stopMove:false},stopMove=function(e){e.preventDefault();},el=document.createElement('div');opts=opts||{};extend(option,opts);el.className="mod_alert show fixed";el.innerHTML=(option.icon!='none'?('<i class="icon'+(option.icon!='info'?(' icon_'+option.icon):'')+'"></i>'):'')+'<p>'+option.msg+'</p><p class="sub_alert">'+option.submsg+'</p><p class="btns"><a href="javascript:;" class="btn btn_1">'+option.confirmText+'</a></p>';container.appendChild(el);el.querySelector(".btn").onclick=function(e){document.body.removeChild(alertCoverDiv);option.onConfirm&&option.onConfirm();el.style.display='none';this.onclick=null;container.removeChild(el);option.stopMove&&document.removeEventListener("touchmove",stopMove,false);};document.body.appendChild(alertCoverDiv);option.stopMove&&document.addEventListener("touchmove",stopMove,false);}
function confirm(opts){var option={msg:"",icon:"none",okText:"确定",cancelText:"取消",memo:'',onConfirm:null,onCancel:null};opts=opts||{};extend(option,opts);var el=document.createElement('div');el.className="mod_alert show fixed";el.innerHTML=(option.icon!='none'?('<i class="icon'+(option.icon!='info'?(' icon_'+option.icon):'')+'"></i>'):'')+'<p>'+option.msg+'</p>'+(option.memo.length>0?('<p class="alignLeft small">'+option.memo+'</p>'):'')+'<p class="btns"><a href="javascript:;" id="ui_btn_cancel" class="btn btn_2">'+option.cancelText+'</a><a href="javascript:;" id="ui_btn_confirm" class="btn btn_1">'+option.okText+'</a></p>';container.appendChild(el);document.body.appendChild(alertCoverDiv);el.querySelector("#ui_btn_cancel").onclick=function(e){option.onCancel&&option.onCancel();clear();};el.querySelector("#ui_btn_confirm").onclick=function(e){option.onConfirm&&option.onConfirm();clear();};function clear(){el.style.display='none';container.removeChild(el)
document.body.removeChild(alertCoverDiv);}}
module.exports={showTip:showTip,info:info,alert:alert,confirm:confirm};});
define('wg.jdshopcoupon',function(require,exports,module){var _cacheThisModule_;var $=require('zepto'),mFJ=require('formatJson'),mShopcartModel=require('wg.jdshopcart.model'),ui=require("wq.uiforcart"),venderid,mLoad=require('loadJs'),sGiftCmdtyTmpl=$('#counponTmpl').html(),couponProTmpl=$('#couponProTmpl').html(),oSCModel,gsSelectedGifId='',gdContainer;window.couponSkuImgObj={};function myAlert(msg,callback,confirmText,iconstyle,submsg){ui.alert({icon:iconstyle||'info',msg:msg,submsg:submsg||'',confirmText:confirmText||'确认',onConfirm:function(){if(callback){callback();}}});}
function myConfirm(msg,icon,okText,cancelText,onConfirm,iconstyle,memo){var opt={};opt.msg=msg;icon.length>0?opt.icon=icon:'';okText.length>0?opt.okText=okText:'';cancelText.length>0?opt.cancelText=cancelText:'';opt.icon=iconstyle||'info';opt.onConfirm=onConfirm;opt.memo=memo?memo:'';ui.confirm(opt);if(!msg){$(".alignLeft").removeClass('small');}}
function getImgTitleBySkus(opt){opt=opt||{};var skus=opt.skus||[],getSkuArr=[],callback=opt.callback;skus.forEach(function(el){if(!window.couponSkuImgObj[el]){getSkuArr.push(el);}});window.imgTitleBySkusCB=function(json){if(json){for(var skuId in json){window.couponSkuImgObj[skuId]='//img10.360buyimg.com/n4/'+json[skuId].imagePath;}
callback&&callback();}};if(getSkuArr.length>0){var jdAddrId=JD.cookie.get('jdAddrId')||JD.cookie.get('jdLOCAddrId')||'19_1607_3155_0',isWX=/micromessenger(\/[\d\.]+)*/.test(navigator.userAgent.toLowerCase());mLoad.loadScript('//yx.3.cn/service/info.action?callback=imgTitleBySkusCB&ids='+skus.join(',')+'&area='+jdAddrId+'&origin='+(isWX?5:4)+'&t='+Math.random());}else{callback&&callback();}}
function showCouponList(){var drawTips={999:'优惠券将在1分钟内到账，请稍后前往个人中心查看~',3:'为了保障您的账户安全， 请开启支付密码再领券吧~',5:'貌似领不了哟，看一下其他活动吧~',6:'没有找到该链接的活动，请您看一下其他活动吧~',7:'没有找到该链接的活动，请看一下其他活动吧~',8:'您来太晚了，活动已经结束了哟~',9:'您来早了，活动还没开始哟，请稍后再来~',10:'您来早了，今天的活动还未开始哟，请稍后再试~',11:'您来太晚了，今天活动已经结束了哟，谢谢您的关注~',12:'您的账户级别稍微有点低，需再接再厉哟~',14:'您已经参加过此活动，别太贪心哟，下次再来~',15:'您今天已经参加过此活动，别太贪心哟，明天再来~',16:'此券今日已经被领完，请您明日再来~',17:'此券已经被领完了，下次记得早点来哟~',18:'您提交过于频繁，请30秒后再试~',19:'貌似有点小问题，您可以30秒后再试一下哟~',21:'您提交的过于频繁，请50秒稍后重试~',22:'十分抱歉，领券失败了哟，感谢您的参与~',26:'貌似有点小问题呀，请稍候再试~',27:'貌似有点小问题呀，请稍候再试~',30:'亲爱的用户，您还不是PLUS会员哟~现在就去开通吧',31:'您的账户级别稍微有点低，需再接再厉哟~',32:'活动太火爆，请您一会再来吧~',1002:'访问的人太多，请稍后再试吧~',1003:'此时间段优惠券已发完，请稍后再试'};if(window.shopCouponData&&window.shopCouponData[venderid]){var couponlist=window.shopCouponData[venderid];var couponFilData={'hasCanGet':false,'hasCanUse':false,"filGetData":[],"filUseData":[]};var skulistFil=[];document.title='优惠券';$('#mainViewFoot').hide();couponlist.forEach(function(item){if(item.couponDo==1){couponFilData.filGetData.push(item);}
if(item.couponDo==2){couponFilData.hasCanUse=true;couponFilData.filUseData.push(item);}
if(item.beginTime>0){item.beginTimeDate=new Date(parseInt(item.beginTime));item.beginTimeStr=item.beginTimeDate.getFullYear()+'.'+(item.beginTimeDate.getMonth()+1)+'.'+item.beginTimeDate.getDate();if(item.hourCoupon==2){item.beginTimeStr+=' '+fixTimeSrt(item.beginTimeDate.getHours())+':'+fixTimeSrt(item.beginTimeDate.getMinutes());}}
if(item.endTime>0){item.endTimeDate=new Date(parseInt(item.endTime));item.endTimeStr=item.endTimeDate.getFullYear()+'.'+(item.endTimeDate.getMonth()+1)+'.'+item.endTimeDate.getDate();if(item.hourCoupon==2){item.endTimeStr+=' '+fixTimeSrt(item.endTimeDate.getHours())+':'+fixTimeSrt(item.endTimeDate.getMinutes());}}
if(item.limitType=='0'){item.timeDesc='有效期至'+item.endTimeStr;}else if(item.limitType=='1'){item.timeDesc='领取之后'+item.addDays+'天内有效';}else{item.timeDesc=item.beginTimeStr+' 至 '+item.endTimeStr;}
item.skuidlist.forEach(function(el){if(item.couponKind!=="0"&&skulistFil.indexOf(el)==-1){skulistFil.push(el);}});});couponFilData.filGetData=uniqueCoupon(couponFilData.filGetData,couponFilData.filUseData);if(couponFilData.filGetData.length){couponFilData.hasCanGet=true;couponFilData.filGetData.sort(function(a,b){return a.discount-b.discount;});}
couponFilData.filUseData.sort(function(a,b){return a.discount-b.discount;});getImgTitleBySkus({skus:skulistFil,callback:function(){couponFilData.canUseHtml=mFJ.formatJson(couponProTmpl,{data:couponFilData.filUseData,skuImgObj:window.couponSkuImgObj});couponFilData.canGetHtml=mFJ.formatJson(couponProTmpl,{data:couponFilData.filGetData,skuImgObj:window.couponSkuImgObj});$('#counpondiv').html(mFJ.formatJson(sGiftCmdtyTmpl,{couponlist:couponFilData}));$('#counpondiv .mod_coupon_l').unbind().on('click',function(){var me=this;if(!$(this).hasClass('disClickJs')){var key=$(me).attr('key'),roleid=$(me).attr('roleid');var bindMsg=["","您正在领取京东优惠券，请先填写手机号码。","您正在领取京东优惠券，请先登录京东账号。","您正在领取京东优惠券，请先使用京东账号xxx登录。"];getPinStatus(null,bindMsg,function(json){JD.store.setItem('cartShimingCoupon',key+"|"+roleid,null,null,null,true);json.url=json.url.replace(/^http:/,"");tipurl=replaceParam('sceneid',5290181,json.url,true);location.href=tipurl;},function(){oSCModel.obtainShopCoupon(key,roleid,3,function(obj){window.IFleshCoupon(function(){if(obj.code==34){myConfirm("领券失败！",'','去实名','取消',function(){JD.store.setItem('cartShimingCoupon',key+"|"+roleid,null,null,null,true);location.href='//wq.jd.com/vipplus/LoginBrigdeAuthNameAll?callback=shiming&scene='+(JD.device.scene=='weixin'?'weixin':'qq')+'&bussinessType=517&rurl='+encodeURIComponent(location.protocol+'//wqs.jd.com/my/cart/jdshopcart.shtml');},'',"实名用户才可以领取该券，请先完成实名认证。");}else if(obj.code==163){getPinStatus(null,function(json){json.url=json.url.replace(/^http:/,"");tipurl=replaceParam('sceneid',5290181,json.url,true);location.href=tipurl;},bindMsg);}else{if(obj.code==999){myAlert('领券成功!',function(){},'','icon icon_success',drawTips[obj.code]);$(me).addClass('disClickJs');$(me).find('[takenTag]').show();}else if(drawTips[obj.code]){myAlert(drawTips[obj.code]);}}});});});}});$('#shopcoupontipid').off().on('click',function(){$('#shopcoupontip').show();});$('#shopcoupontipclose').off().on('click',function(){$('#shopcoupontip').hide();});initEvent(couponlist);}});}else{location.href="#";}}
function initEvent(couponlist){var couponUseJs=$(".couponUseJs"),couponGetJs=$(".couponGetJs"),cAsideTop=$(".coupon_aside_top"),cAsideBtm=$(".coupon_aside_btm"),screenH=$(window).height(),pageTop,pageBottom,offsetSize,itemTop,itemBottom;$('#couponSkuMore').off().on('click',function(){var batchId=$(this).attr('batchId'),manVal=$(this).attr('manVal'),disVal=$(this).attr('disVal'),imgDatas=[];var filItem=couponlist.filter(function(el){return el.batchId==batchId;})[0];if(filItem){filItem.skuidlist.forEach(function(el){imgDatas.push(window.couponSkuImgObj[el]);});$("#samsTip").addClass('goods_msg_update');$("#samsTip").html(mFJ.formatJson($("#samsTipTpl").html(),{data:imgDatas,elseObj:{'text1':'满'+manVal+'减'+disVal+'优惠券','text2':'适用于当前购物车以下商品'}})).show().parent().addClass('show');}});if(couponUseJs.length&&couponGetJs.length){$(window).on("scroll",function(){pageTop=$(document.body).scrollTop();pageBottom=screenH+pageTop;offsetSize=couponGetJs.offset();itemTop=offsetSize.top,itemBottom=itemTop+offsetSize.height;if(itemTop>pageBottom){cAsideTop.show();cAsideBtm.hide();}else if(itemBottom<pageTop){cAsideTop.hide();cAsideBtm.show();}else{cAsideTop.hide();cAsideBtm.hide();}});}
$(".coupon_aside_item").on('click',function(event){event.preventDefault();if($(this).hasClass('coupon_aside_top')){$(window).scrollTop(couponGetJs.offset().top);}else{$(window).scrollTop(couponUseJs.offset().top);}});}
function uniqueCoupon(arr1,arr2){var uniqueArr=function(arr){var newArray=[];var oldArray=arr;if(oldArray.length<=1){return oldArray;}
for(var i=0;oldArray.length>0;i++){newArray.push(oldArray.shift());for(var j=0;j<oldArray.length;j++){if((newArray[i].couponKind==2||newArray[i].couponKind==3)&&newArray[i].couponKind==oldArray[j].couponKind&&newArray[i].quota==oldArray[j].quota&&newArray[i].discount==oldArray[j].discount){oldArray.splice(j,1);j--;}}}
return newArray;}
arr1=uniqueArr(arr1);for(var i=0;i<arr1.length;i++){for(var j=0,lenj=arr2.length;j<lenj;j++){if((arr1[i].couponKind==2||arr1[i].couponKind==3)&&arr1[i].couponKind==arr2[j].couponKind&&arr1[i].quota==arr2[j].quota&&arr1[i].discount==arr2[j].discount){arr1.splice(i,1);i--;break;}}}
return arr1;};function getPinStatus(url,msgArr,failCb,sucCb){var rurl=url||location.href;oSCModel.getPinStatus({rurl:encodeURIComponent(rurl),sceneid:'5290181',source:(JD.device.scene=='weixin'?'2':'1')},function(json){if(json.errcode=='0'){if(json.state=='1'){myConfirm(msgArr[0],'','立即填写','下次再说',function(){failCb&&failCb(json);},'',msgArr[1]);}else if(json.state=='2'||json.state=='4'){myConfirm(msgArr[0],'','立即登录','下次再说',function(){failCb&&failCb(json);},'',msgArr[2]);}else if(json.state=='3'&&json.defaultFlag=='1'){myConfirm(msgArr[0],'','立即登录','下次再说',function(){failCb&&failCb(json);},'',msgArr[3].replace("xxx",(json.pinList.length&&json.pinList[0].pin)||""));}else{sucCb&&sucCb(json);}}});};function fixTimeSrt(str){return String(str).length===1?'0'+str:str+"";}
exports.show=function(view){document.title='优惠券';oSCModel=mShopcartModel.init();$("#moreAct").hide();view.html($('#counponConTmpl').html());gdContainer=$(window);gdContainer.scrollTop(0);venderid=JD.url.getHashParam('venderId');showCouponList();}})
define("util",function(require,exports,e){var _cacheThisModule_;var t=require("zepto"),n=require("loadJs");function r(e,n,r){var o=document.documentElement.clientHeight,i=t(document.body).scrollTop(),a=o+i,u=n||0,c=e.offset(),l=c.top-u,f=l+c.height,s=r||"";if(s==="up"){if(f<i){return true}}else if(s==="down"){if(l>a){return true}}else if(s==="partup"){if(l<i){return true}}else if(s==="partdown"){if(f>a){return true}}else{if(l<a&&l>i||f<a&&f>i){return true}else if(l<i&&f>a){return true}}return false}function o(e,t){var n=Date.now,r=0,o,i,a=function(){r=n();e.apply(o,i)};return function(){cur=n();o=this,i=arguments;if(cur-r>t){a()}}}function i(){var e,t,n=[];this.listen=function(e){if(typeof e==="function"){n.push(e)}};this.remove=function(e){if(typeof e!=="function")return;for(var t=0,r=n.length;t<r;t++){if(e===n[t]){n.splice(t,1)}}};document.addEventListener("touchstart",function(t){var n=t.touches[0];e=n.clientY});document.addEventListener("touchmove",function(n){var r=n.changedTouches[0],o=r.clientY;if(o-e>0){t="up"}else if(e-o>0){t="down"}});document.addEventListener("touchend",o(function(){r(t)},80));document.addEventListener("scroll",o(function(){r(t)},80));function r(e){for(var t=0,r=n.length;t<r;t++){n[t].apply(null,[e])}}}function a(e){try{var e=new Date(e);e=null;return true}catch(t){return false}}function u(e){var t=/{\d+}/g,n=Array.prototype.slice.call(arguments,1),r=e.toString();return r.replace(t,function(e){var t=e.substr(1,e.length-2);return typeof n[t]==="undefined"?e:n[t]})}function c(e){var t={bid:"1",mid:"01",res:[],onBeforeReport:null,delay:5e3};for(var r in e){t[r]=e[r]}if(t.res.length>0){window.reportWebInfo=function(e){};window.setTimeout(function(){t.onBeforeReport&&t.onBeforeReport(t);var e=t.bid+t.mid+"-"+t.res.join("|");var r="http://bases.wanggou.com/mcoss/webreport/ReportWebInfo?report="+e+"&t="+new Date/1e3;n.loadScript({url:r})},t.delay)}}function l(e,t){var n=arguments[1]||window.location.search,r=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),o=n.substr(n.indexOf("?")+1).match(r);return o!=null?o[2]:""}function f(e,t){var n=t?t.match(/#.*/)&&t.match(/#.*/)[0]||"":location.hash,r=t?t.replace(/#.*/,"").match(/\?.*/)&&t.replace(/#.*/,"").match(/\?.*/)[0]||"":location.search,o=t?t.replace(/#.*/,"").replace(/\?.*/,""):location.protocol+"//"+location.host+location.pathname;for(var i in e){var a=i+"="+e[i],u=l(i,r);if(u){r=r.replace(i+"="+u,i+"="+e[i])}else{r=r.length>0?r+"&"+a:"?"+a}}return o+r+n}function s(e){var t=new RegExp("(^| )"+e+"(?:=([^;]*))?(;|$)"),n=document.cookie.match(t);return n?n[2]?unescape(n[2]).replace(/(^")|("$)/g,""):"":null}function g(e,t,n,r,o,i){var a=new Date,n=arguments[2]||null,r=arguments[3]||"/",o=arguments[4]||null,i=arguments[5]||false;n?a.setMinutes(a.getMinutes()+parseInt(n)):"";document.cookie=e+"="+escape(t)+(n?";expires="+a.toGMTString():"")+(r?";path="+r:"")+(o?";domain="+o:"")+(i?";secure":"")}function d(e){var t=arguments[1]||location.hash;var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)");var r=t.substr(t.indexOf("#")+1).match(n);if(r!=null){return r[2]}return""}function p(e){return typeof e!="string"?"":e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&nbsp;/g," ").replace(/&#39;/g,"'").replace(/&amp;/g,"&")}function h(e){return typeof e!="string"?"":e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\'/g,"&apos;").replace(/ /g,"&nbsp;")}function v(e,t,n,r){var o=m(e);if(o>n-t){var r=r||"";var i=e.replace(/[\u00FF-\uFFFF]/g,"@-").substr(t,n);var a=i.match(/@-/g)?i.match(/@-/g).length:0;return e.substring(0,n-a)+r}return e}function m(e){return e.replace(/[\u00FF-\uFFFF]/g,"  ").length}function w(){var e=navigator.userAgent.toLowerCase();return e.match(/micromessenger/)?true:false}function y(e){window.localStorage.removeItem(e)}function S(e,t,n){window.localStorage.setItem(e,n?JSON.stringify(t):t)}function b(e){return window.localStorage.getItem(e)}function x(){if(!window.localStorage){return false}try{window.localStorage.setItem("test",true);window.localStorage.removeItem("test");return true}catch(e){return false}}function L(){var e=s("cid");if(e==2)return true;if(/qq\/([\d\.]+)*/i.test(navigator.userAgent)){return true}return false}function F(){var e=s("cid");if(e==1)return true;if(/MicroMessenger/i.test(navigator.userAgent)){return true}return false}function k(e){e[0].ontouchstart=t;function t(t){e[0].ontouchmove=n}function n(t){t.preventDefault();e[0].ontouchend=r}function r(){e[0].ontouchend=null;e[0].ontouchmove=null}}function A(e){if(s("wg_uin")&&s("wg_skey")){location.href=e}else{D(e)}}function D(e){e=e||location.href;if(F()){window.location.href="http://party.wanggou.com/tws64/m/wxv2/Login?appid=1&rurl="+encodeURIComponent(e)}else{window.location.href="http://party.wanggou.com/tws64/m/h5v1/cpLogin?rurl="+encodeURIComponent(e)+"&sid="+s("sid")+"&uk="+s("uk")}}function I(e,t){e=e.replace(/？/g,"?");var n=/ptag[=,]\d+\.\d+\.\d+/i,r=/\?/.test(e);hasAnchor=e.indexOf("#")>-1;if(n.test(e)){e=e.replace(n,"PTAG="+t)}else{e=hasAnchor?e.replace("#",(r?"&":"?")+"PTAG="+t+"#"):e+(r?"&":"?")+"PTAG="+t}return e}function R(e){var t=[];for(var n=0,r=e.length;n<r;n++){(","+t+",").indexOf(","+e[n]+",")<0?t.push(e[n]):""}return t}function q(e){var t=false;return function(){!t&&(t=!t,typeof e==="function"&&e.call())}}function E(e){var t,n;function r(e){if(e&&e.longitude){var t=JSON.stringify(e);JD.cookie.set("coords",t,60,"/","jd.com")}}function o(){var e;e=JD.cookie.get("coords");try{if(e){e=JSON.parse(e)}}catch(t){e=false;console.log(t)}if(!e||!e.longitude||!e.latitude){e=false;JD.cookie.del("coords","/","jd.com")}return e}function i(){if(/qq\/([\d\.]+)*/.test(navigator.userAgent.toLowerCase())){return true}return false}function a(){if(navigator.userAgent.indexOf("MicroMessenger")>0){return true}return false}t=o();if(t){e&&e(t)}else{if(a()){JD.wxapi.ready(function(t){t.beta=true;wx.getLocation({type:"gcj02",success:function(t){n={latitude:t.latitude,longitude:t.longitude};r(n);e&&e(n)}})})}else if(i()){mqq.sensor.getLocation(function(t,o,i){n={latitude:o,longitude:i};r(n);e&&e(n)})}else if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(t){n={latitude:t.coords.latitude,longitude:t.coords.longitude};r(n);e&&e(n)})}}}return{checkInScreen:r,delay:o,delegateMove:i,isDate:a,format:u,itilReport:c,getQuery:l,setQuery:f,getCookie:s,setCookie:g,getHash:d,htmlDecode:p,htmlEncode:h,strSubGB:v,strLenGB:m,canWxPay:w,isSupportStorage:x,isSQ:L,isWX:F,saveStorage:S,getStorage:b,removeStorage:y,preventPageScroll:k,loginLocation:A,login:D,addRd:I,arrayUniq:R,once:q,getMyLocation:E}});define('wq.address',function(require,exports,module){var _cacheThisModule_;var $=require('zepto'),ls=require('loadJs'),util=require('util'),login=require('login'),storage_version='jd_areamap_201609',isLogin=login.isLogin(),commonAddrHtml=[],usualAddrList=[],areaCgiHold=false,gpsHtml='',area=['全部'],areaId=['0'],addrId='',gpsChoice=false,addrName='',addrIdArr=[],addrNameArr=[],curAddr={},domainStr='jd.com',level=0,cache={},opt={con:'',title:'配送至',deep:4,commonType:'1',clickEvent:'click',onClose:function(){},isNeedCss:true,isNeedCommon:true,isNeedFixed:false,overClass:'overflowHide',isSearch:false};module.exports={init:init,show:show,reset:reset,getAddrInfo:getAddrInfo,setAddrCookies:setAddrCookies,clearCookies:clearCookies};function init(option){$.extend(opt,option);opt.commonType='1';if(!isLogin){opt.isNeedCommon=false;}
try{domainStr=(document.domain||'wq.jd.com').split('.').slice(-2).join('.');}catch(e){domainStr='jd.com';}
loadCss();setBasicDom();bindEvent();if(opt.commonType==1)$('#addrGps').hide();}
function show(lev){level=lev||0;showHidePopup(true);curAddr=getAddrInfo();if(opt.isNeedCommon){getCommonAddrV1();}else if(opt.commonType=='2'){getCommonAddrV1();getAreaList();}else{getAreaList();}}
function reset(){commonAddrHtml=[];isLogin=login.isLogin();usualAddrList=[];areaCgiHold=false;}
function prev(){if(level<=0){if(opt.isNeedCommon){getCommonAddrV1();}else{showHidePopup();opt.onClose&&opt.onClose();}
return;}
level--;getAreaList();}
function bindEvent(){$('#addrBody').off().on(opt.clickEvent,'[filter-type]',function(e){var tar=$(this),ftype=tar.attr('filter-type');isTab=(tar.attr('tag')=='1'),selectClass=(opt.isSearch?'selected':'on');if(isTab){tar.addClass('cur').siblings().removeClass('cur');}
if(ftype==='area'){if(areaCgiHold){areaCgiHold=false;level--;}
var tid=tar.attr('tid'),tname=tar.attr('tname'),extid=tar.attr('extid');if(extid){level=parseInt(extid,10)+1;}else{level++;}
if(!isTab){tar.addClass(selectClass).siblings().removeClass(selectClass);area[level]=tname;areaId[level]=tid;clearArea(level+1);}
if(level<opt.deep&&level<4){getAreaList(isTab);}
if(level>=opt.deep||level>=4){$('#ulAddrTab li.cur').hide();finish();}}else if(ftype==='common'){var $target=$(e.target);if($target.hasClass('mod_address_slide_list_1_warn')||$target.hasClass('mod_address_slide_list_1_edit')){var tempAddrId=tar.attr('addrid');showHidePopup();if(tempAddrId)location.href='//wqs.jd.com/my/my_address.shtml?ptag=7387.1.4#type=edit&adid='+tempAddrId;}else if(tar.attr('addrid')&&tar.attr('addrname')&&!tar.hasClass('disabled')){tar.addClass(selectClass).siblings().removeClass(selectClass);addrId=tar.attr('addrid');addrName=tar.attr('addrname');addrIdArr=(tar.attr('ids')||'').split('_');addrNameArr=(tar.attr('names')||'').split('_');finish();}}else if(ftype==='addaddr'){showHidePopup();location.href='//wqs.jd.com/my/my_address.shtml?ptag=7387.1.5#type=edit&adid=0';}else if(ftype==='areaaddr'){getAreaList();}else{finish();}});$('#addrGps').off().on(opt.clickEvent,'dl',function(e){var tar=$(this);tar.toggleClass('on');if(tar.hasClass('on')){addrId='';gpsChoice=true;addrIdArr=(tar.attr('ids')||'').split('_');addrNameArr=(tar.attr('names')||'').split('_');finish();}});if(opt.isSearch){$('#searchFoot').off().on(opt.clickEvent,function(e){getAreaList();});$('#searchPrev').off().on(opt.clickEvent,function(e){var tar=$(this),tag=tar.attr('tag');if(tag=='2'){if(opt.isNeedCommon){getCommonAddrV1();}else{showHidePopup();opt.onClose&&opt.onClose();}}else{showHidePopup();opt.onClose&&opt.onClose();}});}else{$('#popupAddr').off().on(opt.clickEvent,'i.close',function(){showHidePopup();opt.onClose&&opt.onClose();}).on(opt.clickEvent,'i.back',function(){getCommonAddrV1();});$('#addrBtn').off().on(opt.clickEvent,function(e){var tar=$(this),tag=tar.attr('tag');if(tag==='1'){getAreaList();}else if(tag==='3'){showHidePopup();location.href='//wqs.jd.com/my/my_address.shtml?ptag=7387.1.5#type=edit&adid=0';}});}}
function clearArea(num){if(num<areaId.length){for(var i=num,len=areaId.length;i<len;++i){delete areaId[i];delete area[i];}
areaId.length=num;area.length=num;}}
function getAreaList(flag){if(!$('#ulAddrTab').length||!$('#ulAddrList').length){var domStr='<ul class="mod_address_slide_tabs_1" id="ulAddrTab" style="display:none;"></ul><ul class="mod_address_slide_list_2" ptag="7387.1.2" id="ulAddrList" style="display:none;"></ul>';if(opt.isSearch){domStr='<div class="tab"><ul class="tab_list" id="ulAddrTab"></ul></div><div class="search_addrlayer_body_scroller"><div class="search_addrlayer_body_scroller_inner"><ul class="list_1" id="ulAddrList" style="display:none;"></ul></div></div>';}
$('#addrBody').html(domStr);}
if(opt.isSearch){$('#searchFoot').hide();$('#searchAddr').removeClass('with_foot');$('#searchPrev').attr('tag','2');}else{if($('#addrBtn').attr('tag')!=='3')$('#addrBtn').hide().parent().hide();$('#popupAddrHead').html((commonAddrHtml.length>0?'<i class="back">返回</i>':'')+'选择区域<i class="close"></i>');$('#popupAddr div.mod_address_slide_main').addClass('type_flex');}
if(!flag){if(level>0){var tabArr=[],searchStr=(opt.isSearch?' class="item"':'');for(var i=1;i<=level;i++){if(area[i])tabArr.push('<li tag="1"'+searchStr+(areaId[i-1]?' filter-type="area" tid="'+areaId[i-1]+'" tname="'+area[i-1]+'" extid="'+(i-2)+'"':'')+'><span>'+area[i]+'</span></li>');}
tabArr.push('<li tag="1"'+(areaId[level]?' filter-type="area" tid="'+areaId[level]+'" tname="'+area[level]+'" extid="'+(level-1)+'"':'')+' class="'+(opt.isSearch?'item ':'')+'cur"><span>请选择</span></li>');$('#ulAddrTab').html(tabArr.join('')).show();}else{$('#ulAddrTab').html('<li class="'+(opt.isSearch?'item ':'')+'cur"><span>请选择</span></li>').show();}}
var areaid=areaId[level];if(cache[areaid]&&cache[areaid].length>0){fillAreas(cache[areaid],flag);return;}
var areas=util.getStorage(storage_version);if(areas){areas=JSON.parse(areas);if(areas[areaid]&&areas[areaid].length>0){fillAreas(areas[areaid],flag);return;}}
var url='//d.jd.com/area/get?fid='+areaid+'&callback=getAreaList_callback';window.getAreaList_callback=function(list){areaCgiHold=false;var tempAreas=[];for(var i=0,len=list.length;i<len;++i){if(level==0){if(list[i].id>0&&list[i].id<100){tempAreas.push(list[i]);}}else{tempAreas.push(list[i]);}}
if(tempAreas.length>0){fillAreas(tempAreas,flag);cache[areaid]=tempAreas;!areas&&(areas={});areas[areaid]=tempAreas;util.saveStorage(storage_version,areas,true);}else{clearArea(level+1);finish();}};if(!areaCgiHold){areaCgiHold=true;ls.loadScript({url:url});}}
function finish(){showHidePopup();if(!gpsChoice)$('#addrGps dl').removeClass('on');if(addrId&&addrName){setAddrCookies({ids:addrIdArr,names:addrNameArr,id:addrId,name:addrName});addrId='';}else if(gpsChoice){gpsChoice=false;setAddrCookies({ids:addrIdArr,names:addrNameArr});}else{setAddrCookies({ids:areaId.slice(1),names:area.slice(1)});}
opt.onFinish&&opt.onFinish();}
function setAddrCookies(opt){opt=opt||{};var setCookieStorage=function(key,value){util.setCookie(key,value,999999,"/",domainStr);if(window.WQAPI)WQAPI.db.set(key,value);},ids=opt.ids,names=opt.names,id=opt.id,name=opt.name,flag=opt.flag;if(ids&&ids.length>1&&names&&names.length>1){for(var i=0;i<4;i++){ids[i]=ids[i]||'0';names[i]=names[i]||'';}
ids=ids.slice(0,4);names=names.slice(0,4);var wq_addr=[];if(!flag||(id&&name)){wq_addr.push(id||'0');wq_addr.push(ids.join('_'));wq_addr.push(names.join('_'));wq_addr.push(name||'');}else{wq_addr=(util.getCookie('wq_addr')||'').split('|');wq_addr[0]=wq_addr[0]||'0';wq_addr[1]=ids.join('_');wq_addr[2]=names.join('_');if(wq_addr.length>4){var wq_detail=wq_addr.slice(3);wq_addr[3]=wq_detail.join('|');}
wq_addr=wq_addr.slice(0,4);}
wq_addr[3]=(wq_addr[3]||'');setCookieStorage('wq_addr',wq_addr.join('|'));setCookieStorage('jdAddrId',ids.join('_'));setCookieStorage('jdAddrName',names.join('_'));}}
function fillAreas(areas,flag){if(opt.onRender){opt.onRender(areas,level);}else{var list=[];for(var i=0,len=areas.length;i<len;++i){list.push({datamark:'area',tid:areas[i].id,name:areas[i].name});}
var html=template(list),$dom=$('#ulAddrList');$dom.html(html).show();if(flag){var $curDom=$dom.find('[tid="'+areaId[level+1]+'"]'),selectClass=(opt.isSearch?'selected':'on');if(opt.isSearch)$dom=$('.search_addrlayer_body_scroller_inner');$dom.scrollTop(0);if($curDom.length>0){$curDom.addClass(selectClass).siblings().removeClass(selectClass);$dom.scrollTop($curDom.offset().top-$dom.offset().top-20);}}}
opt.onAfterRender&&opt.onAfterRender();}
function template(it){var out=[],searchStr=(opt.isSearch?' class="item"':'');for(var i=0,l=it.length;i<l;i++){out.push('<li'+searchStr+' filter-type="'+(it[i].datamark)+'" tid="'+(it[i].tid)+'" tname="'+(it[i].name)+'">'+it[i].name+'</li>');}
return out.join('');}
function getCommonAddr(){if(opt.isNeedCommon){if(opt.isSearch){$('#searchFoot').show();$('#searchAddr').addClass('with_foot');$('#searchPrev').attr('tag','1');}else{$('#popupAddrHead').html('选择地址<i class="close"></i>');}}
var $dom=$('#addrBody'),$gps=$('#addrGps'),selectClass=(opt.isSearch?'selected':'on'),scrollCur=function(){var $ul=$dom.find('ul'),$cur=$dom.find('li[addrid="'+curAddr.addrId+'"]');if(opt.isSearch)$ul=$('.search_addrlayer_body_scroller_inner');$ul.scrollTop(0);if($cur.length>0){$cur.addClass(selectClass).siblings().removeClass(selectClass);$ul.scrollTop($cur.offset().top-$ul.offset().top-20);}};if(commonAddrHtml.length>0){$dom.html(commonAddrHtml.join(''));scrollCur();return;}
if(gpsHtml)return;var setCommonError=function(){if(opt.isNeedCommon){opt.isNeedCommon=false;show();}
$gps.html(gpsHtml||'<p>定位位置获取失败</p>');};setTimeout(function(){if(!commonAddrHtml.length){setCommonError();}},1500);window.commonAddrCB=function(json){if(json.retCode==0){var gpsAddr=json.gpsAddr,usualAddrList=json.usualAddrList,usualItem={};if(gpsAddr&&gpsAddr.cityId&&gpsAddr.cityName){gpsHtml='<dl ptag="7387.1.3" ids="'+[gpsAddr.provinceId||0,gpsAddr.cityId||0,gpsAddr.districtId||0].join('_')+'" names="'+[gpsAddr.provinceName||'',gpsAddr.cityName||'',gpsAddr.districtName||''].join('_')+'"><dt>'+[gpsAddr.provinceName||'',gpsAddr.cityName||'',gpsAddr.districtName||''].join('')+'</dt><dd>基于定位位置推荐</dd></dl>';}
$gps.html(gpsHtml||'<p>定位位置获取失败</p>');if(!usualAddrList.length){setCommonError();}
if(opt.isNeedCommon){commonAddrHtml=[opt.isSearch?'<div class="search_addrlayer_body_scroller"><div class="search_addrlayer_body_scroller_inner"><ul class="list_2">':'<ul class="mod_address_slide_list_1" ptag="7387.1.1">'];for(var i=0,len=usualAddrList.length;i<len;i++){usualItem=usualAddrList[i];if(usualItem&&usualItem.fullAddr&&usualItem.cityId&&usualItem.cityName){commonAddrHtml.push('<li filter-type="common"'+(opt.isSearch?' class="item"':'')+' addrid="'+(usualItem.id||0)+'" addrname="'+usualItem.fullAddr+'" ids="'+[usualItem.provinceId||0,usualItem.cityId||0,usualItem.countyId||0,usualItem.townId||0].join('_')+'" names="'+[usualItem.provinceName||'',usualItem.cityName||'',usualItem.countyName||'',usualItem.townName||''].join('_')+'">'+usualItem.fullAddr+'</li>');}}
if(commonAddrHtml.length>1){commonAddrHtml.push(opt.isSearch?'</ul></div></div>':'<li class="mod_address_slide_list_1_more"><span class="mod_address_slide_list_1_moretext">新增收货地址<i></i></span></li></ul>');$dom.html(commonAddrHtml.join(''));scrollCur();}else{commonAddrHtml=[];setCommonError();}}}else{setCommonError();}};ls.loadScript('//wq.jd.com/bases/addrinfo/getaddrinfo?addrtype='+opt.commonType+'&callback=commonAddrCB&t='+Math.random());}
function getCommonAddrV1(){if(opt.isNeedCommon){if(opt.isSearch){$('#searchFoot').show();$('#searchAddr').addClass('with_foot');$('#searchPrev').attr('tag','1');}else{$('#popupAddrHead').html('选择地址<i class="close"></i>');$('#addrBtn').hide().parent().hide();$('#popupAddr div.mod_address_slide_main').removeClass('type_flex');}}
var $dom=$('#addrBody'),selectClass=(opt.isSearch?'selected':'on'),scrollCur=function(){var $ul=$dom.find('ul'),$cur=$dom.find('li[addrid="'+curAddr.addrId+'"]');if(opt.isSearch)$ul=$('.search_addrlayer_body_scroller_inner');$ul.scrollTop(0);if($cur.length>0&&!$cur.hasClass('disabled')){$cur.addClass(selectClass).siblings().removeClass(selectClass);$ul.scrollTop($cur.offset().top-$ul.offset().top-20);}};if(commonAddrHtml.length>0){$dom.html(commonAddrHtml.join(''));scrollCur();return;}
var setCommonError=function(){if(opt.isNeedCommon){opt.isNeedCommon=false;show();}};setTimeout(function(){if(!commonAddrHtml.length){setCommonError();}},1500);window.commonAddrV1CB=function(json){if(json.retCode==='0'){usualAddrList=json.list;var usualItem={};if(!usualAddrList.length){setCommonError();}
if(opt.isNeedCommon){commonAddrHtml=[opt.isSearch?'<div class="search_addrlayer_body_scroller"><div class="search_addrlayer_body_scroller_inner"><ul class="list_2">':'<ul class="mod_address_slide_list_1" ptag="7387.1.1">'];var showLable=false;for(var i=0,len=usualAddrList.length;i<len;i++){usualItem=usualAddrList[i];showLable=!opt.isSearch&&usualItem.label&&(usualItem.label!=usualItem.name);if(usualItem&&usualItem.addrfull&&usualItem.cityId){commonAddrHtml.push('<li filter-type="common"'+(opt.isSearch?' class="item"':(usualItem.need_upgrade==='1'?' class="disabled"':''))+' addrid="'+(usualItem.adid||0)+'" addrname="'+usualItem.addrfull+'" ids="'+[usualItem.provinceId||0,usualItem.cityId||0,usualItem.countyId||0,usualItem.townId||0].join('_')+'" names="'+[usualItem.provinceName||'',usualItem.cityName||'',usualItem.countyName||'',usualItem.townName||''].join('_')+'">'+(showLable?('<span class="mod_address_slide_list_1_tag">'+usualItem.label+'</span>'):'')+usualItem.addrfull+(opt.isSearch?'':((usualItem.need_upgrade==='1'?'<p class="mod_address_slide_list_1_warn">行政区域地址已变更，请修改地址</p>':'')+'<i class="mod_address_slide_list_1_edit" style="padding-left: 30px;"></i>'))+'</li>');}}
if(commonAddrHtml.length>1){commonAddrHtml.push(opt.isSearch?'</ul></div></div>':'<li filter-type="addaddr" class="mod_address_slide_list_1_more"><span class="mod_address_slide_list_1_moretext">新增收货地址<i class="type_add"></i></span></li><li class="mod_address_slide_list_1_more type_or"><span class="mod_address_slide_list_1_moretext">或者</span></li><li class="mod_address_slide_list_1_more" filter-type="areaaddr"><span class="mod_address_slide_list_1_moretext">选择区域地址<i class="type_choose"></i></span></li></ul>');$dom.html(commonAddrHtml.join(''));scrollCur();}else{commonAddrHtml=[];if(!opt.isSearch){$('#addrBtn').html('<span class="arrow">新增详细地址</span>').attr('tag','3').show().parent().show();}
setCommonError();}}}else{setCommonError();}};ls.loadScript('//wq.jd.com/deal/recvaddr/getrecvaddrlistV3?adid=0&reg=1&callback=commonAddrV1CB&locationid='+(curAddr.id||'')+'&t='+Math.random());}
function checkUpgrade(opt){if(opt.provinceid&&opt.cityid&&opt.countyid){window.checkUpgradeCB=function(json){if(json.errCode==='0'){opt.cb&&opt.cb(json.need_upgrade==='1');}};ls.loadScript(['//wq.jd.com/deal/recvaddr/checkaddress?callback=checkUpgradeCB','provinceid='+opt.provinceid,'cityid='+opt.cityid,'countyid='+opt.countyid,'townid='+(opt.townid||'')].join('&'));}}
function setBasicDom(){var out='<div class="mod_address_slide" style="display:none;" id="popupAddr"><div class="mod_address_slide_main"><div class="mod_address_slide_head" id="popupAddrHead"></div><div class="mod_address_slide_body" id="addrBody"></div><div class="mod_address_slide_foot"><a id="addrBtn" style="display:none;" href="javascript:void(0);" tag="1"></a></div></div></div>';if(opt.isSearch){out='<div class="search_addrlayer with_foot fixed" id="searchAddr" style="display:none;"><div class="search_addrlayer_main"><div class="search_addrlayer_head ">'+opt.title+'<i class="icon_back" id="searchPrev" tag="1"></i></div><div class="search_addrlayer_body" id="addrBody"></div><div class="search_addrlayer_foot" id="searchFoot"><div class="btns"><a href="javascript:void(0);" class="btn bg_1">选择其它地址</a></div></div></div></div>';}
if(opt.con){$('#'+opt.con).html(out);}else{$('body').append(out);}}
function loadCss(){if($('#addressCss').length||!opt.isNeedCss){return;}
var l=document.createElement('link');l.id='addressCss';l.setAttribute('type','text/css');l.setAttribute('rel','stylesheet');l.setAttribute('href',opt.isSearch?'//wq.360buyimg.com/fd/h5/base/search/css/search_addrlayer.min_2ef9298a.css':'//wq.360buyimg.com/fd/h5/base/gb/css/mod_address_slide.min_69b125ff.css');document.getElementsByTagName('head')[0].appendChild(l);}
function showHidePopup(flag){var $dom=$(opt.isSearch?'#searchAddr':'#popupAddr'),$body=$(opt.isSearch?'html':'body');if(flag){$dom.show();setTimeout(function(){$dom.addClass('show');if(opt.isNeedFixed)$body.addClass(opt.overClass);},50);}else{$body.removeClass(opt.overClass);$dom.removeClass('show');setTimeout(function(){$dom.hide();},50);}}
function getAddrInfo(needUpgrade,cbFun){var wq_addr=(util.getCookie('wq_addr')||'').split('|'),fourStr=function(str,flag){if(!str)return'';var arr=str.split('_');for(var i=0;i<4;i++){arr[i]=arr[i]||flag;}
arr=arr.slice(0,4);return arr.join('_');};if(wq_addr.length>4){var wq_detail=wq_addr.slice(3);wq_addr[3]=wq_detail.join('|');}
wq_addr=wq_addr.slice(0,4);if(wq_addr.length!=4)wq_addr=[];if(needUpgrade){var addrId=wq_addr[0];if(addrId*1){var addrItem=usualAddrList.filter(function(s){return s&&s.adid===addrId;})[0],upgradeCb=function(flag){if(flag){var addrName=(wq_addr[2]||'').split('_').join('');addUpgradeAlertDom(addrName,addrId);}
cbFun&&cbFun(flag);};if(addrItem){upgradeCb(addrItem.need_upgrade==='1');}else{var addrIds=fourStr(wq_addr[1],'0').split('_');addrItem={provinceId:addrIds[0],cityId:addrIds[1],countyId:addrIds[2],townId:addrIds[3]};checkUpgrade({provinceid:addrItem.provinceId,cityid:addrItem.cityId,countyid:addrItem.countyId,townid:addrItem.townId,cb:upgradeCb});}}}
return{addrId:wq_addr[0]||'0',addrName:wq_addr[3]||'',id:fourStr(wq_addr[1]||util.getCookie('jdAddrId'),'0')||'19_1607_3155_0',name:fourStr(wq_addr[2]||util.getCookie('jdAddrName'),'')||'广东_深圳市_南山区_'};}
function clearCookies(){var addr=getAddrInfo(),provinceName=(addr.name||'').split('_')[0];if(provinceName&&provinceName.replace(/\s/g,'').length>8){var setCookieStorage=function(key,value){util.setCookie(key,value,30,"/",domainStr);if(window.WQAPI)WQAPI.db.set(key,value);};setCookieStorage('wq_addr','0|19_1607_3155_0|广东_深圳市_南山区_|');setCookieStorage('jdAddrId','19_1607_3155_0');setCookieStorage('jdAddrName','广东_深圳市_南山区_');}}
function addUpgradeAlertDom(addrName,addrId){if(!addrName||!addrId)return;if(!$('#addrUpgradeAlert').length){$('body').append('<div id="addrUpgradeAlert" class="mod_alert" style="display: none;"><span class="close"></span><i class="icon"></i><p class="addrtips"></p><p class="btns"><a href="javascript:;" class="btn btn_2" ptag="7387.3.2">使用其他地址</a><a href="javascript:;" class="btn btn_1">修改地址</a></p></div><div id="addrUpgradeAlertMask" class="mod_alert_mask" style="display: none;"></div>');$('#addrUpgradeAlert').off().on(opt.clickEvent,'p.btns a.btn_2',function(){show();$('#addrUpgradeAlert,#addrUpgradeAlertMask').hide().removeClass('show fixed');}).on(opt.clickEvent,'p.btns a.btn_1',function(){location.href='//wqs.jd.com/my/my_address.shtml?ptag=7387.3.3#type=edit&adid='+addrId;showHidePopup();$('#addrUpgradeAlert,#addrUpgradeAlertMask').hide().removeClass('show fixed');});$('#addrUpgradeAlert span.close,#addrUpgradeAlertMask').off().on(opt.clickEvent,function(){$('#addrUpgradeAlert,#addrUpgradeAlertMask').hide().removeClass('show fixed');});}
var $el=$('#addrUpgradeAlert'),$cover=$('#addrUpgradeAlertMask');$el.show().addClass('show fixed').find('p.addrtips').text('因行政区域变更，您选择的地址【'+addrName+'】现已不存在，会导致商品库存信息不准确或商品无法配送，请及时修改。');$cover.show().addClass('show fixed');window.wa&&wa('jdClick',{ptag:'7387.3.1'});}});
define('underscore',function(require,exports,module){var _cacheThisModule_;(function(){var root=this;var previousUnderscore=root._;var breaker={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var
push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var
nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj;};if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports){exports=module.exports=_;}
exports._=_;}else{root._=_;}
_.VERSION='1.6.0';var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return obj;if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context);}else if(obj.length===+obj.length){for(var i=0,length=obj.length;i<length;i++){if(iterator.call(context,obj[i],i,obj)===breaker)return;}}else{var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){if(iterator.call(context,obj[keys[i]],keys[i],obj)===breaker)return;}}
return obj;};_.map=_.collect=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeMap&&obj.map===nativeMap)return obj.map(iterator,context);each(obj,function(value,index,list){results.push(iterator.call(context,value,index,list));});return results;};var reduceError='Reduce of empty array with no initial value';_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduce&&obj.reduce===nativeReduce){if(context)iterator=_.bind(iterator,context);return initial?obj.reduce(iterator,memo):obj.reduce(iterator);}
each(obj,function(value,index,list){if(!initial){memo=value;initial=true;}else{memo=iterator.call(context,memo,value,index,list);}});if(!initial)throw new TypeError(reduceError);return memo;};_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduceRight&&obj.reduceRight===nativeReduceRight){if(context)iterator=_.bind(iterator,context);return initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);}
var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length;}
each(obj,function(value,index,list){index=keys?keys[--length]:--length;if(!initial){memo=obj[index];initial=true;}else{memo=iterator.call(context,memo,obj[index],index,list);}});if(!initial)throw new TypeError(reduceError);return memo;};_.find=_.detect=function(obj,predicate,context){var result;any(obj,function(value,index,list){if(predicate.call(context,value,index,list)){result=value;return true;}});return result;};_.filter=_.select=function(obj,predicate,context){var results=[];if(obj==null)return results;if(nativeFilter&&obj.filter===nativeFilter)return obj.filter(predicate,context);each(obj,function(value,index,list){if(predicate.call(context,value,index,list))results.push(value);});return results;};_.reject=function(obj,predicate,context){return _.filter(obj,function(value,index,list){return!predicate.call(context,value,index,list);},context);};_.every=_.all=function(obj,predicate,context){predicate||(predicate=_.identity);var result=true;if(obj==null)return result;if(nativeEvery&&obj.every===nativeEvery)return obj.every(predicate,context);each(obj,function(value,index,list){if(!(result=result&&predicate.call(context,value,index,list)))return breaker;});return!!result;};var any=_.some=_.any=function(obj,predicate,context){predicate||(predicate=_.identity);var result=false;if(obj==null)return result;if(nativeSome&&obj.some===nativeSome)return obj.some(predicate,context);each(obj,function(value,index,list){if(result||(result=predicate.call(context,value,index,list)))return breaker;});return!!result;};_.contains=_.include=function(obj,target){if(obj==null)return false;if(nativeIndexOf&&obj.indexOf===nativeIndexOf)return obj.indexOf(target)!=-1;return any(obj,function(value){return value===target;});};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args);});};_.pluck=function(obj,key){return _.map(obj,_.property(key));};_.where=function(obj,attrs){return _.filter(obj,_.matches(attrs));};_.findWhere=function(obj,attrs){return _.find(obj,_.matches(attrs));};_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.max.apply(Math,obj);}
var result=-Infinity,lastComputed=-Infinity;each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;if(computed>lastComputed){result=value;lastComputed=computed;}});return result;};_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.min.apply(Math,obj);}
var result=Infinity,lastComputed=Infinity;each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;if(computed<lastComputed){result=value;lastComputed=computed;}});return result;};_.shuffle=function(obj){var rand;var index=0;var shuffled=[];each(obj,function(value){rand=_.random(index++);shuffled[index-1]=shuffled[rand];shuffled[rand]=value;});return shuffled;};_.sample=function(obj,n,guard){if(n==null||guard){if(obj.length!==+obj.length)obj=_.values(obj);return obj[_.random(obj.length-1)];}
return _.shuffle(obj).slice(0,Math.max(0,n));};var lookupIterator=function(value){if(value==null)return _.identity;if(_.isFunction(value))return value;return _.property(value);};_.sortBy=function(obj,iterator,context){iterator=lookupIterator(iterator);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)};}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1;}
return left.index-right.index;}),'value');};var group=function(behavior){return function(obj,iterator,context){var result={};iterator=lookupIterator(iterator);each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value);});return result;};};_.groupBy=group(function(result,key,value){_.has(result,key)?result[key].push(value):result[key]=[value];});_.indexBy=group(function(result,key,value){result[key]=value;});_.countBy=group(function(result,key){_.has(result,key)?result[key]++:result[key]=1;});_.sortedIndex=function(array,obj,iterator,context){iterator=lookupIterator(iterator);var value=iterator.call(context,obj);var low=0,high=array.length;while(low<high){var mid=(low+high)>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid;}
return low;};_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(obj.length===+obj.length)return _.map(obj,_.identity);return _.values(obj);};_.size=function(obj){if(obj==null)return 0;return(obj.length===+obj.length)?obj.length:_.keys(obj).length;};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;if((n==null)||guard)return array[0];if(n<0)return[];return slice.call(array,0,n);};_.initial=function(array,n,guard){return slice.call(array,0,array.length-((n==null)||guard?1:n));};_.last=function(array,n,guard){if(array==null)return void 0;if((n==null)||guard)return array[array.length-1];return slice.call(array,Math.max(array.length-n,0));};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,(n==null)||guard?1:n);};_.compact=function(array){return _.filter(array,_.identity);};var flatten=function(input,shallow,output){if(shallow&&_.every(input,_.isArray)){return concat.apply(output,input);}
each(input,function(value){if(_.isArray(value)||_.isArguments(value)){shallow?push.apply(output,value):flatten(value,shallow,output);}else{output.push(value);}});return output;};_.flatten=function(array,shallow){return flatten(array,shallow,[]);};_.without=function(array){return _.difference(array,slice.call(arguments,1));};_.partition=function(array,predicate){var pass=[],fail=[];each(array,function(elem){(predicate(elem)?pass:fail).push(elem);});return[pass,fail];};_.uniq=_.unique=function(array,isSorted,iterator,context){if(_.isFunction(isSorted)){context=iterator;iterator=isSorted;isSorted=false;}
var initial=iterator?_.map(array,iterator,context):array;var results=[];var seen=[];each(initial,function(value,index){if(isSorted?(!index||seen[seen.length-1]!==value):!_.contains(seen,value)){seen.push(value);results.push(array[index]);}});return results;};_.union=function(){return _.uniq(_.flatten(arguments,true));};_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.contains(other,item);});});};_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value);});};_.zip=function(){var length=_.max(_.pluck(arguments,'length').concat(0));var results=new Array(length);for(var i=0;i<length;i++){results[i]=_.pluck(arguments,''+i);}
return results;};_.object=function(list,values){if(list==null)return{};var result={};for(var i=0,length=list.length;i<length;i++){if(values){result[list[i]]=values[i];}else{result[list[i][0]]=list[i][1];}}
return result;};_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i=0,length=array.length;if(isSorted){if(typeof isSorted=='number'){i=(isSorted<0?Math.max(0,length+isSorted):isSorted);}else{i=_.sortedIndex(array,item);return array[i]===item?i:-1;}}
if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;i<length;i++)if(array[i]===item)return i;return-1;};_.lastIndexOf=function(array,item,from){if(array==null)return-1;var hasIndex=from!=null;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf){return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item);}
var i=(hasIndex?from:array.length);while(i--)if(array[i]===item)return i;return-1;};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0;}
step=arguments[2]||1;var length=Math.max(Math.ceil((stop-start)/step),0);var idx=0;var range=new Array(length);while(idx<length){range[idx++]=start;start+=step;}
return range;};var ctor=function(){};_.bind=function(func,context){var args,bound;if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError;args=slice.call(arguments,2);return bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));ctor.prototype=func.prototype;var self=new ctor;ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));if(Object(result)===result)return result;return self;};};_.partial=function(func){var boundArgs=slice.call(arguments,1);return function(){var position=0;var args=boundArgs.slice();for(var i=0,length=args.length;i<length;i++){if(args[i]===_)args[i]=arguments[position++];}
while(position<arguments.length)args.push(arguments[position++]);return func.apply(this,args);};};_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(funcs.length===0)throw new Error('bindAll must be passed function names');each(funcs,function(f){obj[f]=_.bind(obj[f],obj);});return obj;};_.memoize=function(func,hasher){var memo={};hasher||(hasher=_.identity);return function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:(memo[key]=func.apply(this,arguments));};};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args);},wait);};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)));};_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;options||(options={});var later=function(){previous=options.leading===false?0:_.now();timeout=null;result=func.apply(context,args);context=args=null;};return function(){var now=_.now();if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args);context=args=null;}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining);}
return result;};};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;var later=function(){var last=_.now()-timestamp;if(last<wait){timeout=setTimeout(later,wait-last);}else{timeout=null;if(!immediate){result=func.apply(context,args);context=args=null;}}};return function(){context=this;args=arguments;timestamp=_.now();var callNow=immediate&&!timeout;if(!timeout){timeout=setTimeout(later,wait);}
if(callNow){result=func.apply(context,args);context=args=null;}
return result;};};_.once=function(func){var ran=false,memo;return function(){if(ran)return memo;ran=true;memo=func.apply(this,arguments);func=null;return memo;};};_.wrap=function(func,wrapper){return _.partial(wrapper,func);};_.compose=function(){var funcs=arguments;return function(){var args=arguments;for(var i=funcs.length-1;i>=0;i--){args=[funcs[i].apply(this,args)];}
return args[0];};};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments);}};};_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);return keys;};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=new Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]];}
return values;};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=new Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]];}
return pairs;};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i];}
return result;};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key);}
return names.sort();};_.extend=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){obj[prop]=source[prop];}}});return obj;};_.pick=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));each(keys,function(key){if(key in obj)copy[key]=obj[key];});return copy;};_.omit=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj){if(!_.contains(keys,key))copy[key]=obj[key];}
return copy;};_.defaults=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){if(obj[prop]===void 0)obj[prop]=source[prop];}}});return obj;};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj);};_.tap=function(obj,interceptor){interceptor(obj);return obj;};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!=toString.call(b))return false;switch(className){case'[object String]':return a==String(b);case'[object Number]':return a!=+a?b!=+b:(a==0?1/a==1/b:a==+b);case'[object Date]':case'[object Boolean]':return+a==+b;case'[object RegExp]':return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase;}
if(typeof a!='object'||typeof b!='object')return false;var length=aStack.length;while(length--){if(aStack[length]==a)return bStack[length]==b;}
var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&(aCtor instanceof aCtor)&&_.isFunction(bCtor)&&(bCtor instanceof bCtor))&&('constructor'in a&&'constructor'in b)){return false;}
aStack.push(a);bStack.push(b);var size=0,result=true;if(className=='[object Array]'){size=a.length;result=size==b.length;if(result){while(size--){if(!(result=eq(a[size],b[size],aStack,bStack)))break;}}}else{for(var key in a){if(_.has(a,key)){size++;if(!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))break;}}
if(result){for(key in b){if(_.has(b,key)&&!(size--))break;}
result=!size;}}
aStack.pop();bStack.pop();return result;};_.isEqual=function(a,b){return eq(a,b,[],[]);};_.isEmpty=function(obj){if(obj==null)return true;if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(_.has(obj,key))return false;return true;};_.isElement=function(obj){return!!(obj&&obj.nodeType===1);};_.isArray=nativeIsArray||function(obj){return toString.call(obj)=='[object Array]';};_.isObject=function(obj){return obj===Object(obj);};each(['Arguments','Function','String','Number','Date','RegExp'],function(name){_['is'+name]=function(obj){return toString.call(obj)=='[object '+name+']';};});if(!_.isArguments(arguments)){_.isArguments=function(obj){return!!(obj&&_.has(obj,'callee'));};}
if(typeof(/./)!=='function'){_.isFunction=function(obj){return typeof obj==='function';};}
_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj));};_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj;};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)=='[object Boolean]';};_.isNull=function(obj){return obj===null;};_.isUndefined=function(obj){return obj===void 0;};_.has=function(obj,key){return hasOwnProperty.call(obj,key);};_.noConflict=function(){root._=previousUnderscore;return this;};_.identity=function(value){return value;};_.constant=function(value){return function(){return value;};};_.property=function(key){return function(obj){return obj[key];};};_.matches=function(attrs){return function(obj){if(obj===attrs)return true;for(var key in attrs){if(attrs[key]!==obj[key])
return false;}
return true;}};_.times=function(n,iterator,context){var accum=Array(Math.max(0,n));for(var i=0;i<n;i++)accum[i]=iterator.call(context,i);return accum;};_.random=function(min,max){if(max==null){max=min;min=0;}
return min+Math.floor(Math.random()*(max-min+1));};_.now=Date.now||function(){return new Date().getTime();};var entityMap={escape:{'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#x27;'}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp('['+_.keys(entityMap.escape).join('')+']','g'),unescape:new RegExp('('+_.keys(entityMap.unescape).join('|')+')','g')};_.each(['escape','unescape'],function(method){_[method]=function(string){if(string==null)return'';return(''+string).replace(entityRegexes[method],function(match){return entityMap[method][match];});};});_.result=function(object,property){if(object==null)return void 0;var value=object[property];return _.isFunction(value)?value.call(object):value;};_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result.call(this,func.apply(_,args));};});};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+'';return prefix?prefix+id:id;};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'",'\\':'\\','\r':'r','\n':'n','\t':'t','\u2028':'u2028','\u2029':'u2029'};var escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){var render;settings=_.defaults({},settings,_.templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join('|')+'|$','g');var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,function(match){return'\\'+escapes[match];});if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'";}
if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'";}
if(evaluate){source+="';\n"+evaluate+"\n__p+='";}
index=offset+match.length;return match;});source+="';\n";if(!settings.variable)source='with(obj||{}){\n'+source+'}\n';source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+
source+"return __p;\n";try{render=new Function(settings.variable||'obj','_',source);}catch(e){e.source=source;throw e;}
if(data)return render(data,_);var template=function(data){return render.call(this,data,_);};template.source='function('+(settings.variable||'obj')+'){\n'+source+'}';return template;};_.chain=function(obj){return _(obj).chain();};var result=function(obj){return this._chain?_(obj).chain():obj;};_.mixin(_);each(['pop','push','reverse','shift','sort','splice','unshift'],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name=='shift'||name=='splice')&&obj.length===0)delete obj[0];return result.call(this,obj);};});each(['concat','join','slice'],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments));};});_.extend(_.prototype,{chain:function(){this._chain=true;return this;},value:function(){return this._wrapped;}});}).call(this);})
define('backbone',function(require,exports,module){var _cacheThisModule_;var _=require('underscore'),$=require('zepto');(function(root,factory){root.Backbone=exports=factory(root,{},_,$);}(this,function(root,Backbone,_,$){var previousBackbone=root.Backbone;var array=[];var slice=array.slice;Backbone.VERSION='1.1.2';Backbone.$=$;Backbone.noConflict=function(){root.Backbone=previousBackbone;return this;};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,'on',name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);events.push({callback:callback,context:context,ctx:context||this});return this;},once:function(name,callback,context){if(!eventsApi(this,'once',name,[callback,context])||!callback)return this;var self=this;var once=_.once(function(){self.off(name,once);callback.apply(this,arguments);});once._callback=callback;return this.on(name,once,context);},off:function(name,callback,context){if(!this._events||!eventsApi(this,'off',name,[callback,context]))return this;if(!name&&!callback&&!context){this._events=void 0;return this;}
var names=name?[name]:_.keys(this._events);for(var i=0,length=names.length;i<length;i++){name=names[i];var events=this._events[name];if(!events)continue;if(!callback&&!context){delete this._events[name];continue;}
var remaining=[];for(var j=0,k=events.length;j<k;j++){var event=events[j];if(callback&&callback!==event.callback&&callback!==event.callback._callback||context&&context!==event.context){remaining.push(event);}}
if(remaining.length){this._events[name]=remaining;}else{delete this._events[name];}}
return this;},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,'trigger',name,args))return this;var events=this._events[name];var allEvents=this._events.all;if(events)triggerEvents(events,args);if(allEvents)triggerEvents(allEvents,arguments);return this;},listenTo:function(obj,name,callback){var listeningTo=this._listeningTo||(this._listeningTo={});var id=obj._listenId||(obj._listenId=_.uniqueId('l'));listeningTo[id]=obj;if(!callback&&typeof name==='object')callback=this;obj.on(name,callback,this);return this;},listenToOnce:function(obj,name,callback){if(typeof name==='object'){for(var event in name)this.listenToOnce(obj,event,name[event]);return this;}
if(eventSplitter.test(name)){var names=name.split(eventSplitter);for(var i=0,length=names.length;i<length;i++){this.listenToOnce(obj,names[i],callback);}
return this;}
if(!callback)return this;var once=_.once(function(){this.stopListening(obj,name,once);callback.apply(this,arguments);});once._callback=callback;return this.listenTo(obj,name,once);},stopListening:function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var remove=!name&&!callback;if(!callback&&typeof name==='object')callback=this;if(obj)(listeningTo={})[obj._listenId]=obj;for(var id in listeningTo){obj=listeningTo[id];obj.off(name,callback,this);if(remove||_.isEmpty(obj._events))delete this._listeningTo[id];}
return this;}};var eventSplitter=/\s+/;var eventsApi=function(obj,action,name,rest){if(!name)return true;if(typeof name==='object'){for(var key in name){obj[action].apply(obj,[key,name[key]].concat(rest));}
return false;}
if(eventSplitter.test(name)){var names=name.split(eventSplitter);for(var i=0,length=names.length;i<length;i++){obj[action].apply(obj,[names[i]].concat(rest));}
return false;}
return true;};var triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:while(++i<l)(ev=events[i]).callback.call(ev.ctx);return;case 1:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:while(++i<l)(ev=events[i]).callback.apply(ev.ctx,args);return;}};Events.bind=Events.on;Events.unbind=Events.off;_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={});this.cid=_.uniqueId('c');this.attributes={};if(options.collection)this.collection=options.collection;if(options.parse)attrs=this.parse(attrs,options)||{};attrs=_.defaults({},attrs,_.result(this,'defaults'));this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments);};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:'id',initialize:function(){},toJSON:function(options){return _.clone(this.attributes);},sync:function(){return Backbone.sync.apply(this,arguments);},get:function(attr){return this.attributes[attr];},escape:function(attr){return _.escape(this.get(attr));},has:function(attr){return this.get(attr)!=null;},matches:function(attrs){return _.matches(attrs)(this.attributes);},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(key==null)return this;if(typeof key==='object'){attrs=key;options=val;}else{(attrs={})[key]=val;}
options||(options={});if(!this._validate(attrs,options))return false;unset=options.unset;silent=options.silent;changes=[];changing=this._changing;this._changing=true;if(!changing){this._previousAttributes=_.clone(this.attributes);this.changed={};}
current=this.attributes,prev=this._previousAttributes;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];for(attr in attrs){val=attrs[attr];if(!_.isEqual(current[attr],val))changes.push(attr);if(!_.isEqual(prev[attr],val)){this.changed[attr]=val;}else{delete this.changed[attr];}
unset?delete current[attr]:current[attr]=val;}
if(!silent){if(changes.length)this._pending=options;for(var i=0,length=changes.length;i<length;i++){this.trigger('change:'+changes[i],this,current[changes[i]],options);}}
if(changing)return this;if(!silent){while(this._pending){options=this._pending;this._pending=false;this.trigger('change',this,options);}}
this._pending=false;this._changing=false;return this;},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:true}));},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:true}));},hasChanged:function(attr){if(attr==null)return!_.isEmpty(this.changed);return _.has(this.changed,attr);},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false;var old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff){if(_.isEqual(old[attr],(val=diff[attr])))continue;(changed||(changed={}))[attr]=val;}
return changed;},previous:function(attr){if(attr==null||!this._previousAttributes)return null;return this._previousAttributes[attr];},previousAttributes:function(){return _.clone(this._previousAttributes);},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){if(!model.set(model.parse(resp,options),options))return false;if(success)success(model,resp,options);model.trigger('sync',model,resp,options);};wrapError(this,options);return this.sync('read',this,options);},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(key==null||typeof key==='object'){attrs=key;options=val;}else{(attrs={})[key]=val;}
options=_.extend({validate:true},options);if(attrs&&!options.wait){if(!this.set(attrs,options))return false;}else{if(!this._validate(attrs,options))return false;}
if(attrs&&options.wait){this.attributes=_.extend({},attributes,attrs);}
if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);if(options.wait)serverAttrs=_.extend(attrs||{},serverAttrs);if(_.isObject(serverAttrs)&&!model.set(serverAttrs,options)){return false;}
if(success)success(model,resp,options);model.trigger('sync',model,resp,options);};wrapError(this,options);method=this.isNew()?'create':(options.patch?'patch':'update');if(method==='patch'&&!options.attrs)options.attrs=attrs;xhr=this.sync(method,this,options);if(attrs&&options.wait)this.attributes=attributes;return xhr;},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var destroy=function(){model.stopListening();model.trigger('destroy',model,model.collection,options);};options.success=function(resp){if(options.wait||model.isNew())destroy();if(success)success(model,resp,options);if(!model.isNew())model.trigger('sync',model,resp,options);};if(this.isNew()){options.success();return false;}
wrapError(this,options);var xhr=this.sync('delete',this,options);if(!options.wait)destroy();return xhr;},url:function(){var base=_.result(this,'urlRoot')||_.result(this.collection,'url')||urlError();if(this.isNew())return base;return base.replace(/([^\/])$/,'$1/')+encodeURIComponent(this.id);},parse:function(resp,options){return resp;},clone:function(){return new this.constructor(this.attributes);},isNew:function(){return!this.has(this.idAttribute);},isValid:function(options){return this._validate({},_.extend(options||{},{validate:true}));},_validate:function(attrs,options){if(!options.validate||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;if(!error)return true;this.trigger('invalid',this,error,_.extend(options,{validationError:error}));return false;}});var modelMethods=['keys','values','pairs','invert','pick','omit','chain','isEmpty'];_.each(modelMethods,function(method){if(!_[method])return;Model.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.attributes);return _[method].apply(_,args);};});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.model)this.model=options.model;if(options.comparator!==void 0)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,_.extend({silent:true},options));};var setOptions={add:true,remove:true,merge:true};var addOptions={add:true,remove:false};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options);});},sync:function(){return Backbone.sync.apply(this,arguments);},add:function(models,options){return this.set(models,_.extend({merge:false},options,addOptions));},remove:function(models,options){var singular=!_.isArray(models);models=singular?[models]:_.clone(models);options||(options={});for(var i=0,length=models.length;i<length;i++){var model=models[i]=this.get(models[i]);if(!model)continue;var id=this.modelId(model.attributes);if(id!=null)delete this._byId[id];delete this._byId[model.cid];var index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger('remove',model,this,options);}
this._removeReference(model,options);}
return singular?models[0]:models;},set:function(models,options){options=_.defaults({},options,setOptions);if(options.parse)models=this.parse(models,options);var singular=!_.isArray(models);models=singular?(models?[models]:[]):models.slice();var id,model,attrs,existing,sort;var at=options.at;if(at!=null)at=+at;if(at<0)at+=this.length+1;var sortable=this.comparator&&(at==null)&&options.sort!==false;var sortAttr=_.isString(this.comparator)?this.comparator:null;var toAdd=[],toRemove=[],modelMap={};var add=options.add,merge=options.merge,remove=options.remove;var order=!sortable&&add&&remove?[]:false;var orderChanged=false;for(var i=0,length=models.length;i<length;i++){attrs=models[i];if(existing=this.get(attrs)){if(remove)modelMap[existing.cid]=true;if(merge&&attrs!==existing){attrs=this._isModel(attrs)?attrs.attributes:attrs;if(options.parse)attrs=existing.parse(attrs,options);existing.set(attrs,options);if(sortable&&!sort&&existing.hasChanged(sortAttr))sort=true;}
models[i]=existing;}else if(add){model=models[i]=this._prepareModel(attrs,options);if(!model)continue;toAdd.push(model);this._addReference(model,options);}
model=existing||model;if(!model)continue;id=this.modelId(model.attributes);if(order&&(model.isNew()||!modelMap[id])){order.push(model);orderChanged=orderChanged||!this.models[i]||model.cid!==this.models[i].cid;}
modelMap[id]=true;}
if(remove){for(var i=0,length=this.length;i<length;i++){if(!modelMap[(model=this.models[i]).cid])toRemove.push(model);}
if(toRemove.length)this.remove(toRemove,options);}
if(toAdd.length||orderChanged){if(sortable)sort=true;this.length+=toAdd.length;if(at!=null){for(var i=0,length=toAdd.length;i<length;i++){this.models.splice(at+i,0,toAdd[i]);}}else{if(order)this.models.length=0;var orderedModels=order||toAdd;for(var i=0,length=orderedModels.length;i<length;i++){this.models.push(orderedModels[i]);}}}
if(sort)this.sort({silent:true});if(!options.silent){var addOpts=at!=null?_.clone(options):options;for(var i=0,length=toAdd.length;i<length;i++){if(at!=null)addOpts.index=at+i;(model=toAdd[i]).trigger('add',model,this,addOpts);}
if(sort||orderChanged)this.trigger('sort',this,options);}
return singular?models[0]:models;},reset:function(models,options){options=options?_.clone(options):{};for(var i=0,length=this.models.length;i<length;i++){this._removeReference(this.models[i],options);}
options.previousModels=this.models;this._reset();models=this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger('reset',this,options);return models;},push:function(model,options){return this.add(model,_.extend({at:this.length},options));},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model;},unshift:function(model,options){return this.add(model,_.extend({at:0},options));},shift:function(options){var model=this.at(0);this.remove(model,options);return model;},slice:function(){return slice.apply(this.models,arguments);},get:function(obj){if(obj==null)return void 0;var id=this.modelId(this._isModel(obj)?obj.attributes:obj);return this._byId[obj]||this._byId[id]||this._byId[obj.cid];},at:function(index){if(index<0)index+=this.length;return this.models[index];},where:function(attrs,first){var matches=_.matches(attrs);return this[first?'find':'filter'](function(model){return matches(model.attributes);});},findWhere:function(attrs){return this.where(attrs,true);},sort:function(options){if(!this.comparator)throw new Error('Cannot sort a set without a comparator');options||(options={});if(_.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this);}else{this.models.sort(_.bind(this.comparator,this));}
if(!options.silent)this.trigger('sort',this,options);return this;},pluck:function(attr){return _.invoke(this.models,'get',attr);},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var success=options.success;var collection=this;options.success=function(resp){var method=options.reset?'reset':'set';collection[method](resp,options);if(success)success(collection,resp,options);collection.trigger('sync',collection,resp,options);};wrapError(this,options);return this.sync('read',this,options);},create:function(model,options){options=options?_.clone(options):{};if(!(model=this._prepareModel(model,options)))return false;if(!options.wait)this.add(model,options);var collection=this;var success=options.success;options.success=function(model,resp){if(options.wait)collection.add(model,options);if(success)success(model,resp,options);};model.save(null,options);return model;},parse:function(resp,options){return resp;},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator});},modelId:function(attrs){return attrs[this.model.prototype.idAttribute||'id'];},_reset:function(){this.length=0;this.models=[];this._byId={};},_prepareModel:function(attrs,options){if(this._isModel(attrs)){if(!attrs.collection)attrs.collection=this;return attrs;}
options=options?_.clone(options):{};options.collection=this;var model=new this.model(attrs,options);if(!model.validationError)return model;this.trigger('invalid',this,model.validationError,options);return false;},_isModel:function(model){return model instanceof Model;},_addReference:function(model,options){this._byId[model.cid]=model;var id=this.modelId(model.attributes);if(id!=null)this._byId[id]=model;model.on('all',this._onModelEvent,this);},_removeReference:function(model,options){if(this===model.collection)delete model.collection;model.off('all',this._onModelEvent,this);},_onModelEvent:function(event,model,collection,options){if((event==='add'||event==='remove')&&collection!==this)return;if(event==='destroy')this.remove(model,options);if(event==='change'){var prevId=this.modelId(model.previousAttributes());var id=this.modelId(model.attributes);if(prevId!==id){if(prevId!=null)delete this._byId[prevId];if(id!=null)this._byId[id]=model;}}
this.trigger.apply(this,arguments);}});var methods=['forEach','each','map','collect','reduce','foldl','inject','reduceRight','foldr','find','detect','filter','select','reject','every','all','some','any','include','contains','invoke','max','min','toArray','size','first','head','take','initial','rest','tail','drop','last','without','difference','indexOf','shuffle','lastIndexOf','isEmpty','chain','sample','partition'];_.each(methods,function(method){if(!_[method])return;Collection.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.models);return _[method].apply(_,args);};});var attributeMethods=['groupBy','countBy','sortBy','indexBy'];_.each(attributeMethods,function(method){if(!_[method])return;Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value);};return _[method](this.models,iterator,context);};});var View=Backbone.View=function(options){this.cid=_.uniqueId('view');options||(options={});_.extend(this,_.pick(options,viewOptions));this._ensureElement();this.initialize.apply(this,arguments);};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=['model','collection','el','id','attributes','className','tagName','events'];_.extend(View.prototype,Events,{tagName:'div',$:function(selector){return this.$el.find(selector);},initialize:function(){},render:function(){return this;},remove:function(){this._removeElement();this.stopListening();return this;},_removeElement:function(){this.$el.remove();},setElement:function(element){this.undelegateEvents();this._setElement(element);this.delegateEvents();return this;},_setElement:function(el){this.$el=el instanceof Backbone.$?el:Backbone.$(el);this.el=this.$el[0];},delegateEvents:function(events){if(!(events||(events=_.result(this,'events'))))return this;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)continue;var match=key.match(delegateEventSplitter);this.delegate(match[1],match[2],_.bind(method,this));}
return this;},delegate:function(eventName,selector,listener){this.$el.on(eventName+'.delegateEvents'+this.cid,selector,listener);},undelegateEvents:function(){if(this.$el)this.$el.off('.delegateEvents'+this.cid);return this;},undelegate:function(eventName,selector,listener){this.$el.off(eventName+'.delegateEvents'+this.cid,selector,listener);},_createElement:function(tagName){return document.createElement(tagName);},_ensureElement:function(){if(!this.el){var attrs=_.extend({},_.result(this,'attributes'));if(this.id)attrs.id=_.result(this,'id');if(this.className)attrs['class']=_.result(this,'className');this.setElement(this._createElement(_.result(this,'tagName')));this._setAttributes(attrs);}else{this.setElement(_.result(this,'el'));}},_setAttributes:function(attributes){this.$el.attr(attributes);}});Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:'json'};if(!options.url){params.url=_.result(model,'url')||urlError();}
if(options.data==null&&model&&(method==='create'||method==='update'||method==='patch')){params.contentType='application/json';params.data=JSON.stringify(options.attrs||model.toJSON(options));}
if(options.emulateJSON){params.contentType='application/x-www-form-urlencoded';params.data=params.data?{model:params.data}:{};}
if(options.emulateHTTP&&(type==='PUT'||type==='DELETE'||type==='PATCH')){params.type='POST';if(options.emulateJSON)params.data._method=type;var beforeSend=options.beforeSend;options.beforeSend=function(xhr){xhr.setRequestHeader('X-HTTP-Method-Override',type);if(beforeSend)return beforeSend.apply(this,arguments);};}
if(params.type!=='GET'&&!options.emulateJSON){params.processData=false;}
var error=options.error;options.error=function(xhr,textStatus,errorThrown){options.textStatus=textStatus;options.errorThrown=errorThrown;if(error)error.apply(this,arguments);};var xhr=options.xhr=Backbone.ajax(_.extend(params,options));model.trigger('request',model,xhr,options);return xhr;};var methodMap={'create':'POST','update':'PUT','patch':'PATCH','delete':'DELETE','read':'GET'};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments);};var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments);};var optionalParam=/\((.*?)\)/g;var namedParam=/(\(\?)?:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){if(!_.isRegExp(route))route=this._routeToRegExp(route);if(_.isFunction(name)){callback=name;name='';}
if(!callback)callback=this[name];var router=this;Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);if(router.execute(callback,args,name)!==false){router.trigger.apply(router,['route:'+name].concat(args));router.trigger('route',name,args);Backbone.history.trigger('route',router,name,args);}});return this;},execute:function(callback,args,name){if(callback)callback.apply(this,args);},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);return this;},_bindRoutes:function(){if(!this.routes)return;this.routes=_.result(this,'routes');var route,routes=_.keys(this.routes);while((route=routes.pop())!=null){this.route(route,this.routes[route]);}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,'\\$&').replace(optionalParam,'(?:$1)?').replace(namedParam,function(match,optional){return optional?match:'([^/?]+)';}).replace(splatParam,'([^?]*?)');return new RegExp('^'+route+'(?:\\?([\\s\\S]*))?$');},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param,i){if(i===params.length-1)return param||null;return param?decodeURIComponent(param):null;});}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,'checkUrl');if(typeof window!=='undefined'){this.location=window.location;this.history=window.history;}};var routeStripper=/^[#\/]|\s+$/g;var rootStripper=/^\/+|\/+$/g;var pathStripper=/#.*$/;History.started=false;_.extend(History.prototype,Events,{interval:50,atRoot:function(){var path=this.location.pathname.replace(/[^\/]$/,'$&/');return path===this.root&&!this.getSearch();},getSearch:function(){var match=this.location.href.replace(/#.*/,'').match(/\?.+/);return match?match[0]:'';},getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:'';},getPath:function(){var path=decodeURI(this.location.pathname+this.getSearch());var root=this.root.slice(0,-1);if(!path.indexOf(root))path=path.slice(root.length);return path.charAt(0)==='/'?path.slice(1):path;},getFragment:function(fragment){if(fragment==null){if(this._hasPushState||!this._wantsHashChange){fragment=this.getPath();}else{fragment=this.getHash();}}
return fragment.replace(routeStripper,'');},start:function(options){if(History.started)throw new Error('Backbone.history has already been started');History.started=true;this.options=_.extend({root:'/'},this.options,options);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._hasHashChange='onhashchange'in window;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);this.fragment=this.getFragment();this.root=('/'+this.root+'/').replace(rootStripper,'/');if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var root=this.root.slice(0,-1)||'/';this.location.replace(root+'#'+this.getPath());return true;}else if(this._hasPushState&&this.atRoot()){this.navigate(this.getHash(),{replace:true});}}
if(!this._hasHashChange&&this._wantsHashChange&&(!this._wantsPushState||!this._hasPushState)){var iframe=document.createElement('iframe');iframe.src='javascript:0';iframe.style.display='none';iframe.tabIndex=-1;var body=document.body;this.iframe=body.insertBefore(iframe,body.firstChild).contentWindow;this.iframe.document.open().close();this.iframe.location.hash='#'+this.fragment;}
var addEventListener=window.addEventListener||function(eventName,listener){return attachEvent('on'+eventName,listener);};if(this._hasPushState){addEventListener('popstate',this.checkUrl,false);}else if(this._wantsHashChange&&this._hasHashChange&&!this.iframe){addEventListener('hashchange',this.checkUrl,false);}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval);}
if(!this.options.silent)return this.loadUrl();},stop:function(){var removeEventListener=window.removeEventListener||function(eventName,listener){return detachEvent('on'+eventName,listener);};if(this._hasPushState){removeEventListener('popstate',this.checkUrl,false);}else if(this._wantsHashChange&&this._hasHashChange&&!this.iframe){removeEventListener('hashchange',this.checkUrl,false);}
if(this.iframe){document.body.removeChild(this.iframe.frameElement);this.iframe=null;}
if(this._checkUrlInterval)clearInterval(this._checkUrlInterval);History.started=false;},route:function(route,callback){this.handlers.unshift({route:route,callback:callback});},checkUrl:function(e){var current=this.getFragment();if(current===this.fragment&&this.iframe){current=this.getHash(this.iframe);}
if(current===this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl();},loadUrl:function(fragment){fragment=this.fragment=this.getFragment(fragment);return _.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true;}});},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:!!options};fragment=this.getFragment(fragment||'');var root=this.root;if(fragment===''||fragment.charAt(0)==='?'){root=root.slice(0,-1)||'/';}
var url=root+fragment;fragment=decodeURI(fragment.replace(pathStripper,''));if(this.fragment===fragment)return;this.fragment=fragment;if(this._hasPushState){this.history[options.replace?'replaceState':'pushState']({},document.title,url);}else if(this._wantsHashChange){this._updateHash(this.location,fragment,options.replace);if(this.iframe&&(fragment!==this.getHash(this.iframe))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,fragment,options.replace);}}else{return this.location.assign(url);}
if(options.trigger)return this.loadUrl(fragment);},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,'');location.replace(href+'#'+fragment);}else{location.hash='#'+fragment;}}});Backbone.history=new History;var extend=function(protoProps,staticProps){var parent=this;var child;if(protoProps&&_.has(protoProps,'constructor')){child=protoProps.constructor;}else{child=function(){return parent.apply(this,arguments);};}
_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child;};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate;if(protoProps)_.extend(child.prototype,protoProps);child.__super__=parent.prototype;return child;};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified');};var wrapError=function(model,options){var error=options.error;options.error=function(resp){if(error)error(model,resp,options);model.trigger('error',model,resp,options);};};return Backbone;}));})
define('wg.jdshopcart.v3',function(require,exports,module){var _cacheThisModule_;var $=require('zepto'),mFJ=require('formatJson'),mPromote=require('wg.jdpromote'),mShopcartModel=require('wg.jdshopcart.model'),Q=require('q'),mLoad=require('loadJs'),report=require('report'),_login=require("login"),scrollCtrl=require('scrollCtrl'),skuSwitch=require('wq.skuSwitch'),mJdShopcoupon=require('wg.jdshopcoupon'),mJdGiftPool=require('wg.jdgiftpool'),mAttrCtrl=require('wq.address'),skuImgPrice=require('wq.skuImgPrice'),_scrCtrl,dAddrName,gbInit=false,gdContainer,oSCModel,oDialog,gsUA=navigator.userAgent,gbIsAndroid=gsUA.match(/(Android);?[\s\/]+([\d.]+)?/),gbIsEditing=false,gbIsCheckImg=false,gbIsfirstEnter={service:true,ckhdBaoguan:true,jjTip:false,jjBgTip:false},skuRelateData={},stockCacheData={},p3PriceObj={},recBackData={arrIdx:24,repIndex:0,data:[]},giftService={isUpdate:true,selected:{},loaded:{},giftSkuPag:null},yfStandard={isget:false,zyStand:{weightArr:[],priceArr:[]},freshStand:{weightArr:[],priceArr:[]}},extraYunfeiObj={keyArr:[],dataArr:[],totalWeight:0,priceAll:0,bigWeight:{},freshInfo:{},freshCoudanObj:{},zyCoudanObj:{}};JD.events.listen('pageshow',function(){mAttrCtrl.reset();setScrollTop(0);window.gsAddrObj=mAttrCtrl.getAddrInfo(true);oAddress.setAddrName();window.g_pinStatus=null;oShopCart.renderList(null,function(){getScrollTop();});});window.popTypeConstant={isNormal:'isNormal',isMulPro:'isMulPro',is4Pro:'is4Pro',iswomen:'iswomen'};window.gbIsDeleteState=false;window.isrisk=true;require('backbone');var shangChaoCategoryLevel2=JD.device.scene=='weixin'?wxlevel2:sqlevel2;window.my_scrollTop=0;window.isEnv=JD.device.scene=='weixin'?'1':(JD.device.scene=='qq'?'2':'');var app_itemView=Backbone.View.extend({events:{"click .icon_select":"changeCheck","click [attr-tag='linkcontent']":"linkcontent","touchstart":"handletouchstart","touchmove":"handletouchmove","touchend":"handletouchend","touchcancel":"handletouchend","click .action_delete":"delete","click .action_fav":"favor","click .familiar":"similar","click [attr-tag='skuChange']":"skuChangeShow"},getPosition:function(e){var touch=e.changedTouches?e.changedTouches[0]:e;return{x:touch.pageX,y:touch.pageY};},handletouchstart:function(e){if(isApp())return;this.sp=this.getPosition(e);if(!this.stats){this.stats='r';}
this.scrollFlag=true;this.moveFlag=false;this.el.style.webkitTransition="-webkit-transform 0s ease";},handletouchmove:function(e){if(isApp()||!this.scrollFlag)return;var mp=this.getPosition(e),x=mp.x-this.sp.x,y=mp.y-this.sp.y;if(Math.abs(x)>20&&Math.abs(y)<10&&Math.abs(x)-Math.abs(y)>0&&this.getRadian(Math.abs(y),Math.abs(x))>=0&&this.getRadian(Math.abs(y),Math.abs(x))<15*Math.PI/180){this.moveFlag=true;e.stopPropagation();e.preventDefault();this.el.style.webkitTransition="-webkit-transform 0s ease";if(x<0){this.re='l';if(x<-this.maxTouchWidth){x=-this.maxTouchWidth;}
if(this.stats=='r'){this.el.style.webkitTransform='translateX('+x+'px)';}}else{this.re='r';if(x>this.maxTouchWidth){x=this.maxTouchWidth;}
if(this.stats=='l'){this.el.style.webkitTransform='translateX('+(x-this.maxTouchWidth)+'px)';}}}},handletouchend:function(e){if(isApp()||!this.scrollFlag||!this.moveFlag)return;this.el.style.webkitTransition="-webkit-transform 0.3s ease";var mp=this.getPosition(e),x=mp.x-this.sp.x,y=mp.y-this.sp.y;if(this.re=='r'){this.el.style.webkitTransform='translateX(0px)';this.stats='r';}else{if(x>-(this.maxTouchWidth/3)){this.el.style.webkitTransform='translateX(0px)';this.stats='r';}else{this.el.style.webkitTransform='translateX(-'+this.maxTouchWidth+'px)';this.stats='l';JD.report.rd('7014.2.11');}}
for(var key in oShopCart.itemViewList){if(key!=this.sid&&oShopCart.itemViewList[key].stats=='l'){oShopCart.itemViewList[key].stats="r";this.jsAnimation(oShopCart.itemViewList[key],0);}}
this.scrollFlag=false;this.moveFlag=false;},getRadian:function(y,x){return Math.atan2(y,x);},jsAnimation:function(elView,offset){var me=elView;me.$el.css({"-webkit-transform":"translate3D("+(-offset)+"px,0,0)","-webkit-transition":"all 0.3s ease"});},initialize:function(){this.editCheckState=false;this.maxTouchWidth=this.$el.find('.action .button').length==2?150:75;this.reState();this.listenTo(Backbone,'onChangeEditStyle',this.changeEdit);this.on({'onChangeJiangjia':function(flag){this.isJiangJia=flag;if(this.isNoStock){this.isJiangJia=false;this.$el.removeClass('jiangjia');this.$el.find('.lower_price').hide();this.$el.css('min-height','125px');}},'onChangeNoStock':function(flag){this.isNoStock=flag;if(flag){this.$el.find('.action_fav').hide();this.$el.find('[attr-tag="action"]').width(75);this.maxTouchWidth=75;this.$el.css('min-height','125px');}},'onChangeUnusable':function(flag){this.isUnusable=flag;if(flag){this.maxTouchWidth=75;}},'onChangeLimitStock':function(flag){this.isLimitStock=flag;}});},setIsShow:function(flag){if(flag){this.showFlag=true;this.$el.show().parents("[attr-goodwapper]").show();}else{this.showFlag=false;this.$el.hide().parents("[attr-goodwapper]").hide();}},reState:function(){this.sid=this.$el.attr('id');this.shopid=this.$el.parents('.section').find('[attr-tag="checkShop"]').attr('id');this.num=this.$el.attr('attr-num')||0;this.itemTotalPrice=parseInt(this.$el.attr('attr-totalprice')||0);var sCid=this.$el.attr('attr-cid')||this.$el.find('[attr-cid]').attr('attr-cid');var suittype=this.$el.closest('.cart_goods_group').attr('attr-suit')||'';this.cid=sCid;if(shangChaoCategoryLevel2.indexOf(parseInt(sCid.split('_')[1]))>=0){this.isChaoShi=true;}else{this.isChaoShi=false;}
var selectType=$('#selectbtn').attr('attr_value');if(selectType==='0'){this.setIsShow(true);}else if(selectType=="1"){if(this.isJiangJia==true){this.setIsShow(true);}else{this.setIsShow(false);}}else if(selectType=="2"){if(suittype=="mf"||suittype=="mz"){this.setIsShow(true);}else{this.setIsShow(false);}}else if(selectType=="3"){if(this.isLimitStock===true){this.setIsShow(true);}else{this.setIsShow(false);}}else if(selectType=="4"){if(this.isChaoShi==true){this.setIsShow(true);}else{this.setIsShow(false);}}
this.normalState=this.$el.attr('attr-normalState')=='selected';if(gbIsDeleteState){if(this.showFlag==false){this.setCheckState(false);}else{this.setCheckState(this.editCheckState);}}else{this.setCheckState(this.normalState);}},setCheckState:function(preState){var me=oShopCart;if(gbIsDeleteState){if(preState){this.editCheckState=true;me.oCheckGroup.check(this);}else{this.editCheckState=false;me.oCheckGroup.uncheck(this);}}else{if(preState){this.normalState=true;me.oCheckGroup.check(this);}else{this.normalState=false;me.oCheckGroup.uncheck(this);}}},getShopItem:function(){return oShopCart.shopViewList[this.shopid];},getIsCheck:function(){return gbIsDeleteState?this.editCheckState:this.normalState;},changeEdit:function(isEdit){var me=oShopCart;if(isEdit){this.editCheckState=false;me.oCheckGroup.uncheck(this);}else{if(this.normalState){me.oCheckGroup.check(this);}else{me.oCheckGroup.uncheck(this);}}},linkcontent:function(e){if($(e.target).attr('attr-tag')=="cmdtynum"||$(e.target).parents('[attr-tag="cmdtynum"]').length>0||$(e.target).attr('attr-tag')=="selectPromote"||$(e.target).parents('[attr-tag="selectPromote"]').length>0||$(e.target).attr('attr-tag')=="action"||$(e.target).parents('[attr-tag="action"]').length>0||$(e.target).attr('attr-tag')=="skuChange"||$(e.target).parents('[attr-tag="skuChange"]').length>0||$(e.target).hasClass('familiar')||$(e.target).attr('attr-tag')=="samInfo"){return;}
var attrhref=$(e.currentTarget).attr('data-href');setScrollTop();location.href=attrhref;},changeCheck:function(){if(this.isUnusable){return;}
var dSrc=this.el,me=oShopCart;if(gbIsDeleteState){if(!me.oCheckGroup.isCheck(dSrc)){this.editCheckState=true;me.oCheckGroup.check(this);}else{this.editCheckState=false;me.oCheckGroup.uncheck(this);}
return;}
if(gbIsEditing===true)return true;gbIsEditing=true;var sId=dSrc.id,dGroup=$(dSrc).closest('.cart_goods_group'),sSuitId=dGroup.attr('id')||'',sSuitType=dGroup.attr('attr-suit')||'';if(!me.oCheckGroup.isCheck(dSrc)){$(dSrc).addClass('loading');oSCModel.checkCmdty({commlist:oSCModel.serializeCommList(oSCModel.getCmdtyObjById(sId,sSuitId,sSuitType),{suitType:sSuitType,suitId:sSuitId}),type:0,locationid:gsAddrId},function(obj,sCommList){gbIsEditing=false;$(dSrc).removeClass('loading');if(obj.errId==='0'){me.refleshSuit(oSCModel.updateData(obj,sCommList),sSuitType,obj.cart);}else{checkError(obj);}});}else{$(dSrc).removeClass('selected').addClass('loading');oSCModel.uncheckCmdty({commlist:oSCModel.serializeCommList(oSCModel.getCmdtyObjById(sId,sSuitId,sSuitType),{suitType:sSuitType,suitId:sSuitId}),type:0,locationid:gsAddrId},function(obj,sCommList){gbIsEditing=false;$(dSrc).removeClass('loading');if(obj.errId==='0'){dSrc.removeAttribute('attr-edit');me.refleshSuit(oSCModel.updateData(obj,sCommList),sSuitType,obj.cart);}else{checkError(obj);}});}},delete:function(e){var dSrc=this.el,me=oShopCart,temp=[];temp.push(dSrc);me.deleteItem(temp,true);JD.report.rd('7014.2.15');},favor:function(e){var dSrc=this.el,me=oShopCart,temp=[];temp.push(dSrc);me.favorItem(temp,true);JD.report.rd('7014.2.10');},similar:function(e){e.stopPropagation();e.preventDefault();var goodWrap=$(e.target).parents('.goods_wrap'),skuid=goodWrap.find('.goods').attr('attr-sku'),price=goodWrap.attr('attr-price');var url='//wqs.jd.com/search/searchsimilar.shtml?sceneid=3&sku='+skuid+'&jp='+price;setScrollTop();location.href=url;JD.report.rd('7014.2.17');},skuChangeShow:function(e){if(gbIsDeleteState){return;}
var me=this,$dSrc=this.$el,skuid=$dSrc.attr('id'),isDist=$(e.target).attr("isDist")*1,skuChangeCont=$("#skuChangeCont"),iptDom=$dSrc.find('input'),iptObj={"presku":skuid,"prevalue":iptDom.data("prevalue"),"isDist":isDist};oShopCart.skuSwitchReset({skuid:skuid,buyNum:iptDom.val(),iptObj:iptObj,dom:skuChangeCont});}});var app_suitView=Backbone.View.extend({initialize:function(){this.sid=this.$el.attr('id');this.suittype=this.$el.attr('attr-suit');this.reState();},reState:function(){var me=this;this.checkdSuitItemIds=[];this.$el.find('[attr-sku]').forEach(function(item){var sku=$(item).attr('attr-sku');if(me.suittype=='suit'||(oShopCart.itemViewList[sku]&&oShopCart.itemViewList[sku].normalState)){me.checkdSuitItemIds.push(sku);}});this.suitTotalPrice=parseInt(this.$el.attr('attr-totalprice'));}});var app_shopView=Backbone.View.extend({events:{"click .icon_select":"changeCheck"},initialize:function(){this.sid=this.$el.attr('id');this.reState();},reState:function(){var isflag=false;this.$el.parents('.section').find('.cart_goods').forEach(function(item){var group;if($(item).attr('attr-tag')!="checkItem"){group=$(item).find('[attr-tag="checkItem"]');}else{group=$(item);}
var groupflag=false;group.forEach(function(ci){if(oShopCart.itemViewList[ci.id].showFlag){isflag=true;groupflag=true;}});if(groupflag){$(item).show();}else{$(item).hide();}});if(isflag){this.$el.parents('.section').show();}else{this.$el.parents('.section').hide();}
this.shopItemList=[];for(var key in oShopCart.itemViewList){if(oShopCart.itemViewList[key].shopid==this.sid){this.shopItemList.push(oShopCart.itemViewList[key]);}}},getShowItem:function(){return this.shopItemList.filter(function(el){return el.showFlag;});},getCheckItem:function(){return this.shopItemList.filter(function(el){return el.getIsCheck();});},changeCheck:function(){var dSrc=this.el,me=oShopCart;if(gbIsDeleteState){var tempState=!me.oCheckGroup.isCheck(dSrc);this.getShowItem().forEach(function(item){item.setCheckState(tempState);});return;}
if(gbIsEditing===true)return true;gbIsEditing=true;var suitIdList=[],itemList=[],shopId=dSrc.id;this.getShowItem().forEach(function(it){var item=it.el;var sId=item.id,dGroup=$(item).closest('.cart_goods_group'),sSuitId=dGroup.attr('id')||'',sSuitType=dGroup.attr('attr-suit')||'';itemList.push(oSCModel.getCmdtyObjById(sId,sSuitId,sSuitType));suitIdList.push({suitId:sSuitId,suitType:sSuitType});});if(!me.oCheckGroup.isCheck(dSrc)){$(dSrc).addClass('loading');oSCModel.checkCmdty({commlist:oSCModel.serializeCommList(itemList,suitIdList),type:0,locationid:gsAddrId},function(obj,sCommList){gbIsEditing=false;$(dSrc).removeClass('loading');if(obj.errId==='0'){oSCModel.updateData(obj,sCommList);me.refleshShop($(dSrc).parents('.section'),obj.cart);me.queryShopName(true);}else{checkError(obj);}});}else{$(dSrc).removeClass('selected').addClass('loading');oSCModel.uncheckCmdty({commlist:oSCModel.serializeCommList(itemList,suitIdList),type:0,locationid:gsAddrId},function(obj,sCommList){gbIsEditing=false;$(dSrc).removeClass('loading');if(obj.errId==='0'){oSCModel.updateData(obj,sCommList);me.refleshShop($(dSrc).parents('.section'),obj.cart);me.queryShopName(true);}else{checkError(obj);}});}}});var huangtiao=(function(){var primap={'xinren':0,'jiangjia':1,'beanVerify':2};var privor=[],privorLength=3;for(var index=0;index<privorLength;index++){privor.push({state:0});}
return{pushTiao:function(ind,fun){if(primap[ind]>=0){ind=primap[ind];privor[ind].state=1;privor[ind].fun=fun;this.reflesh();}},popTiao:function(ind){if(primap[ind]>=0){ind=primap[ind];privor[ind].state=-1;this.reflesh();}},reflesh:function(){for(var ind=0;ind<privorLength;ind++){if(privor[ind].state==2){break;}else if(privor[ind].state==1){privor[ind].state==2;privor[ind].fun();break;}}}}})();var oShopCart={dList:null,dTotalPrice:null,dTotalNum:null,oCheckGroup:null,sCmdtyTmpl:'',sSuitTmpl:'',sMfsuitTmpl:'',sMzsuitTmpl:'',itemViewList:{},shopViewList:{},suitViewList:{},refleshItemView:function(opt){var me=this,newItemList={};var nowids=[];$('[attr-tag="checkItem"]').forEach(function(item){nowids.push($(item).attr('id'));if(!me.itemViewList[$(item).attr('id')]){me.itemViewList[$(item).attr('id')]=(new app_itemView({el:$(item).get(0)}));}else{if(me.itemViewList[$(item).attr('id')].isUpdateView){me.itemViewList[$(item).attr('id')].setElement($(item).get(0));me.itemViewList[$(item).attr('id')].isUpdateView=false;}
me.itemViewList[$(item).attr('id')].reState();}});for(var key in me.itemViewList){if(nowids.indexOf(key)<0){me.itemViewList[key]&&me.itemViewList[key].stopListening();delete me.itemViewList[key];}}
var nowshopids=[];$('[attr-tag="checkShop"]').forEach(function(item){nowshopids.push($(item).attr('id'));if(me.shopViewList[$(item).attr('id')]){me.shopViewList[$(item).attr('id')].setElement($(item).get(0));me.shopViewList[$(item).attr('id')].reState();}else{me.shopViewList[$(item).attr('id')]=(new app_shopView({el:$(item).get(0)}));}});for(var key in me.shopViewList){if(nowshopids.indexOf(key)<0){delete me.shopViewList[key];}}
var nowsuitids=[];$('[attr-suit]').forEach(function(item){nowsuitids.push($(item).attr('id'));if(me.suitViewList[$(item).attr('id')]){me.suitViewList[$(item).attr('id')].setElement($(item).get(0));me.suitViewList[$(item).attr('id')].reState();}else{me.suitViewList[$(item).attr('id')]=(new app_suitView({el:$(item).get(0)}));}});for(var key in me.suitViewList){if(nowsuitids.indexOf(key)<0){delete me.suitViewList[key];}}
me.queryShopCoupon(null,opt&&opt.isGetCacheCoupon);},changeCollectionDate:{changeItemState:function(list,eventName){var me=oShopCart;list.forEach(function(key){me.itemViewList[key]&&me.itemViewList[key].trigger(eventName,true);});}},getCollectionDate:{getAllShowItem:function(){var me=oShopCart;var itemList=[];for(var key in me.itemViewList){itemList.push(me.itemViewList[key]);}
return itemList.filter(function(item){return item.showFlag;});},getAllCheckItem:function(){var me=oShopCart;var itemList=[];for(var key in me.itemViewList){itemList.push(me.itemViewList[key]);}
return itemList.filter(function(item){return item.getIsCheck();});}},init:function(){var me=this;dAddrName=$('#addrNameTxt');this.dList=$('#list');this.dTotalPrice=$('#totalPrice');this.dTotalNum=$('#totalNum');this.sCmdtyTmpl=$('#cmdtyTmpl').html();this.sSuitTmpl=$('#suitTmpl').html();this.sMfsuitTmpl=$('#mfsuitTmpl').html();this.sMzsuitTmpl=$('#mzsuitTmpl').html();this.sPopShopTmpl=$('#popShopTmpl').html();this.sPromoteTmpl=$('#cmdtyPromoteTmpl').html();this.srecommendViewTmpl=$('#recommendView').html();var dComfirBtn=$('#shopCartConfirm');this.oCheckGroup=new checkGroup({sName:'checkgroup',sActiveCls:'selected',sMainTag:'checkMain',sShopTag:'checkShop',onChecked:function(){if($('div.selected').length>0){dComfirBtn.removeClass('disabled');}else{dComfirBtn.addClass('disabled');}}});if(JD.device.scene=='weixin'){$("#moreAct").find('.souyeJs').attr("href","//wqs.jd.com/portal/wx/portal_indexV4.shtml?ptag=7014.5.2");$("#moreAct").find('.searchJs').attr("href","//wqs.jd.com/portal/wx/category_m.shtml?ptag=7014.5.3");}else{$("#moreAct").find('.souyeJs').attr("href","//wqs.jd.com/portal/sq/portal_indexv3.shtml?ptag=7014.5.2");$("#moreAct").find('.searchJs').attr("href","//wqs.jd.com/portal/sq/category_q.shtml?ptag=7014.5.3");}
$("#moreAct").find('.useFeedbackJs').attr("href","//wqs.jd.com/customer/feedback.shtml?ptag=7014.5.11&fromurl="+encodeURIComponent(location.href));this.renderList(null,null,{isFirst:true});this.bindEvent();},bindEvent:function(){var me=this;this.winScrollEvent();this.bindListEvent();this.bindSkuContSelect();},winScrollEvent:function(){var win=$(window),goTop=$('#goTop'),promoteCont=$('#promoteCont'),contentDom=$("#content"),addrBarDom=$('.address_bar_wrap'),isUpload=false,me=this;gdContainer.on("scroll",function(){var st=gdContainer.scrollTop(),wheight=win.height();wheight<st?goTop.css('display','block'):goTop.hide();me.shopNameFix(addrBarDom);});goTop.on("click",function(e){gdContainer.scrollTop(0);e.preventDefault&&e.preventDefault();e.stopPropagation&&e.stopPropagation();});gdContainer.on("hashchange",function(e){var keyStr='',viewDom,valueFun=null;if(location.hash.indexOf('wg.jdshopcoupon')>=0){keyStr='c_jdshopcoupon_show';valueFun=mJdShopcoupon.show;}else if(location.hash.indexOf('wg.jdshopcart.v3=showyb')>=0){keyStr='c_jdshopcart_showyb';valueFun=exports.showyb;}else if(location.hash.indexOf('wg.jdgiftpool=show')>=0){keyStr='c_jdgiftpool_show';valueFun=mJdGiftPool.show;}else{keyStr='c_jdshopcart_showList';valueFun=exports.showList;$("#moreAct").show();}
viewDom=contentDom.find('#'+keyStr);if(!viewDom.length){contentDom.append('<div id="'+keyStr+'"></div>');viewDom=contentDom.find('#'+keyStr);}
viewDom.show();valueFun(viewDom);contentDom.find('#'+keyStr).siblings().hide();});promoteCont.on('click','.close',function(event){promoteCont.removeClass('show');setTimeout(function(){promoteCont.hide();},100);});$("#list").on('click','.icon_notice',function(event){event.preventDefault();var extraYfTip=$("#extraYfTip"),desc="",hasDetail=false;if($(this).hasClass('notice2')){hasDetail=true;desc="自营生鲜商品单独计算运费，实际运费以结算页为准，运费标准可查看<a href='//wqs.jd.com/my/cart/extraYunfeiRule.shtml?detail=1&ptag=7014.10.23' class='ship_info_lnk'>详细运费规则</a>。";}else{hasDetail=false;desc="自营生鲜商品和自营非生鲜的运费分别计算，互不参与凑单免运费，实际运费以结算页为准，运费标准可查看<a href='//wqs.jd.com/my/cart/extraYunfeiRule.shtml?detail=1&ptag=7014.10.23' class='ship_info_lnk'>详细运费规则</a>。";}
var stand=[];if(extraYunfeiObj.zyCoudanObj.isNeedCoudan){yfStandard.zyStand.desc="";stand.push(yfStandard.zyStand);}else if(extraYunfeiObj.freshCoudanObj.isNeedCoudan){stand.push(yfStandard.freshStand);yfStandard.freshStand.desc="";}else{if(yfStandard.zyStand.weightArr.length){yfStandard.zyStand.desc="非生鲜";stand.push(yfStandard.zyStand);}
if(yfStandard.freshStand.weightArr.length){yfStandard.freshStand.desc="生鲜";stand.push(yfStandard.freshStand);}}
extraYfTip.find(".ship_info_inner").html(mFJ.formatJson($("#extraYfTipTpl").html(),{extraYunfeiArr:extraYunfeiObj.dataArr,hasDetail:hasDetail,stand:stand,addrname:dAddrName.text(),desc:desc}));extraYfTip.show().parent().addClass('show');});$("#extraYfTip").on('click','.btn_1',function(event){event.preventDefault();var extraYfTipDom=$(event.target).parents('#extraYfTip');extraYfTipDom.hide().parent().removeClass('show');});},shopNameFix:function(addrBarDom){var me=this,fixClass1="fixed_1",fixClass2="fixedJs_1",top=0,bottom=90;if(gbIsDeleteState){top=45;bottom=135;fixClass1="fixed",fixClass2="fixedJs";addrBarDom.addClass('fixed');}else{top=0;bottom=90;fixClass1="fixed_1",fixClass2="fixedJs_1";addrBarDom.removeClass('fixed');}
for(var key in me.shopViewList){var shop=me.shopViewList[key];var con=shop.$el.parents('.section').get(0).getBoundingClientRect();if(con.top<top&&con.bottom>bottom){shop.$el.find('.shopheadJs').attr('class','head shopheadJs '+fixClass1);shop.$el.next('.head_wrap').find('.head_notice').attr('class','head head_notice '+fixClass2);}else{shop.$el.find('.shopheadJs').attr('class','head shopheadJs');shop.$el.next('.head_wrap').find('.head_notice').attr('class','head head_notice');}}},bindListEvent:function(){var me=this,moreActDom=$("#moreAct");$("#samsTip").on('click','.btn_1',function(event){event.preventDefault();event.stopPropagation();$(this).parents('#samsTip').hide().parent('.mod_alert_mask').removeClass('show');});$('#addrNameTxt').on('click',function(){JD.report.rd('7014.17.1');mAttrCtrl.show();});$('#editBtn').on('click',function(){if($(this).find('span').html()=='编辑'){gbIsDeleteState=true;$('#selectbtn').addClass('disabled');Backbone.trigger('onChangeEditStyle',true);$(this).find('span').html('完成');}else{gbIsDeleteState=false;$('#selectbtn').removeClass('disabled');Backbone.trigger('onChangeEditStyle',false);$(this).find('span').html('编辑');}
$('#totalConfirmDiv').toggle();$('#operateDiv').toggle();});moreActDom.find('.mod_aside_v2_nav_btn').on('click',function(event){var $this=$(this);if(moreActDom.hasClass('unfold')){moreActDom.removeClass('anim');$this.html('<i>快速导航</i>');setTimeout(function(){moreActDom.removeClass('unfold');},300);}else{moreActDom.addClass('unfold').addClass('anim');$this.html('<i>收起</i>');}
JD.report.rd('7014.5.8');});JD.store.getItem("drugCartNum",function(key,value){if(value&&value!=0){JD.report.rd('7435.6.1');moreActDom.find('.mod_aside_v2_nav_btn').addClass('type_dot');moreActDom.find('.mod_aside_v2_nav_item').eq(6).addClass('type_dot');}});this.dList.on('click',function(e){var dSrc=e.target,sAttr=dSrc.getAttribute('attr-tag');if(!sAttr){while(dSrc!==this&&!sAttr){dSrc=dSrc.parentNode;sAttr=dSrc.getAttribute('attr-tag');}
if(!sAttr)return false;}
switch(sAttr){case"selectPromote":var promoteCont=$('#promoteCont'),sId=$(dSrc).attr("skuid"),dGroup=$(dSrc).parents('.cart_goods_group'),sSuitId=dGroup.attr('id')||'',sSuitType=dGroup.attr('attr-suit')||'';var cmdtyObj=oSCModel.getCmdtyObjById(sId,sSuitId,sSuitType),promotionData=cmdtyObj&&cmdtyObj.selectPromotion.filter(function(el){return el.ptype!='1'&&el.ptype!='4'&&el.pid!='-100'&&el.pid!='-300';});promoteCont.html(mFJ.formatJson(me.sPromoteTmpl,{data:promotionData})).show();setTimeout(function(){promoteCont.addClass('show');},100);$('[attr-tag="promoteLayer"]').off('click').on('click',function(eve){var pItem=$(eve.target).closest('[attr-tag="promoteItem"]');var packid=pItem.attr('attr-pid');if(pItem.length>0&&!pItem.hasClass('selected')){if(gbIsEditing===true)return true;gbIsEditing=true;me.showLoading();oSCModel.modifyCmdyPromo({commlist:oSCModel.serializeCommList(oSCModel.getCmdtyObjById(sId,sSuitId,sSuitType),{suitType:sSuitType,suitId:sSuitId,packid:packid,isModifyPromo:1}),type:0,locationid:gsAddrId},function(obj){gbIsEditing=false;if(obj.errId==='0'){me.renderList(obj,function(){var parDom=$("#"+packid);var targetDom=parDom.find('[attr-sku="'+sId+'"]');if(!targetDom.length){targetDom=parDom.find('[id="'+sId+'"]');}
if(targetDom.length){gdContainer.scrollTop(targetDom.offset().top-100);showNotice('已定位到所选促销活动');}else{getScrollTop();}
_scrCtrl&&_scrCtrl.watch&&_scrCtrl.watch();},{isgetyb:true});$('[attr-tag ="promoteLayer"]').remove();JD.report.rd('7014.17.3');}else{checkError(obj);}
promoteCont.removeClass('show');setTimeout(function(){promoteCont.hide();},100);});}else{$('[attr-tag ="promoteLayer"]').remove();promoteCont.removeClass('show');setTimeout(function(){promoteCont.hide();},100);}});break;case'jumpUrl':var attrhref=dSrc.getAttribute('attr-href');setScrollTop();location.href=attrhref;break;case'tocoudan':var attrhref=dSrc.getAttribute('attr-href');setScrollTop();JD.store.setItem('cart_coudan'+dSrc.getAttribute('batchId'),1,null,null,null,true);location.href=attrhref;break;case'jumpYunfei':JD.store.setItem('initindex','',null,null,null,true);var attrhref="//wqs.jd.com/my/cart/yunfeimoreitem.shtml?",isHasFbp=dSrc.getAttribute('isHasFbp')*1,linkParam={},freshSkus=[],zySkus=[],fr=-1,zyC=extraYunfeiObj.zyCoudanObj.isNeedCoudan,freshC=extraYunfeiObj.freshCoudanObj.isNeedCoudan,isFreshPro=0;me.shopViewList['8888'].shopItemList.forEach(function(item){if(item.normalState){isFreshPro=item.$el.find('[attr-tag="freshPro"]').length;if(freshC&&isFreshPro){freshSkus.push(item.sid);}else if(!isFreshPro){zySkus.push(item.sid);}}});if(zyC){fr=0;linkParam.zyCoudanObj=extraYunfeiObj.zyCoudanObj;JD.report.rd('7014.2.28');$('[attr-fbpVender]').each(function(index,item){var shopId=$(item).attr('attr-fbpVender');if(shopId&&shopId!='8888'){me.shopViewList[shopId].shopItemList.forEach(function(it){if(it.normalState){zySkus.push(it.sid);}});}});attrhref+=("&zySkus="+zySkus.join(','));}
if(freshC){if(fr==-1){JD.report.rd('7014.10.25');fr=1;}
linkParam.freshCoudanObj=extraYunfeiObj.freshCoudanObj;attrhref+=("&freshSkus="+freshSkus.join(','));}
linkParam.yfStandard=yfStandard;setScrollTop();JD.store.setItem('yunfeiLinkParam',JSON.stringify(linkParam),1440,null,null,true);isHasFbp*1?JD.report.rd('7014.10.5'):JD.report.rd('7014.10.7');oSCModel.getYunFeiMoreItemCount({skus:(fr==0?zySkus.join(','):freshSkus.join(',')),fr:fr},function(d){if(d.data&&d.data.length>5){location.href=attrhref;}else{var obj={errMsg:'无可凑单商品'};checkError(obj);}});break;case'jumpCoupon':var attrhref=dSrc.getAttribute('attr-href');setScrollTop();location.href=attrhref;break;case'jumpShop':case'jumpEvent':var attrhref=dSrc.getAttribute('attr-href');wa&&wa('jdClick',{ptag:attrhref.indexOf('add_buy')!=-1?'7014.19.2':'7014.4.3',nextPageReport:true});setScrollTop();location.href=attrhref;break;case'giftpool':var item=$(dSrc).parents('[attr-goodwapper]').find('[attr-tag="checkItem"]').get(0),sId=item.id,dGroup=$(item).parents('.cart_goods_group'),sSuitId=dGroup.attr('id')||'',sSuitType=dGroup.attr('attr-suit')||'';setScrollTop();location.href='#wg.jdgiftpool=show&pid='+sSuitId+'&gsskuid='+sId;break;case'samInfo':$("#samsTip").removeClass('goods_msg_update');$("#samsTip").html('<p>山姆会员价说明</p><p>山姆会员店是沃尔玛旗下的高端会员制商店，将山姆会员卡与京东账号绑定后，即可在山姆会员商店官方旗舰店享受会员价购买商品</p><p class="btns"><a href="javascript:;" class="btn btn_1">知道了</a></p>').show().parent().addClass('show');break;case'cl_gift':var attrhref=dSrc.getAttribute('data-href');setScrollTop();location.href=attrhref;break;}});$('#selectbtn').on('click',function(){if(gbIsDeleteState)return;$('#listSelect').show().find('li').removeClass('selected').filter('[data-value="'+$('#selectbtn').attr('attr_value')+'"]').addClass('selected');});$('#listSelect').off().on('click',function(e){var tempTarget=$(e.target).closest('[data-value]');function changeSele(itemList,suitIdList,sSuitTypeArray,ids,unc_itemList,unc_suitIdList,unc_sSuitTypeArray,unc_ids){if(ids.length==0&&unc_ids.length==0){me.refleshItemView({isGetCacheCoupon:true});}
if(ids.length==0||unc_ids.length==0){_scrCtrl&&_scrCtrl.watch&&_scrCtrl.watch();}
gbIsEditing=true;setScrollTop(0);me.showLoading();(function(){var deferred=Q.defer();if(itemList.length==0){deferred.resolve();return deferred.promise;}
oSCModel.checkCmdty({commlist:oSCModel.serializeCommList(itemList,suitIdList),type:0,locationid:gsAddrId},function(obj,sCommList){if(obj.errId==='0'){$('.shopcart_empty').hide();me.refleshSuit(oSCModel.updateData(obj,sCommList),sSuitTypeArray,obj.cart);}else{checkError(obj);}
getScrollTop();deferred.resolve();});return deferred.promise;}()).then(function(){var deferred=Q.defer();if(unc_itemList.length==0){deferred.resolve();return deferred.promise;}
oSCModel.uncheckCmdty({commlist:oSCModel.serializeCommList(unc_itemList,unc_suitIdList),type:0,locationid:gsAddrId},function(obj,sCommList){if(obj.errId==='0'){$('.shopcart_empty').hide();me.refleshSuit(oSCModel.updateData(obj,sCommList),unc_sSuitTypeArray,obj.cart);}else{checkError(obj);}
getScrollTop();deferred.resolve();});return deferred.promise;}).then(function(){gbIsEditing=false;oDialog&&oDialog.close();}).fail(function(){gbIsEditing=false;oDialog&&oDialog.close();});}
if(tempTarget.length>0){var selectValue=tempTarget.attr('data-value');$('#selectbtn .wrapper li').html(tempTarget.first().text());$('#selectbtn').attr('attr_value',selectValue);setScrollTop(0);if(!tempTarget.hasClass('selected')){JD.report.rd('7014.17.2');}
if(selectValue==='0'){me.refleshItemView({isGetCacheCoupon:true});$('#listSelect').hide();}else if(selectValue==='1'){$('#jiangjiatip').remove();var suitIdList=[],itemList=[],sSuitTypeArray=[],ids=[];var unc_suitIdList=[],unc_itemList=[],unc_sSuitTypeArray=[],unc_ids=[];$('[attr-tag="checkItem"]').each(function(index,item){var sId=item.id,dGroup=$(item).closest('.cart_goods_group'),sSuitId=dGroup.attr('id')||'',sSuitType=dGroup.attr('attr-suit')||'';if(!($(item).hasClass('jiangjia')||$(item).find('.jiangjia').length>0)&&($(item).hasClass("selected"))){unc_sSuitTypeArray.push(sSuitType);unc_itemList.push(oSCModel.getCmdtyObjById(sId,sSuitId,sSuitType));unc_suitIdList.push({suitId:sSuitId,suitType:sSuitType});unc_ids.push($(item).attr("id"));}else if(($(item).hasClass('jiangjia')||$(item).find('.jiangjia').length>0)&&!($(item).hasClass("selected"))){sSuitTypeArray.push(sSuitType);itemList.push(oSCModel.getCmdtyObjById(sId,sSuitId,sSuitType));suitIdList.push({suitId:sSuitId,suitType:sSuitType});ids.push($(item).attr("id"));}});if(ids&&ids.length>0){report.trace({gwc_jiangjia_select:ids.join('_')});}
changeSele(itemList,suitIdList,sSuitTypeArray,ids,unc_itemList,unc_suitIdList,unc_sSuitTypeArray,unc_ids);}else if(selectValue==='2'){var suitIdList=[],itemList=[],sSuitTypeArray=[],ids=[];var unc_suitIdList=[],unc_itemList=[],unc_sSuitTypeArray=[],unc_ids=[];$('[attr-tag="checkItem"]').each(function(index,item){var sId=item.id,dGroup=$(item).closest('.cart_goods_group'),sSuitId=dGroup.attr('id')||'',sSuitType=dGroup.attr('attr-suit')||'';if((sSuitType=='mf'||sSuitType=='mz')&&!$(item).hasClass("selected")){sSuitTypeArray.push(sSuitType);itemList.push(oSCModel.getCmdtyObjById(sId,sSuitId,sSuitType));suitIdList.push({suitId:sSuitId,suitType:sSuitType});ids.push(sId);}else if((sSuitType!='mf'&&sSuitType!='mz')&&$(item).hasClass("selected")){unc_sSuitTypeArray.push(sSuitType);unc_itemList.push(oSCModel.getCmdtyObjById(sId,sSuitId,sSuitType));unc_suitIdList.push({suitId:sSuitId,suitType:sSuitType});unc_ids.push(sId);}});if(ids&&ids.length>0){report.trace({gwc_mfmz_select:ids.join('_')});}
changeSele(itemList,suitIdList,sSuitTypeArray,ids,unc_itemList,unc_suitIdList,unc_sSuitTypeArray,unc_ids);}else if(selectValue==='3'){var suitIdList=[],itemList=[],sSuitTypeArray=[],ids=[];var unc_suitIdList=[],unc_itemList=[],unc_sSuitTypeArray=[],unc_ids=[];$('[attr-tag="checkItem"]').each(function(index,item){var sId=item.id,dGroup=$(item).closest('.cart_goods_group'),sSuitId=dGroup.attr('id')||'',sSuitType=dGroup.attr('attr-suit')||'';if(!($(item).hasClass('stockLimit')||$(item).find('.stockLimit').length>0)&&($(item).hasClass("selected"))){unc_sSuitTypeArray.push(sSuitType);unc_itemList.push(oSCModel.getCmdtyObjById(sId,sSuitId,sSuitType));unc_suitIdList.push({suitId:sSuitId,suitType:sSuitType});unc_ids.push($(item).attr("id"));}else if(($(item).hasClass('stockLimit')||$(item).find('.stockLimit').length>0)&&!($(item).hasClass("selected"))){sSuitTypeArray.push(sSuitType);itemList.push(oSCModel.getCmdtyObjById(sId,sSuitId,sSuitType));suitIdList.push({suitId:sSuitId,suitType:sSuitType});ids.push($(item).attr("id"));}});if(ids&&ids.length>0){report.trace({gwc_xique_select:ids.join('_')});}
changeSele(itemList,suitIdList,sSuitTypeArray,ids,unc_itemList,unc_suitIdList,unc_sSuitTypeArray,unc_ids);}else if(selectValue==='4'){var suitIdList=[],itemList=[],sSuitTypeArray=[],ids=[];var unc_suitIdList=[],unc_itemList=[],unc_sSuitTypeArray=[],unc_ids=[];$('[attr-tag="checkItem"]').each(function(index,item){var sId=item.id,dGroup=$(item).closest('.cart_goods_group'),sSuitId=dGroup.attr('id')||'',sSuitType=dGroup.attr('attr-suit')||'';var sCid=$(item).attr('attr-cid')||$(item).find('[attr-cid]').attr('attr-cid');if((shangChaoCategoryLevel2.indexOf(parseInt(sCid.split('_')[1]))<0)&&($(item).hasClass("selected"))){unc_sSuitTypeArray.push(sSuitType);unc_itemList.push(oSCModel.getCmdtyObjById(sId,sSuitId,sSuitType));unc_suitIdList.push({suitId:sSuitId,suitType:sSuitType});unc_ids.push($(item).attr("id"));}else if(!(shangChaoCategoryLevel2.indexOf(parseInt(sCid.split('_')[1]))<0)&&!($(item).hasClass("selected"))){sSuitTypeArray.push(sSuitType);itemList.push(oSCModel.getCmdtyObjById(sId,sSuitId,sSuitType));suitIdList.push({suitId:sSuitId,suitType:sSuitType});ids.push($(item).attr("id"));}});if(ids&&ids.length>0){report.trace({gwc_chaoshi_select:ids.join('_')});}
changeSele(itemList,suitIdList,sSuitTypeArray,ids,unc_itemList,unc_suitIdList,unc_sSuitTypeArray,unc_ids);}
$('#listSelect').hide();}else{$('#listSelect').hide();}});$('#checkAllBtn .icon_select').on('click',function(){var btn=$('#checkAllBtn').get(0);var todolist=me.getCollectionDate.getAllShowItem();if(todolist.length==0){return;}
if(gbIsDeleteState){var tempState=!me.oCheckGroup.isCheck(btn);todolist.forEach(function(item){item.setCheckState(tempState);});return;}
if(!gbIsEditing){gbIsEditing=true;setScrollTop(0);me.showLoading();var suitIdList=[],itemList=[],sSuitTypeArray=[],selectVal=$('#selectbtn').attr('attr_value');if(selectVal!=0){todolist.forEach(function(it){var item=it.el;var sId=item.id,dGroup=$(item).closest('.cart_goods_group'),sSuitId=dGroup.attr('id')||'',sSuitType=dGroup.attr('attr-suit')||'';sSuitTypeArray.push(sSuitType);itemList.push(oSCModel.getCmdtyObjById(sId,sSuitId,sSuitType));suitIdList.push({suitId:sSuitId,suitType:sSuitType});});}
if(!me.oCheckGroup.isCheck(btn)){oSCModel.checkCmdty({commlist:selectVal==0?"":oSCModel.serializeCommList(itemList,suitIdList),all:selectVal==0?"1":'0',type:0,locationid:gsAddrId},function(obj,sCommList){gbIsEditing=false;oDialog&&oDialog.close();if(obj.errId==='0'){btn.removeAttribute('attr-edit');if(selectVal==0){me.renderList(obj,null,{isgetyb:false});}else{me.refleshSuit(oSCModel.updateData(obj,sCommList),sSuitTypeArray,obj.cart);}}else{checkError(obj);}});}else{oSCModel.uncheckCmdty({commlist:selectVal==0?"":oSCModel.serializeCommList(itemList,suitIdList),all:selectVal==0?"1":'0',type:0,locationid:gsAddrId},function(obj,sCommList){gbIsEditing=false;oDialog&&oDialog.close();if(obj.errId==='0'){btn.removeAttribute('attr-edit');if(selectVal==0){me.renderList(obj,null,{isgetyb:false});}else{me.refleshSuit(oSCModel.updateData(obj,sCommList),sSuitTypeArray,obj.cart);}}else{checkError(obj);}});}}});$('#addFavor').on('click',function(){var arrItems=$('[attr-tag="checkItem"].selected');me.favorItem(arrItems);});$('#deleteBtn').on('click',function(){var arrItems=$('[attr-tag="checkItem"].selected');if(gbIsEditing)return;gbIsEditing=true;if(arrItems.length===0){dialog({msg:'请选择要删除的商品'});}else{me.deleteItem(arrItems);}});$('#sharePros').on('click',function(){var shareObj=me.getShareCont(true),code=shareObj.code;switch(code){case 0:dialog({msg:'请选择要分享的商品'});break;case 1:dialog({style:'confirm',confirmBtnTxt:'知道了',confirmBtnHtml:'<p class="btns">\
                    <a href="javascript:;" class="btn btn_1" attr-tag="ok">{#confirmBtnTxt#}</a>\
                </p>',msg:'商品不支持以套装的形式分享哦'});break;case 2:dialog({style:'confirm',confirmBtnTxt:'继续分享',cancelBtnTxt:'取消分享',msg:'商品不支持以套装的形式分享,是否剔除套装商品继续分享',onConfirm:function(){me.shareItem(shareObj);}});break;case 3:me.shareItem(shareObj);break;}});$('#shopCartConfirm').click(function(e){function checkNoPin(cb){if(window.locker&&window.locker.nojdaccount&&!window.isHasPin){oSCModel.loadList({locationid:gsAddrId,reg:1,isnewyb:1},cb);}else{cb();}}
JD.report.rd('7014.3.2');if($('div.selected').length>0){if(gbIsfirstEnter.jjTip){JD.report.rd('7014.23.7');}
if(gbIsfirstEnter.jjBgTip){JD.report.rd('7014.23.3');}
var globalNum=0,elseNum=0,globalMoney=0,elseMoney=0,otcNum=0,otcMoney=0;globalNum=$('#ddgloabal').attr('num');elseNum=$('#ddelse').attr('num');globalMoney=$('#ddgloabal').attr('money');elseMoney=$('#ddelse').attr('money');otcNum=$('#ddotc').attr('num');otcMoney=$('#ddotc').attr('money');var confirmUrl=isApp()?"//wqs.jd.com/order/jzyc.confirm.shtml":"//wqs.jd.com/order/wq.confirm.shtml";if(globalNum=='0'&&parseInt(elseNum)>0&&parseInt(otcNum)==0){report.trace({gwc_num:elseNum,gwc_money:elseMoney});checkNoPin(function(){location.href=confirmUrl+'?t='+(new Date().getTime())+'&wdref='+encodeURIComponent(location.href)+'#wechat_redirect';});}else if(elseNum=='0'&&parseInt(globalNum)>0&&parseInt(otcNum)==0){report.trace({gwc_num:globalNum,gwc_money:globalMoney});checkNoPin(function(){location.href=confirmUrl+'?global=1&t='+(new Date().getTime())+'&wdref='+encodeURIComponent(location.href)+'#wechat_redirect';});}else if(elseNum=='0'&&parseInt(otcNum)>0&&parseInt(globalNum)==0){report.trace({gwc_num:otcNum,gwc_money:otcMoney});checkNoPin(function(){location.href='//wqs.jd.com/order/s_confirm_otc.shtml?t='+(new Date().getTime())+'&wdref='+encodeURIComponent(location.href)+'#wechat_redirect';});}else{$('#confirmSelect dt').off().on('click',function(){$('#confirmSelect').hide();})
$('#confirmSelect').show().find('dd').off().on('click',function(e){if($(this).attr('tag')=='select'){$('#confirmSelect dd').removeClass('selected');$(this).addClass('selected');}else{if($(e.target).attr('tag')=='close'){$('#confirmSelect').hide();}
if($(e.target).attr('tag')=='resume'){if($('#ddotc').hasClass('selected')){report.trace({gwc_num:otcNum,gwc_money:otcMoney});checkNoPin(function(){$('#confirmSelect').hide();location.href='//wqs.jd.com/order/s_confirm_otc.shtml?otc=1&t='+(new Date().getTime())+'&wdref='+encodeURIComponent(location.href)+'#wechat_redirect';});}else if($('#ddgloabal').hasClass('selected')){report.trace({gwc_num:globalNum,gwc_money:globalMoney});checkNoPin(function(){$('#confirmSelect').hide();location.href=confirmUrl+'?global=1&t='+(new Date().getTime())+'&wdref='+encodeURIComponent(location.href)+'#wechat_redirect';});}else{report.trace({gwc_num:elseNum,gwc_money:elseMoney});checkNoPin(function(){$('#confirmSelect').hide();location.href=confirmUrl+'?t='+(new Date().getTime())+'&wdref='+encodeURIComponent(location.href)+'#wechat_redirect';});}}}});var clickflag='';var strray=[];if(parseInt(otcNum)>0){$('#ddotc').show();clickflag=clickflag.length>0?clickflag:'#ddotc';strray.push('京东大药房药品');}else{$('#ddotc').hide();}
if(parseInt(globalNum)>0){$('#ddgloabal').show();clickflag=clickflag.length>0?clickflag:'#ddgloabal';strray.push('京东全球购商品');}else{$('#ddgloabal').hide();}
if(parseInt(elseNum)>0){$('#ddelse').show();}else{$('#ddelse').hide();}
$('#confirmSelect dt').html('您选中的商品包含'+strray.join('、')+'<span>需要和其他商品分开结算！</span>');if(clickflag.length>0){$(clickflag).get(0).click();}}}else{}
e.preventDefault&&e.preventDefault();e.stopPropagation&&e.stopPropagation();return false;})},skuChangeCb:function(opt){var outVar=skuSwitch.outVar,outData=outVar.skuData[outVar.skuId],skuChangeCont=opt.dom,curSkuId=outVar.skuId;if(outVar.noSkuArea&&outVar.noSkuArea[curSkuId]==3){opt.isCnxhArea&&opt.onlyAddCart&&opt.onlyAddCart();return;}
var itemSkuInfo=outVar.item[curSkuId],skuSkuInfo=outVar.skuData[curSkuId],priceSkuInfo=outVar.price[curSkuId];if(!itemSkuInfo||!skuSkuInfo||!priceSkuInfo){opt.isCnxhArea&&opt.onlyAddCart&&opt.onlyAddCart();return;}
skuChangeCont.find(".avt").attr("src",'//img14.360buyimg.com/n1/'+itemSkuInfo.image[0]);skuChangeCont.find(".price").html('¥ <em>'+priceSkuInfo.p.split('.')[0]+'</em>.'+priceSkuInfo.p.split('.')[1]);skuChangeCont.find(".header .prop").eq(0).html(['<span>已选</span> ',outVar.skuChooseArr.join(', '),' ',outVar.buyNum,'个'].join(''));if(outData.stock&&outData.stock.weightValue&&outData.stock.weightValue!='0'&&outData.stock.weightValue.trim()!='不计重量'){skuChangeCont.find(".header .prop").eq(1).html('重量：'+(outData.stock.weightValue)+'/件');}else{skuChangeCont.find(".header .prop").eq(1).html('');}
var $btnWrap=skuChangeCont.find('.btnWrapJs'),addCartClass=skuSkuInfo.isCart?'':' disabled_1';if(skuSkuInfo.isCart||(stockCacheData[curSkuId]&&stockCacheData[curSkuId].a=='33'&&!outData.hasStock)){skuChangeCont.find('.time_left_tips').html('').hide();$btnWrap.attr("attr-tag","skuAddCart");$btnWrap.find('.btn.red').removeClass('disabled_1');}else{skuChangeCont.find('.time_left_tips').html(skuSkuInfo.cartTip).show();$btnWrap.removeAttr("attr-tag");$btnWrap.find('.btn.red').addClass('disabled_1');}
$btnWrap.attr(opt.iptObj);opt.dom.show();setTimeout(function(){opt.dom.addClass('show');},100);},skuSwitchReset:function(opt){var me=this;skuSwitch.resetOpt({skuCon:'skuAttrWrap',sku:opt.skuid,isDist:opt.iptObj.isDist||false,optionTpl:'<span class="choice" no="{#no#}" ptag="7014.2.23">{#name#}</span>',optionItem:'span.choice',selectedClass:'active',disabledClass:'over',skuTpl:'<div class="sku_kind">{#name#}</div><div class="sku_choose" id="sku{#no#}" >{#option#}</div>',cgiSource:'item',cb:function(){me.skuChangeCb(opt);},clickEvent:'click',buyNum:opt.buyNum||1,numInputSelector:opt.dom.find('#buyNum'),numMinusSelector:opt.dom.find('#minusNum'),numPlusSelector:opt.dom.find('#plusNum'),numMinusDisableCls:'disable',numPlusDisableCls:'disable',numChangeCB:function(){var outVar=skuSwitch.outVar;opt.dom.find(".header .prop").eq(0).html(['<span>已选</span> ',outVar.skuChooseArr.join(', '),' ',outVar.buyNum,'个'].join(''));},numChangeTipCB:function(tipStr){showNotice(tipStr);}});},bindSkuContSelect:function(){var me=this,dom=$("#skuChangeCont");dom.on('click','.close',function(event){dom.removeClass('show');setTimeout(function(){dom.hide();},100);});dom.on('click',"[attr-tag='skuAddCart']",function(event){var $this=$(this),presku=$this.attr('presku'),cursku=skuSwitch.outVar&&skuSwitch.outVar.skuId,curnum=$this.parent().find('input').val()||1,prenum=$this.attr('prevalue')||1,idDist=$this.attr('isdist')||'';if(skuSwitch.outVar&&!skuSwitch.outVar.jdSkuStatus){showNotice('请选择商品属性信息');return;}
dom.removeClass('show');setTimeout(function(){dom.hide();},100);if(cursku&&presku&&presku==cursku&&prenum==curnum){return;}else if(presku==cursku){me.showLoading();var dItem=$("#list").find('[attr-sku="'+cursku+'"]'),dGroup=dItem.parents('.cart_goods_group'),sSuitId=dGroup.attr('id'),sSuitType=dGroup.attr('attr-suit')||'';oSCModel.modifyCmdyNum({commlist:oSCModel.serializeCommList(oSCModel.getCmdtyObjById(cursku,sSuitId,sSuitType),{suitType:sSuitType,suitId:sSuitId,num:curnum}),type:0,locationid:gsAddrId,scene:0},function(obj,sCommList){oDialog&&oDialog.close();gbIsEditing=false;if(obj.errId==='0'){var oSuit=oSCModel.updateData(obj,sCommList)[0];me.refleshSuit(oSuit,sSuitType,obj.cart);report.trace({"ptag":"7014.2.24",gwc_sku_addcart:cursku});}else{checkError(obj);}});}else{gbIsEditing=true;me.showLoading();var type=0;if(skuSwitch.outVar&&skuSwitch.outVar["_"+cursku]&&skuSwitch.outVar["_"+cursku].item){type=skuSwitch.outVar["_"+cursku].item.spAttr&&skuSwitch.outVar["_"+cursku].item.spAttr.isXnzt=='1'?'3':'0';}
if(!presku){oSCModel.addCmdty({commlist:encodeURIComponent([cursku,'',curnum,cursku,'1','0','0','0'].join(',')),type:type,locationid:gsAddrId,reg:1},function(obj,sCommList){gbIsEditing=false;oDialog&&oDialog.close();if(obj.errId==='0'){showNotice('添加成功');JD.report.rd('7014.8.12');report.trace({"ptag":'7014.8.11',gwc_cnxiSku_addcart:cursku});me.renderList(obj,function(){if(recBackData.data[recBackData.arrIdx++]){var replHtml=mFJ.formatJson($('#recProReplace').html(),{oItem:recBackData.data[recBackData.arrIdx],p3PriceObj:p3PriceObj});$("#recommendList").find('li').eq(recBackData.repIndex).replaceWith(replHtml);}
$("#recommendList").find('li')[recBackData.repIndex].scrollIntoView();},{isgetyb:true,isGeyCop:true});}else{checkError(obj);}});}else{var dItem=$("#list").find('[attr-sku="'+presku+'"]'),dGroup=dItem.parents('.cart_goods_group'),sSuitId=dGroup.attr('id'),sSuitType=dGroup.attr('attr-suit')||'';var remComm=oSCModel.serializeCommList(oSCModel.getCmdtyObjById(presku,sSuitId,sSuitType),{suitType:sSuitType,suitId:sSuitId}),addComm=encodeURIComponent([cursku,'',curnum,cursku,'1','0','0','0','',idDist].join(','));oSCModel.replaceItem({commlist:remComm+'$'+addComm,type:type,locationid:gsAddrId,reg:1},function(obj,sCommList){gbIsEditing=false;oDialog&&oDialog.close();if(obj.errId==='0'){setScrollTop(0);me.renderList(obj,null,{isgetyb:true,isGeyCop:true});getScrollTop(0);report.trace({"ptag":"7014.2.24",gwc_sku_addcart:cursku});}else{checkError(obj);}});}}});},favorItem:function(arrItems,flag){var me=this;var ids=[],suitIdList=[],itemList=[];arrItems.forEach(function(item){var sId=item.id,dGroup=$(item).closest('.cart_goods_group'),sSuitId=dGroup.attr('id')||'',sSuitType=dGroup.attr('attr-suit')||'';ids.push(sId);itemList.push(oSCModel.getCmdtyObjById(sId,sSuitId,sSuitType));suitIdList.push({suitId:sSuitId,suitType:sSuitType});});if(arrItems.length===0){dialog({msg:'请选择要收藏的商品'});return;}
if(arrItems.length>=20){dialog({msg:'单次收藏不得多于20个商品'});return;}
dialog({msg:flag?'是否确认将此商品移至收藏？':'是否确认将已选中的'+itemList.length+'件商品移至收藏？',style:'confirm',onConfirm:function(){me.showLoading();setScrollTop();(function(){var deferred=Q.defer();oSCModel.addToFavor({commId:ids.join(',')},function(obj){if(obj.iRet=='0'){deferred.resolve();}else{deferred.reject();}});return deferred.promise;}()).then(function(){var deferred=Q.defer();oSCModel.removeCmdty({commlist:oSCModel.serializeCommList(itemList,suitIdList),type:0,locationid:gsAddrId},function(obj){gbIsEditing=false;oDialog&&oDialog.close();if(obj.errId==='0'){me.renderList(obj,null,{isgetyb:false});}else{if(obj.errId==='8994'){me.handleEmpty();}else{checkError(obj);}}
deferred.resolve();});return deferred.promise;}).then(function(){gbIsEditing=false;oDialog&&oDialog.close();}).fail(function(){gbIsEditing=false;oDialog&&oDialog.close();});if(flag){JD.report.rd('7014.2.14');}}});},deleteItem:function(arrItems,flag){var me=this;var suitIdList=[],itemList=[];arrItems.forEach(function(item){var sId=item.id,dGroup=$(item).closest('.cart_goods_group'),sSuitId=dGroup.attr('id')||'',sSuitType=dGroup.attr('attr-suit')||'';itemList.push(oSCModel.getCmdtyObjById(sId,sSuitId,sSuitType));suitIdList.push({suitId:sSuitId,suitType:sSuitType});});dialog({msg:flag?' 是否确认删除此商品？':' 是否确认将已选中的'+itemList.length+'件商品删除？',style:'confirm',onConfirm:function(){me.showLoading();setScrollTop();oSCModel.removeCmdty({commlist:oSCModel.serializeCommList(itemList,suitIdList),type:0,locationid:gsAddrId},function(obj){gbIsEditing=false;oDialog&&oDialog.close();if(obj.errId==='0'){me.renderList(obj,null,{isgetyb:false});}else{if(obj.errId==='8994'){me.handleEmpty();}else{checkError(obj);}}});if(flag){JD.report.rd('7014.2.16');}}});},getShareCont:function(){var arrItems=$('[attr-tag="checkItem"].selected'),skus=[],sSuitId=[],resultObj={};resultObj.imgUrl='//img11.360buyimg.com/jdphoto/s100x100_jfs/t3169/332/3803420642/5303/f66cb4eb/57f86abbNfa255630.png';resultObj.wx_nickname=(JD.cookie.get("wx_nickname")||JD.cookie.get("nickname")||"");if(arrItems.length===0){resultObj.code=0;}else{arrItems.forEach(function(item){if($(item).attr('attr-suit')!='suit'){skus.push($(item).attr('id'));sSuitId.push($(item).parents('.cart_goods_group').attr('id')||'');}});if(skus.length==0){resultObj.code=1;}else{if(arrItems.length-skus.length>0){resultObj.code=2;}else{resultObj.code=3;}}}
resultObj.skus=skus;if([0,1].indexOf(resultObj.code)!=-1){window.shareConfig={img_url:resultObj.imgUrl,link:'//wqs.jd.com/my/cart/jdshopcart.shtml',title:'京东正品保证，品质生活',desc:'京东正品保证，品质生活'};}else{var obj=oSCModel.getCmdtyObjById(skus[0],sSuitId[0]);resultObj.imgUrl='//img10.360buyimg.com/n4/'+obj.mainSku.image;if(skus.length==1){resultObj.shareTitle='好友推荐的精选好货';resultObj.shareDesc=obj.mainSku.name;}else{resultObj.shareTitle='好友推荐的购物清单';var cartShareItem=cartlock&&cartlock.filter(function(e){return e.lockname=="cartShareDesc"&&e.lockvalue=="1";})[0];if(cartShareItem&&new Date()>=new Date(cartShareItem.begintime)&&new Date()<=new Date(cartShareItem.endtime)){resultObj.shareDesc=cartShareItem.text;}else{resultObj.shareDesc='我推荐的购物车清单，京东正品保证，品质生活';}}
window.shareConfig={img_url:resultObj.imgUrl,link:'//wqs.jd.com/my/cart/cart_share.shtml?_wv=1&skus='+resultObj.skus.join(',')+'&wxname='+encodeURIComponent(resultObj.wx_nickname),title:resultObj.shareTitle,desc:resultObj.shareDesc,shareCallback:function(obj,result,res){if(result=="ok"){report.trace({ptag:'7014.15.2',share_sku_num:resultObj.skus.length});$('#shareLayer').hide();};}};}
return resultObj;},shareItem:function(shareObj){JD.report.rd('7014.15.1');if(JD.device.scene=='qq'){JD.sqapi.ready(function(){mqq.ui.shareMessage({title:shareObj.shareTitle,desc:shareObj.shareDesc,share_type:0,share_url:'http://wqs.jd.com/my/cart/cart_share.shtml?_wv=1&skus='+shareObj.skus.join(',')+'&wxname='+shareObj.wx_nickname,image_url:shareObj.imgUrl,back:true,puin:2712384158,sourceName:"京东购物"},function(result){if(result.retCode=='0'){report.trace({ptag:'7014.15.2',share_sku_num:shareObj.skus.length});}else{}});});}else{$('#shareLayer').show();$('#shareLayer').off('click').on('click',function(event){event.preventDefault();event.stopPropagation();$(this).hide();});}},dealMainData:function(cart){cart.venderCart.forEach(function(ele,idx){ele.products&&ele.products.length&&ele.products.forEach(function(item){item.proCate='products';});ele.suits&&ele.suits.length&&ele.suits.forEach(function(item){item.proCate='suits';if(item.ts=='0'){item.ts=new Date().getTime();}});ele.mfsuits&&ele.mfsuits.length&&ele.mfsuits.forEach(function(item){item.proCate='mfsuits';});ele.mzsuits&&ele.mzsuits.length&&ele.mzsuits.forEach(function(item){item.proCate='mzsuits';});ele.sortItemArr=ele.products.concat(ele.suits,ele.mfsuits,ele.mzsuits).sort(function(a,b){return b.ts*1-a.ts*1;});});},renderList:function(renderObj,callback,elseObj){var me=this;if(renderObj){oSCModel.updateData(renderObj);_render(renderObj);}else if(elseObj&&elseObj.isFirst){mShopcartModel.chuliData(window.firstCartData.data);_render(window.firstCartData.data);}else{me.showLoading();oSCModel.loadList({locationid:gsAddrId,reg:1,isnewyb:1},_render);}
function _render(obj){oDialog&&oDialog.close();oDialog=null;$('#wxloading').hide();if(obj.errId==='0'){var oCart=obj.cart,sCartHtml=[];window.allChecked=oCart.allChecked;if(oCart.venderCart.length==0){JD.report.rd('7014.12.3');me.handleEmpty();}else{$('#listContent').show();$('#emptyContent').hide();$('#mainViewFoot').show();$('.address_bar_wrap').show();me.dealMainData(obj.cart);var isFirst=elseObj&&elseObj.isFirst;oCart.venderCart.forEach(function(element){if(isFirst){me.createShop(element,isFirst);if(!window._PFM_TIMING[5]&&!gbIsCheckImg){window._PFM_TIMING[5]=new Date();}}else{sCartHtml.push(me.createShop(element));}});if(!isFirst){me.dList.html(sCartHtml.join(''));}
if(!gbIsCheckImg){oAddress.setAddrName(true);gbIsCheckImg=true;oAddress.init();}
if(!isFirst){me.refleshItemView({isGetCacheCoupon:!(elseObj&&elseObj.isGeyCop)});}else{oSCModel.updateData(obj);me.refleshItemView();}
if((elseObj&&elseObj.isgetyb)||!window.ybObj.platformInfos){oSCModel.getybitems({locationid:gsAddrId},function(json){if(json.errId=='0'){window.ybObj.platformInfos=[];if(json.platformInfos&&json.platformInfos.length>0){window.ybObj.platformInfos=json.platformInfos;oShopCart.showYb();}else{oShopCart.showYb(true);}
callback&&callback();if(isFirst){getScrollTop();}}});}else{oShopCart.showYb();}
if(gbIsfirstEnter&&gbIsfirstEnter.ckhdBaoguan){gbIsfirstEnter.ckhdBaoguan=false;var jumpEventNum=$('[attr-tag="jumpEvent"]').length;report.trace({ptag:'7014.2.39',gwc_jumpEvent_num:jumpEventNum});}
me.updateCartTotal(oCart);me.bindModNumVali(me.dList);me.getStock(oCart);me.getJiangJia();me.getShareCont();me.queryShopName();if(elseObj&&elseObj.isFirst){me.getBeanVerify();me.handleRecommend();me.handleRD();var quanItem=cartlock&&cartlock.filter(function(e){return e.lockname=="cartbarQuan"&&e.lockvalue=="1";})[0];if(quanItem){showPinBar(quanItem);}
getScrollTop();}}
me.oCheckGroup.reviewAllChecked();mShopcartModel.setCartCookie(obj);!(elseObj&&elseObj.isgetyb)&&callback&&callback();}else if(obj.errId==='8994'){me.handleEmpty();}else{checkError(obj);}
_scrCtrl.on(me.dList.find('img[init_src]'),function(obj){var imgUrl=this.getAttribute('init_src');if(imgUrl){this.src=imgUrl;this.removeAttribute('init_src');}});}},handleSamm:function(oCart){if(oCart.samSwitchSku&&oCart.samSwitchSku.length>0){var imgDatas=[],skuObj={};oCart.samSwitchSku.forEach(function(ele){$.extend(skuObj,ele);});for(var k in skuObj){samsImgObj['_'+k]&&imgDatas.push('//img10.360buyimg.com/n4/'+samsImgObj['_'+k]);}
if(imgDatas.length){$("#samsTip").addClass('goods_msg_update');$("#samsTip").html(mFJ.formatJson($("#samsTipTpl").html(),{data:imgDatas,elseObj:{'text1':'由于您地址的变更，已为您','text2':'切换为在该地区售卖的同款商品'}})).show().parent().addClass('show');}}},handleRecommend:function(isEmpty){var me=this,recDom='#myrecommend',limNum=50;if(JD.device.scene=='weixin'){p=isEmpty?'635012':'630003';ptag='7014.6.1';}else{p=isEmpty?'635013':'635016';ptag='7014.7.1';}
oSCModel.getFavor({p:p,lim:limNum,lid:gsAddrId.split('_')[0]||'1',location_info:setAddrId(true)},function(favorData){var data=favorData.data;if(!data||data.length==0)return;var filSkulist=cartlock&&cartlock.filter(function(e){return e.lockname=="favorSkulist"&&e.lockvalue=="1";})[0];if(filSkulist&&new Date()>=new Date(filSkulist.begintime)&&new Date()<=new Date(filSkulist.endtime)){data=data.filter(function(el){return filSkulist.text.indexOf(el.sku)==-1;});}
var flow=favorData.flow,oItem={},impr=favorData.impr,expid=getVParam('expid',impr),reqsig=getVParam('reqsig',impr),csku=getVParam('csku',impr),skus=getVParam('skus',impr);for(var i=0;i<data.length;i++){oItem=data[i];oItem.linkUrl=window.itemViewUrl+oItem.sku+'&exp='+expid+'&rec='+p+'&ptag='+ptag+'&scene=0';oItem.repURL=oItem.clk;if(window.isMixerCgi){oItem.repURL=(oItem.clk||oItem.clk_url);oItem.linkUrl+='&flow='+flow+'&sid='+oItem.sid+'&source='+oItem.source;}}
recBackData.data=data;data.showLen=data.length<24?data.length:24;$(recDom).html(mFJ.formatJson(me.srecommendViewTmpl,{data:data,isEmpty:isEmpty}));$(recDom).show();_scrCtrl.on($(recDom).find('img[init_src]'),function(obj){var imgUrl=this.getAttribute('init_src');if(imgUrl){this.src=imgUrl;this.removeAttribute('init_src');}});me.getP3Price(data);if(impr.indexOf('mercury')>-1){report.guessyoulikeReport({action:0,skus:skus,csku:csku,expid:expid,reqsig:reqsig,t:'rec.'+p});}
$(recDom).on('click','li a',function(e){if($(e.target).hasClass('buy')){return;}
var $em=$(this),repUrl=$em.data('repurl'),linkUrl=$em.data('href'),source=$em.attr('source');if(window.isMixerCgi){var val=JD.url.getUrlParam('flow',linkUrl)+'_'+JD.url.getUrlParam('source',linkUrl)+'_'+JD.url.getUrlParam('sid',linkUrl);JD.cookie.set('adinfo',val,30,'/','jd.com');}
if(source=='1'){window.sessionStorage&&window.sessionStorage.setItem('reportTJW',JSON.stringify({value:repUrl}));}else if(impr.indexOf('mercury')>-1){csku=JD.url.getUrlParam('sku',linkUrl);report.guessyoulikeReport({action:1,skus:skus,csku:csku,expid:expid,reqsig:reqsig,index:$em.index(),t:'rec.'+p});}
setTimeout(function(){setScrollTop();location.href=$em.data('href');},50);});function getVParam(name,url){var u=arguments[1]||window.location.search,reg=new RegExp(name+"=([^\$|&]*)"),r=u.substr(u.indexOf("\?")+1).match(reg);return r!=null?r[1]:"";}});$('#myrecommend').on('click','.buy',function(event){event.preventDefault();event.stopPropagation();var skuid=$(this).data('skuid'),iptObj={"prevalue":"1"};recBackData.repIndex=$(this).parents('li').index();recBackData.ptag=$(this).attr('ptag');oShopCart.skuSwitchReset({skuid:skuid,iptObj:iptObj,isCnxhArea:true,dom:$('#skuChangeCont'),onlyAddCart:function(){me.showLoading();oSCModel.addCmdty({commlist:encodeURIComponent([skuid,'','1',skuid,'1','0','0','0'].join(',')),type:0,locationid:gsAddrId,reg:1},function(obj,sCommList){gbIsEditing=false;oDialog&&oDialog.close();if(obj.errId==='0'){me.renderList(obj,function(){showNotice('添加成功');JD.report.rd('7014.8.12');if(recBackData.data[recBackData.arrIdx++]){var replHtml=mFJ.formatJson($('#recProReplace').html(),{oItem:recBackData.data[recBackData.arrIdx],p3PriceObj:p3PriceObj});$("#recommendList").find('li').eq(recBackData.repIndex).replaceWith(replHtml);}
$("#recommendList").find('li')[recBackData.repIndex].scrollIntoView();},{isgetyb:true});}else{checkError(obj);}});}});});},getP3Price:function(data){if(data.length==0){return;}
var skuids=[],areaids=gsAddrId.split('_');data.forEach(function(ele,idx){skuids.push(ele.sku);});skuImgPrice.getPriceBySkus({skus:skuids.join(","),source:"wxsqitemsou",callback:function(json){for(var i=0,len=json.length;i<len;i++){var item=json[i];p3PriceObj["_"+item.sku]=(item.price*1).toFixed(2);}
var aSet=$(".mod_recommend").find("a");aSet.forEach(function(a){var sku=$(a).attr('sku');if(p3PriceObj["_"+sku]!=null){var $aDom=$(a),costDom=$aDom.find(".price");costDom.html('¥ <em>'+p3PriceObj["_"+sku].split('.')[0]+'</em>.'+p3PriceObj["_"+sku].split('.')[1]);}});}});},handleRD:function(){$('[attr-tag="checkItem"] .icon_select').attr('PTAG','7014.2.1');$('[attr-tag="selectPromote"]').attr('PTAG','7014.2.6');$('[attr-tag="cmdtynum"]').attr('PTAG','7014.2.5');$('[attr-tag="cmdty"]').attr('PTAG','7014.2.2');$('[attr-tag="linkcontent"] .name').attr('PTAG','7014.2.4');$('[attr-tag="jumpShop"]').attr('PTAG','7014.4.1');$('[attr-tag="jumpCoupon"]').attr('PTAG','7014.4.2');$('#goTop').attr('PTAG','7014.5.1');$('[attr-tag="checkMain"] .icon_select').attr('PTAG','7014.3.1');$('#addFavor').attr('PTAG','7014.3.4');!window.symbols&&mLoad.loadScript({url:"//wq.360buyimg.com/fd/h5/base/gb/js/mod_aside_v2.min_001c4977.js",isToken:false});},handleEmpty:function(){var me=this;$('#emptyContent').show();$('#listContent').hide();$('#mainViewFoot').hide();$('.address_bar_wrap').hide();$(window).scrollTop(0);$('#normalEmpty').show();if(isMQQUserAgent()){$('#rego').attr("href","//wq.jd.com/mcoss/wxmall/home?ptype=4&ptag=37147.2.1");}else{$('#rego').attr("href","//wqs.jd.com/portal/wx/category_m.shtml?shownav=1&ptag=37147.1.1");}
if(!$("#recommendList li").length){me.handleRecommend(true);}!window.symbols&&mLoad.loadScript({url:"//wq.360buyimg.com/fd/h5/base/gb/js/mod_aside_v2.min_001c4977.js",isToken:false});},showYb:function(isEmpty){var statuMapMsg={'0':'延长保修','1':'意外保护','2':'只换不修','3':'远程服务','4':'上门服务','5':'双11','6':'原厂服务','7':'原厂服务','8':'屏碎保'},groupId=0,servicePriceArr={};function getIconByCode(code){var iconId=1;switch(code){case'FWBZ':iconId=4;break;case'YCBX':iconId=2;break;case'YWBH':iconId=3;break;case'ZHBX':iconId=1;break;case'CXTH':iconId=5;break;default:iconId=4;break;}
return iconId;}
function getHtml(tpl,itemArr,placeHolder){var html='',yBitemData=[],giftItemArr=[],selectNum=0,giftSer=0;itemArr.forEach(function(ele){ele.iconId=getIconByCode(ele.categoryCode);ele.platformConfigVOs.forEach(function(plat){if(plat.selected=='1'){selectNum++;plat.brandName=ele.brandName;yBitemData.push(plat);}});});if(placeHolder&&placeHolder.attr('attr-giftService')){giftSer++;var it=giftService.selected[itemArr[0].skuId];if(it&&it.id){giftSer++;giftItemArr.push(it);selectNum++;}
it.hasYbService=true;}
html=mFJ.formatJson(tpl.html(),{data:yBitemData,giftItemArr:giftItemArr,giftSer:giftSer,selectNum:selectNum});if(html){return'<div class="kind service_yb" giftser="'+giftSer+'" typeid="'+itemArr[0].typeId+'" event-tag="jdservice" skuid="'
+itemArr[0].skuId+'" suitid="'+itemArr[0].rSuitId+'" attr-tag="yb">'+html+'</div>';}
return html;}
function bindEvent(){$('#list [event-tag="jdservice"]').off('click').on('click',function(e){var $this=$(this),skuid=$this.attr('skuid'),giftSer=$this.attr('giftser'),typeid=$this.attr('typeid'),suitid=$this.attr('suitid');setScrollTop();location.hash='#wg.jdshopcart.v3=showyb&suitid='+suitid+'&skuid='+skuid+'&typeid='+typeid+'&giftser='+giftSer;e.stopPropagation();e.preventDefault();});}
function _render(obj){var i,l,item,cartItem,html,suitDom,giftDom;var tpl=$('#ybMainTmpl'),placeHolder,ybDeal={};if(!obj||!obj.platformInfos){return;}
$('.additional_area .service_yb').remove();obj.platformInfos.forEach(function(ele){if(!ybDeal['_'+ele.skuId+"_"+ele.rSuitId]){ybDeal['_'+ele.skuId+"_"+ele.rSuitId]=[];}
ybDeal['_'+ele.skuId+"_"+ele.rSuitId].push(ele);});for(var k in ybDeal){var itemArr=ybDeal[k];if(itemArr[0].rSuitId){suitDom=$('#'+itemArr[0].rSuitId);if(!suitDom.length){suitDom=$('[vpid="'+itemArr[0].rSuitId+'"]');if(!suitDom.length){continue;}}
if(suitDom.attr('attr-suit')=='suit'){cartItem=suitDom.find('[attr-sku="'+itemArr[0].skuId+'"]');}else{cartItem=suitDom.find('[id="'+itemArr[0].skuId+'"]');}}else{cartItem=$('#'+itemArr[0].skuId);}
if(cartItem.length==0){continue;}
cartItem=cartItem.eq(0);if(itemArr[0].rSuitId){itemArr[0].typeId=7;}else{itemArr[0].typeId=8;}
if(cartItem.next().hasClass('additional_area')){placeHolder=cartItem.next();html=getHtml(tpl,itemArr,placeHolder);placeHolder.append(html);}else{placeHolder=cartItem;html=getHtml(tpl,itemArr);placeHolder.after('<div class="additional_area">'+html+'</div>');}}
if(!isEmpty&&gbIsfirstEnter&&gbIsfirstEnter.service){gbIsfirstEnter.service=false;JD.report.rd('7014.2.32');}
for(var key in giftService.selected){var valObj=giftService.selected[key];if(!valObj.hasYbService){giftDom=$('#'+key);giftDom.next().find('.service_yb').html('');if(valObj.id){giftDom.next().append('<div class="kind service_yb" giftser="4" event-tag="jdservice" skuid="'+key+'" attr-tag="yb"><div class="name">服务</div><div class="stuff has_price clickable"><div class="des">[礼品购]礼品服务</div><div class="num">¥ '+parseFloat(valObj.promoPrice/100).toFixed(2)+'</div></div></div>');}else{giftDom.next().append('<div class="kind service_yb" giftser="3" event-tag="jdservice" skuid="'+key+'" attr-tag="yb"><div class="name">服务</div><div class="stuff has_price clickable"><div class="des">选择礼品包装服务</div></div></div>');}}}
bindEvent();}
_render(window.ybObj);window.getGiftCartPag=function(d){if(d.success&&d.result&&d.result.packing){giftService.giftSkuPag=d.result.packing;return;}};if(giftService.giftSkuPag){window.getGiftCartPag(giftService.giftSkuPag);}else{mLoad.loadScript('//cart-gift.jd.com/cart/app/getCartPacking.action?callback=getGiftCartPag');}},modGift:function(obj,oSuit,sOperType){if(sOperType==='none'){window.history.back();}else if(obj.errId==='0'){var sSuitId=oSuit.promotion.pid,dSuitDiv=$('#'+sSuitId);this.refleshSuit(oSuit,'mz',obj.cart);this.updateCartTotal(obj.cart);window.history.back();}else{checkError(obj);}},createCmdty:function(oData,isInsuit,isline){var me=this;oData.insuit=isInsuit;if(!isInsuit&&me.itemViewList[oData.mainSku.id]){me.itemViewList[oData.mainSku.id].isUpdateView=true;}
oData.isline=isline;var oProtype={'attachArr':[],'giftArr':[],'couponArr':[],selPromo:[],'score':0,'isHasGift':false,proLen:0};if(oData.gifts){for(var i=0;i<oData.gifts.skus.length;i++){var oGift=oData.gifts.skus[i];switch(oGift.type*1){case 1:oProtype.attachArr.push(oGift);break;case 2:case 3:case 4:if(oData.gifts.virtualSuit!='1'){oProtype.isHasGift=true;oProtype.giftArr.push(oGift);}
break;}}}
if(oData.donatedCouponList){oProtype.isHasGift=true;oProtype.couponArr=oData.donatedCouponList;}
if(oData.mainSku.score*1>0||(oData.mainSku.promotion&&oData.mainSku.promotion.score*1>0)){oProtype.isHasGift=true;oProtype.score=oData.mainSku.score*1>0?(oData.mainSku.score*1):(oData.mainSku.promotion.score*1);}
if(oData.selectPromotion&&!isInsuit){var filPromotion=oData.selectPromotion.filter(function(el){return el.ptype!='1'&&el.ptype!='4'&&el.pid!='-100'&&el.pid!='-300'});if(filPromotion.length>1){oProtype.isHasGift=true;oProtype.proLen=filPromotion.length;oProtype.selPromo=filPromotion.filter(function(el){return el.sstate=='1';});}}
if(oData.mainSku.isSupportCard*1&&!isInsuit){var id=oData.mainSku.id;if(oData.giftServiceSku){giftService.selected[id]=oData.giftServiceSku;}else{giftService.selected[id]={hasYbService:false};}}
oData.skuStr=mFJ.formatJson(this.sCmdtyTmpl,{data:oData,oProtype:oProtype});},createShop:function(shopData,isFirst){var sShopHtml=[],me=this,shopDiv;if(shopData.mfsuits.length>0&&shopData.mfsuits[0].multiPromo=="7"){shopData.popInfo.popType=popTypeConstant.is4Pro;}else if(shopData.mfsuits.length>0&&['1','8'].indexOf(shopData.mfsuits[0].multiPromo)!=-1){shopData.popInfo.popType=popTypeConstant.isMulPro;}else{shopData.popInfo.popType=popTypeConstant.isNormal;}
if(isFirst){me.dList.append(mFJ.formatJson(me.sPopShopTmpl,{oShop:shopData,isFirst:true}));shopDiv=$('#sp_'+(shopData.popInfo.vid.replace('-','')));}
for(var i=0,len=shopData.sortItemArr.length;i<len;i++){var item=shopData.sortItemArr[i];if(item.proCate=='products'){sShopHtml.push(this.createSingleCmdty(item));continue;}
if(item.proCate=='suits'){sShopHtml.push(this.createSuitCmdty(item));continue;}
if(item.proCate=='mfsuits'){sShopHtml.push(this.createMfSuitCmdty(item));continue;}
if(item.proCate=='mzsuits'){sShopHtml.push(this.createMzSuitCmdty(item));continue;}}
if(!isFirst){shopData.itemStr=sShopHtml.join('');return mFJ.formatJson(this.sPopShopTmpl,{oShop:shopData,isFirst:false});}else{shopDiv.append(sShopHtml.join(''));}},createSingleCmdty:function(sortItem){this.createCmdty(sortItem);return'<div class="item cart_goods">'+sortItem.skuStr+'</div>';},createSuitCmdty:function(sortItem,vSkuId,isline){var me=this,suitHtml='',suitNum=sortItem.num*1,pid=vSkuId||sortItem.promotion.pid;if(me.itemViewList[pid]){me.itemViewList[pid].isUpdateView=true;}
for(var j=0;j<sortItem.products.length;j++){this.createCmdty(sortItem.products[j],suitNum,isline);}
if(vSkuId&&sortItem.selectPromotion){var filPromotion=sortItem.selectPromotion.filter(function(el){return el.ptype!='1'&&el.ptype!='4'&&el.pid!='-100'&&el.pid!='-300'});if(filPromotion.length>1){sortItem.proLen=filPromotion.length;sortItem.selPromo=filPromotion.filter(function(el){return el.sstate=='1';});}}
suitHtml=mFJ.formatJson(this.sSuitTmpl,{data:{suit:sortItem,pid:pid,isline:isline,isVnzt:vSkuId?true:false}});return suitHtml;},createMfSuitCmdty:function(sortItem){var mfSuitHtml='',xnztSuitHtml="",oInfo=mPromote.getMfPromoteTitle(sortItem),pLen=sortItem.products&&sortItem.products.length,sLen=(sortItem.suits&&sortItem.suits.length)||0;for(var j=0;j<pLen;j++){this.createCmdty(sortItem.products[j],false,j==pLen+sLen-1);}
for(var j=0;j<sLen;j++){xnztSuitHtml+=this.createSuitCmdty(sortItem.suits[j],sortItem.suits[j].vSkuId,j==sLen-1);}
mfSuitHtml=mFJ.formatJson(this.sMfsuitTmpl,{data:{suit:sortItem,info:oInfo,xnztSuitHtml:xnztSuitHtml}});return mfSuitHtml;},createMzSuitCmdty:function(sortItem){var mzSuitHtml='',xnztSuitHtml='',oInfo={},pLen=sortItem.products&&sortItem.products.length,sLen=(sortItem.suits&&sortItem.suits.length)||0;if(sortItem.fullType=='24'){oInfo=mPromote.getMzchgProTitle(sortItem);}else{oInfo=mPromote.getMzPromoteTitle(sortItem);}
for(var j=0;j<pLen;j++){this.createCmdty(sortItem.products[j],false,j==pLen+sLen-1);}
for(var j=0;j<sLen;j++){xnztSuitHtml+=this.createSuitCmdty(sortItem.suits[j],sortItem.suits[j].vSkuId,j==sLen-1);}
mzSuitHtml=mFJ.formatJson(this.sMzsuitTmpl,{data:{suit:sortItem,info:oInfo,xnztSuitHtml:xnztSuitHtml}});return mzSuitHtml;},updateYunFeiEnt:function(isHasFbp,ptagIndex){var yunfeiDom=$('#8888').parent().find('[attr-tag="jumpYunfei"]'),ptagClickArr=['7014.10.9','7014.10.11','7014.10.13','7014.10.15','7014.10.17'],ptagPosArr=['7014.10.8','7014.10.10','7014.10.12','7014.10.14','7014.10.16'];yunfeiDom.attr({isHasFbp:isHasFbp,ptag:ptagClickArr[ptagIndex]}).show();JD.report.rd(ptagPosArr[ptagIndex]);if(isHasFbp){JD.report.rd('7014.10.4');}else{JD.report.rd('7014.10.6');}},updateCartTotal:function(oCart){var me=this,iTotalNum=oCart.chkMainSkuNum,igloabalPrice=0,iotcPrice=0,igloabalNum=oCart.global.chkMainSkuNum,iotcNum=oCart.otcdrug.chkMainSkuNum;if(oCart){igloabalPrice=oCart.global&&oCart.global.factPrice?parseInt(oCart.global.factPrice):0;iotcPrice=oCart.otcdrug&&oCart.otcdrug.factPrice?parseInt(oCart.otcdrug.factPrice):0;$('#txotc').html('京东大药房药品'+iotcNum+'件 共计：<em>¥ '+fmtMoney(iotcPrice)+'</em>').parent().attr('num',iotcNum).attr('money',iotcPrice);$('#txgloabal').html('京东全球购商品'+igloabalNum+'件 共计：<em>¥ '+fmtMoney(igloabalPrice)+'</em>').parent().attr('num',igloabalNum).attr('money',igloabalPrice);$('#txnormal').html('其他商品'+(iTotalNum-igloabalNum-iotcNum)+'件 共计：<em>¥ '+fmtMoney(parseInt(oCart.factPrice)-igloabalPrice-iotcPrice)+'</em>').parent().attr('num',iTotalNum-igloabalNum-iotcNum).attr('money',(parseInt(oCart.factPrice)-igloabalPrice-iotcPrice));this.dTotalNum.html("("+iTotalNum+"件)").attr('totalNum',iTotalNum);this.dTotalPrice.html('¥'+fmtMoney(parseInt(oCart.factPrice)));$('#totalBackMoney').html('¥'+fmtMoney(parseInt(oCart.cashBack)));}},getExtraWeight:function(oCart){var me=this,isHasFbp=0,isYfStop=false;oCart.venderCart.forEach(function(el){vid=el.popInfo.vid;if((vid=='8888'||el.popInfo.fbpVender*1)&&!window._isApp&&['603837','146426','663284','667688'].indexOf(vid)==-1){var idx=extraYunfeiObj.keyArr.indexOf(vid),bw=extraYunfeiObj.bigWeight[vid]?extraYunfeiObj.bigWeight[vid]:0,w=el.totalWeight-bw*1,p=el.price-el.discount-el.cashback-(el.ybprice||0);if(idx!=-1){var temp=extraYunfeiObj.dataArr.splice(idx,1,{vid:vid,vname:el.popInfo.vname,weight:w,price:p});extraYunfeiObj.totalWeight=extraYunfeiObj.totalWeight-temp[0].weight+w;extraYunfeiObj.priceAll=extraYunfeiObj.priceAll-temp[0].price+p;}else{extraYunfeiObj.keyArr.push(vid);extraYunfeiObj.dataArr.push({vid:vid,vname:el.popInfo.vname,weight:w,price:p});extraYunfeiObj.totalWeight=extraYunfeiObj.totalWeight+w;extraYunfeiObj.priceAll=extraYunfeiObj.priceAll+p;}
if(el.popInfo.vid=='8888'){extraYunfeiObj.freshInfo={hasFresh:el.hasFresh*1,freshTotalPrice:el.freshTotalPrice*1,freshTotalWeight:el.freshTotalWeight*1};}}});isHasFbp=extraYunfeiObj.dataArr.length>=2?1:0;if(oCart&&oCart.freightconfig.length){getYunFeiStand(oCart.freightconfig);}
if(yfStandard.isget){me.getYunfeiCoudanObj(isHasFbp,yfStandard);$(".head_notice").show();}else{$(".head_notice").hide();}},getYunfeiIndex:function(price,weight,yfStandSel){var weightArr=yfStandSel.weightArr,priceArr=yfStandSel.priceArr,wplen=weightArr.length,selYfIndex=0,isNeedCoudan=false,fullMoney=0,fullWeight=0,isFreeYunfei=false;if(weight>weightArr[wplen-1]){selYfIndex=-1;isNeedCoudan=false;fullMoney=priceArr[wplen-1];fullWeight=weightArr[wplen-1];return{selYfIndex:selYfIndex,isNeedCoudan:isNeedCoudan,isFreeYunfei:isFreeYunfei,price:price,weight:weight,fullMoney:fullMoney,fullWeight:fullWeight};}else if(weight<=weightArr[0]){selYfIndex=0;}else{for(var i=0;i<wplen-1;i++){if(weight>weightArr[i]&&weight<=weightArr[i+1]){selYfIndex=i+1;break;}}}
if(price<priceArr[selYfIndex]&&price!=0){isNeedCoudan=true;}else{if(price!=0){isFreeYunfei=true;}
isNeedCoudan=false;}
fullMoney=priceArr[selYfIndex];fullWeight=weightArr[selYfIndex];return{selYfIndex:selYfIndex,isNeedCoudan:isNeedCoudan,isFreeYunfei:isFreeYunfei,price:price,weight:weight,fullMoney:fullMoney,fullWeight:fullWeight};},getYunfeiCoudanObj:function(isHasFbp,yfStandard){var me=this,freshInfo=extraYunfeiObj.freshInfo,yfCoudanObj={};extraYunfeiObj.freshCoudanObj={};extraYunfeiObj.zyCoudanObj={};if(freshInfo.hasFresh&&freshInfo.freshTotalPrice){extraYunfeiObj.freshCoudanObj=me.getYunfeiIndex(freshInfo.freshTotalPrice,freshInfo.freshTotalWeight,yfStandard.freshStand);extraYunfeiObj.zyCoudanObj=me.getYunfeiIndex(extraYunfeiObj.priceAll-freshInfo.freshTotalPrice,extraYunfeiObj.totalWeight-freshInfo.freshTotalWeight,yfStandard.zyStand);}else{extraYunfeiObj.zyCoudanObj=me.getYunfeiIndex(extraYunfeiObj.priceAll,extraYunfeiObj.totalWeight,yfStandard.zyStand);}
var freshCoudanObj=extraYunfeiObj.freshCoudanObj,zyCoudanObj=extraYunfeiObj.zyCoudanObj;extraYunfeiObj.keyArr.forEach(function(shopid){var sectionDom=$('#'+shopid).parent();if(shopid=='8888'){if(freshCoudanObj.selYfIndex==-1||zyCoudanObj.selYfIndex==-1){JD.report.rd('7014.10.18');if(freshCoudanObj.selYfIndex!=-1||zyCoudanObj.selYfIndex!=-1){yfCoudanObj.preDesc=freshCoudanObj.selYfIndex==-1?'生鲜':'非生鲜';}else{yfCoudanObj.preDesc="";}
yfCoudanObj.selYfIndex=-1;}else if(zyCoudanObj.isNeedCoudan){JD.report.rd('7014.2.27');yfCoudanObj=zyCoudanObj;yfCoudanObj.preDesc="非生鲜";}else if(freshCoudanObj.isNeedCoudan){JD.report.rd('7014.10.24');yfCoudanObj=freshCoudanObj;yfCoudanObj.preDesc="生鲜";}else if(freshCoudanObj.isFreeYunfei||zyCoudanObj.isFreeYunfei){if(!freshCoudanObj.isFreeYunfei||!zyCoudanObj.isFreeYunfei){yfCoudanObj=freshCoudanObj.isFreeYunfei?freshCoudanObj:zyCoudanObj;yfCoudanObj.preDesc=freshCoudanObj.isFreeYunfei?'生鲜':'非生鲜';}else{yfCoudanObj.preDesc="已免运费";}}else{yfCoudanObj=zyCoudanObj;yfCoudanObj.preDesc="未勾选";}
me.updateYunfeiDesc(sectionDom,yfCoudanObj,true,isHasFbp);if(yfCoudanObj.isNeedCoudan){me.updateYunFeiEnt(isHasFbp,yfCoudanObj.selYfIndex);}else{sectionDom.find('[attr-tag="jumpYunfei"]').hide();}}else{me.updateYunfeiDesc(sectionDom,zyCoudanObj,false,isHasFbp);}});},updateYunfeiDesc:function(dom,coudanObj,isZiying,isHasFbp){var desc="",iconDesc="",tempDesc="",descDom=dom.find('.head_notice .title');var fullMoney=coudanObj.fullMoney,fullWeight=coudanObj.fullWeight;if(!isZiying){var freshDesc=extraYunfeiObj.freshInfo.hasFresh?'非生鲜':'';if(coudanObj.selYfIndex==-1){desc="店铺商品已超重，需支付续重运费，实际运费以结算为准";}else if(coudanObj.isNeedCoudan||coudanObj.price==0){desc="本店商品可与自营"+freshDesc+"商品同享满"+fullMoney/100+"元（"+fullWeight/1000+"kg以内）免运费";}else{desc="本店商品和自营"+freshDesc+"商品已享满"+fullMoney/100+"元（"+fullWeight/1000+"kg以内）免运费";}}else{tempDesc=extraYunfeiObj.freshInfo.hasFresh?coudanObj.preDesc:'';if(coudanObj.selYfIndex==-1){desc="店铺商品已超重，需支付续重运费，实际运费以结算为准";}else if(coudanObj.isNeedCoudan){desc=tempDesc+"商品满"+fullMoney/100+"元（"+fullWeight/1000+"kg内）免运费"+(Math.abs(coudanObj.weight)==0?"":"，已选"+tempDesc+"商品总重"+parseFloat(coudanObj.weight/1000).toFixed(3)+"kg，"+"还差"+parseFloat((fullMoney-coudanObj.price)/100).toFixed(2)+"元可免运费");}else if(coudanObj.preDesc=='未勾选'){desc=(extraYunfeiObj.freshInfo.hasFresh?'非生鲜':'')+"商品满"+fullMoney/100+"元（"+fullWeight/1000+"kg内）免运费";}else{if(coudanObj.preDesc=='已免运费'){desc="商品已免运费";}else{desc=tempDesc+"商品已免运费，已选"+tempDesc+"商品总重"+parseFloat(coudanObj.weight/1000).toFixed(3)+"kg";}}}
if(isHasFbp){JD.report.rd('7014.10.21');iconDesc='<i class="icon_notice notice2" ptag="7014.10.22" ></i>';}else{JD.report.rd('7014.10.19');iconDesc='<i class="icon_notice notice1" ptag="7014.10.20" ></i>';}
descDom.html(desc+iconDesc);},bindPlusMinus:function($dom,isPopSku){var me=this,disabledClass=isPopSku?'disable':'disabled';var click=function(e){var ipt=$(this).parent().find('input');var value=ipt.val()-0;var maxNum=ipt.attr('data-max')-0;var lowestBuy=ipt.attr('data-lowestBuy');var isPlus=$(this).hasClass('plus');if($(this).hasClass(disabledClass)){if(lowestBuy>=value&&!isPlus){showNotice('该商品'+lowestBuy+'件起售');}
return;}
$(this).attr('oldValue',value);if(isPlus){if(value>=maxNum){$(this).addClass(disabledClass);}
ipt.val(value+1);$(this).siblings('.minus').removeClass(disabledClass);}else{ipt.val(value-1);$(this).siblings('.plus').removeClass(disabledClass);if(value<=2){$(this).addClass(disabledClass);}}
me.iptModified(ipt[0],e,isPopSku);};$dom.find('span.plus').unbind('click').on('click',click).each(function(){var ipt=$(this).parent().find('input');var value=ipt.val()-0;var maxNum=ipt.attr('data-max')-0;if(value>=maxNum){$(this).addClass(disabledClass);}});$dom.find('span.minus').unbind('click').on('click',click).each(function(){var ipt=$(this).parent().find('input');var value=ipt.val()-0,lowestBuy=ipt.attr('data-lowestBuy');if(value<=1||(lowestBuy&&value<=lowestBuy)){$(this).addClass(disabledClass);}});},iptModified:function(ipt,event,isPopSku){var me=this,dCheckAllBtn=!isPopSku?$('#checkAllBtn'):'';var fn=function(e,isPop){var sCid=this.getAttribute('data-cid'),iMax=this.getAttribute('data-max')*1,iCur=this.value*1,sTitle=this.getAttribute('data-title')||'商品',iPreValue=this.getAttribute('data-prevalue')*1,iTemp=$(this).attr('oldValue')*1,lowestBuy=$(this).attr('data-lowestBuy'),oBtn=$(this);if(iCur<0||isNaN(iCur)){this.value=iTemp;iCur=iTemp;}
if(lowestBuy&&this.value*1<lowestBuy){iCur=lowestBuy*1;this.value=lowestBuy;}
if(iTemp!==iCur){if(iCur>iMax||iCur<1){var aDialog=dialog({style:'alert',msg:iCur<1?('单件'+sTitle+'数量不能少于1件'):('单件'+sTitle+'数量不能超过'+iMax+'件')});oBtn.val(iPreValue||1);setTimeout(function(){aDialog&&aDialog.close();},3000);}else{if(isPop){oBtn.attr('data-prevalue',iCur);oBtn.val(iCur);var proHeadDom=$(this).parents('#skuChangeCont').find(".header"),propCount=$(proHeadDom.find('.prop')[0]),propWeight=$(proHeadDom.find('.prop')[1]),propCountText=propCount.html()||"",propWeightText=propWeight.html()||"";propCount.html(propCountText.replace(/,\d+个/,' ,'+iCur+'个'));return;}
var dItem=oBtn.parents('div[attr-tag="checkItem"]'),dGroup=dItem.closest('.cart_goods_group'),sId=dItem.attr('id'),sSuitId=dGroup.attr('id'),sSuitType=dGroup.attr('attr-suit')||'';me.showLoading();oSCModel.modifyCmdyNum({commlist:oSCModel.serializeCommList(oSCModel.getCmdtyObjById(sId,sSuitId,sSuitType),{suitType:sSuitType,suitId:sSuitId,num:this.value}),type:0,locationid:gsAddrId,scene:0},function(obj,sCommList){oDialog&&oDialog.close();gbIsEditing=false;if(obj.errId==='0'){if(obj.errId!=='0'){oBtn.val(iPreValue||1);}else{var oSuit=oSCModel.updateData(obj,sCommList)[0];me.refleshSuit(oSuit,sSuitType,obj.cart);me.updateCartTotal(obj.cart);var oCmdtyData=oSCModel.getCmdtyObjById(sId,sSuitId,sSuitType);oBtn.attr('data-prevalue',oBtn.val());oBtn.val(oCmdtyData.num);}}else{checkError(obj);}});}}else{gbIsEditing=false;}!isPopSku&&dCheckAllBtn.show();}
fn.call(ipt,event,isPopSku);},bindModNumVali:function($dom,isPopSku){var me=this,dCheckAllBtn=$('#checkAllBtn');$dom.find('input').on('blur',function(e){e.stopPropagation();e.preventDefault();me.iptModified(this,e,isPopSku);}).on('focus',function(){if(!isPopSku){gbIsEditing=true;dCheckAllBtn.hide();}
$(this).attr('oldValue',this.value*1);}).on('keypress',function(e){var e=e||window.event,iKeyCode=e.keyCode;if(iKeyCode===13&&gbIsAndroid){$(this).blur();}});this.bindPlusMinus($dom,isPopSku);},refleshSuit:function(oSuit,sSuitType,oCart){var isCheckPid=0;var oSuitArr=[],sSuitTypeArr=[];if(!$.isArray(oSuit)){oSuitArr.push(oSuit);}else{oSuitArr=oSuit;}
if(!$.isArray(sSuitType)){sSuitTypeArr.push(sSuitType);}else{sSuitTypeArr=sSuitType;}
var me=this;var sUpdate;var dSuit;window.allChecked=oCart.allChecked;for(var i=0;i<oSuitArr.length;i++){switch(sSuitTypeArr[i]){case"mz":sUpdate=me.createMzSuitCmdty(oSuitArr[i]);break;case"mf":sUpdate=me.createMfSuitCmdty(oSuitArr[i]);break;case"suit":sUpdate=me.createSuitCmdty(oSuitArr[i]);break;default:sUpdate=me.createSingleCmdty(oSuitArr[i]);break;}
var pidNow=oSuitArr[i].promotion&&oSuitArr[i].promotion.pid;if(pidNow>0){if(oSuitArr[i].promotion.origPid&&oSuitArr[i].promotion.origPid!='0'&&oSuitArr[i].promotion.origPid!=pidNow){pidNow=oSuitArr[i].promotion.origPid;isCheckPid++;}else if(oSuitArr[i]&&oSuitArr[i].suits){isCheckPid++;}
dSuit=$("#"+pidNow);}else{dSuit=$("#"+oSuitArr[i].mainSku.id).parents('.cart_goods');}
dSuit.find("input").unbind();dSuit.replaceWith(sUpdate.split('init_src').join("src"));}
me.refleshItemView({isGetCacheCoupon:true});if(isCheckPid>0){oSCModel.getybitems({locationid:gsAddrId},function(json){if(json.errId=='0'){window.ybObj.platformInfos=[];if(json.platformInfos&&json.platformInfos.length>0){window.ybObj.platformInfos=json.platformInfos;oShopCart.showYb();}else{oShopCart.showYb(true);}}});}else{oShopCart.showYb();}
me.updateCartTotal(oCart);setTimeout(function(){for(var i=0;i<oSuitArr.length;i++){if(oSuitArr[i].promotion&&oSuitArr[i].promotion.pid>0){me.bindModNumVali($("#"+oSuitArr[i].promotion.pid));}else{me.bindModNumVali($("#"+oSuitArr[i].mainSku.id));}}},0);me.getStock(oCart,true);me.getJiangJia();me.getShareCont();me.queryShopName(true);_scrCtrl&&_scrCtrl.watch&&_scrCtrl.watch();},refleshShop:function(shop,oCart){var me=this;window.allChecked=oCart.allChecked;me.dealMainData(oCart);shop.find("input").unbind();shop.replaceWith(me.createShop(oCart.venderCart[0]).split('init_src').join("src"));me.refleshItemView();oShopCart.showYb();me.updateCartTotal(oCart);setTimeout(function(){me.bindModNumVali(shop);},0);me.getStock(oCart,true);me.getJiangJia();},queryShopName:function(isReflash){var vidArrFil=[],lsidArr=[],tempLsid;function updateShopName(){for(var k in window.shopNameData){if(k[0]=='l'){$('[attr-lsid="'+k.substr(2)+'"]').html(window.shopNameData[k]);}else{$('#'+k).find('.shopheadJs .title').html(window.shopNameData[k]);}}}
if(isReflash){updateShopName();return;}
window.popInfoData.forEach(function(ele){if(!window.shopNameData[ele.vid]&&ele.vid!="8888"&&ele.vid!="8899"&&ele.vid[0]!='-'){vidArrFil.push(ele.vid);}});$('.lsidJs').forEach(function(ele){tempLsid=$(ele).attr('attr-lsid');if(tempLsid&&!window.shopNameData['ls'+tempLsid]){lsidArr.push(tempLsid);}});if(!vidArrFil.length&&!lsidArr.length){updateShopName();}else{oSCModel.queryShopName(vidArrFil,lsidArr,updateShopName);}},getProperCoupon:function(data){var lesslist=data.filter(function(item){return item.quota<=item.total;});if(lesslist.length>0){var keyItem=lesslist.sort(function(a,b){if(parseInt(a.discount)<parseInt(b.discount)){return 1;}else if(parseInt(a.discount)==parseInt(b.discount)){return 0;}else{return-1;}})[0];return keyItem;}else{var keyItem=data.sort(function(a,b){if(parseInt(a.quota)<parseInt(b.quota)){return-1;}else if(parseInt(a.quota)==parseInt(b.quota)){if(parseInt(a.discount)<parseInt(b.discount)){return 1;}else if(parseInt(a.discount)==parseInt(b.discount)){return 0;}else{return-1;}}else{return 1;}})[0];return keyItem;}},queryShopCoupon:function(cb,isGetCatch){var me=this;var venderIDlist=[];var prama=[];$('[attr-tag="checkShop"]').forEach(function(item){var vidTemp=parseInt($(item).attr('id')),shopitem=[];if(vidTemp!=8899&&vidTemp>0){shopitem.push(vidTemp);$(item).parents('.section').find('[attr-sku]').forEach(function(skuitem){shopitem.push($(skuitem).attr('attr-sku')+'_'+$(skuitem).attr('attr-cid').split('_')[2]);});prama.push(shopitem.join(','));}});prama.length>0&&oSCModel.queryBatchShopCoupon({"commlist":prama.join('$'),"isGetCatch":isGetCatch},function(obj){window.shopCouponData={};var lingquanProm=[];obj.venderCart.filter(function(el){return!!me.shopViewList[el.vid];}).forEach(function(item){item.coupoVo.forEach(function(coupo){coupo.total=0;coupo.orgskuidlist=[].concat(coupo.skuidlist);for(var key in me.suitViewList){var suit=me.suitViewList[key];if(suit.suitTotalPrice>0&&suit.checkdSuitItemIds.every(function(skuid){return coupo.skuidlist.indexOf(parseInt(skuid))>=0;})){coupo.total=suit.suitTotalPrice+(coupo.total||0);suit.checkdSuitItemIds.forEach(function(skuid){coupo.orgskuidlist[coupo.orgskuidlist.indexOf(parseInt(skuid))]=0;});}};coupo.orgskuidlist.forEach(function(skuid){if(me.itemViewList[skuid+'']&&me.itemViewList[skuid+''].itemTotalPrice>0){coupo.total=me.itemViewList[skuid+''].itemTotalPrice+(coupo.total||0);}});});item.coupoVoleft=item.coupoVo.filter(function(coupit){var flag=false;for(var k=0;k<coupit.skuidlist.length;k++){if(me.shopViewList[item.vid]&&me.shopViewList[item.vid].shopItemList.filter(function(t){return t.sid==coupit.skuidlist[k]&&t.normalState;}).length>0){flag=true;}}
if(new Date()<new Date(parseInt(coupit.beginTime))){flag=false;}
return flag;});me.shopViewList[item.vid].$el.parents('.section').find('[attr_shopCoupon]').html('');if(item.coupoVoleft.length>0){var hasCoupon=item.coupoVoleft.filter(function(item){return item.couponDo==2;});if(hasCoupon.length>0&&!(item.vid=='8888'&&me.shopViewList['8888'].shopItemList.filter(function(el){return el.normalState;}).length==0)){var proCoup=me.getProperCoupon(hasCoupon);var jumpurl='';if(proCoup.couponKind==='0'){jumpurl='//wqs.jd.com/portal/wx/category_m.shtml?PTAG=37787.13.2&shownav=1';}else if(proCoup.couponKind==='1'){jumpurl='//wq.jd.com/search/searchco?coupon_batch='+proCoup.batchId+'&coupon_aggregation=yes&icart=1';}else{jumpurl='//wq.jd.com/search/searchco?coupon_batch='+proCoup.batchId+'&coupon_aggregation=yes&showShop=1&icart=1&ptag=1.1.1';}
if(proCoup.quota<=proCoup.total){if(!JD.report['7014.4.5']){JD.report['7014.4.5']=true;JD.report.rd('7014.4.5');}
JD.store.getItem('cart_coudan'+proCoup.batchId,function(key,value){if(value=='1'){JD.report.rd('7014.4.7');JD.store.setItem('cart_coudan'+proCoup.batchId,0,null,null,null,true);report.trace({cart_coudan_sucpin:JD.cookie.get('jdpin'),batchId:proCoup.batchId});}},null,true);me.shopViewList[item.vid].$el.parents('.section').find('[attr_shopCoupon]').html('<div class="foot" style="padding-top:0px;"><a href="javascript:;" style="padding-right: 0px;" class="go_merge"><span class="coupon">满'+parseInt(parseInt(proCoup.quota)/100)+'减'+parseInt(parseInt(proCoup.discount)/100)+'</span> 券可使用，在确认订单页可减 <span class="arial">¥ '+fmtMoney(parseInt(proCoup.discount))+'</span></a></div>');}else{if(!JD.report['7014.4.4']){JD.report['7014.4.4']=true;JD.report.rd('7014.4.4');}
me.shopViewList[item.vid].$el.parents('.section').find('[attr_shopCoupon]').html('<div class="foot" style="padding-top:0px;"><a attr-tag="tocoudan" ptag="7014.4.6" batchId="'+proCoup.batchId+'" attr-href="'+jumpurl+'" class="go_merge"><span class="coupon">满'+parseInt(parseInt(proCoup.quota)/100)+'减'+parseInt(parseInt(proCoup.discount)/100)+'</span>您还差 <span class="arial">¥ '+fmtMoney(parseInt(proCoup.quota)-parseInt(proCoup.total||0))+'</span>可用<span class="go">去凑单</span></a></div>');}}}else{me.shopViewList[item.vid].$el.parents('.section').find('[attr_shopCoupon]').html('');}
window.shopCouponData[item.vid]=item.coupoVo;item.coupoVo.length>0&&$('#'+item.vid).find(' [attr-tag="jumpCoupon"]').show();});cb&&cb();});},getJiangJia:function(){var param=[],jiaList=$('[attr-jiangjia-id]'),me=this;jiaList.forEach(function(item){param.push($(item).attr('attr-jiangjia-id')+'|'+$(item).attr('attr-jiangjia-price'));});oSCModel.getJiangJia({commlist:param.join(',')},function(obj){var jiangjiaItem=[];if(obj.skus&&obj.skus.length>0){obj.skus=obj.skus.filter(function(el){return parseInt(el.id)>0;})}
obj.skus&&obj.skus.length>0&&obj.skus.forEach(function(item){var jiangjiaDom=jiaList.filter('[attr-jiangjia-id="'+item.id+'"]');jiangjiaDom.html("已降价<br><span class='lower_value'>"+item.margin+"</span> ").show();var checkItemDom=jiangjiaDom.parents('[attr-tag="checkItem"]');checkItemDom.forEach(function(ele,idx){$(ele).addClass('jiangjia');var mId=$(ele).attr("id");jiangjiaItem.push(mId);});jiangjiaDom.parents('.goods').css('min-height','135px');});jiangjiaItem.length&&me.changeCollectionDate.changeItemState(jiangjiaItem,'onChangeJiangjia');if(obj.skus&&obj.skus.length>0&&!me.getJiangJia.close){huangtiao.pushTiao('jiangjia',function(){JD.report.rd('7014.23.1');gbIsfirstEnter.jjBgTip=true;$('#beanVerifyTip').hide();$('#linktoWanShan').hide();$('#jiangjiatip').show().find('p').html('购物车有'+obj.skus.length+'件降价商品<em class="right">点击查看</em>');$('#jiangjiatip .close').off().on('click',function(){$('#jiangjiatip').hide();huangtiao.popTiao('jiangjia');me.getJiangJia.close=true;return false;});$('#jiangjiatip').off().on('click',function(){JD.report.rd('7014.23.2');$('#jiangjiatip').hide();huangtiao.popTiao('jiangjia');me.getJiangJia.close=true;gbIsfirstEnter.jjTip=true;if($('#selectbtn .line').length==1&&$('#selectbtn .line').eq(0).html()!='降价商品'){$('#selectbtn .wrapper ul').append('<li class="line">降价商品</li>');setTimeout(function(){$('#selectbtn').addClass('next fade');setTimeout(function(){$('#selectbtn').removeClass('fade');$('#listSelect li').get(2).click();},400)},100);}});})}else{$('#jiangjiatip').hide();huangtiao.popTiao('jiangjia');}});},getStock:function(oCart,isGetCatch){var arrAddr=gsAddrId.split('_'),hasNostock=false,me=this;if(arrAddr.length<4){arrAddr.push('0');}
oSCModel.getStock({isGetCatch:isGetCatch||false,area:arrAddr.join(','),app:(isApp()?'jzyc':'wx_cart'),ch:isApp()?7:(JD.device.scene=='weixin'?4:5)},function(obj){if(obj){var unusableItem=[],noStockItem=[],limitStockItem=[];if(!isGetCatch){extraYunfeiObj={keyArr:[],dataArr:[],totalWeight:0,priceAll:0,bigWeight:{},freshInfo:{},freshCoudanObj:{},zyCoudanObj:{}};}
extraYunfeiObj.bigWeight={};for(var key in obj){stockCacheData[key]=obj[key];var stockDom=$('p[attr-stock="stock_'+key+'"]');if(!stockDom.length){var keyItem=$('div[attr-sku="'+key+'"]');keyItem.addClass('disabled');unusableItem.push(keyItem.attr('id'));}else{stockDom.forEach(function(ele){var $ele=$(ele);var lowestBuy=$ele.attr('attr-lowestBuy'),checkItem=$ele.parents('[attr-tag="checkItem"]');if(obj[key].a==='34'||(lowestBuy&&parseInt(obj[key].c)>0&&parseInt(obj[key].c)<lowestBuy)){noStockItem.push(checkItem.attr('id'));$ele.html('无货').show();$ele.siblings('.familiar').show();$ele.parents('.goods').addClass('disabled');checkItem.addClass('nostock').addClass('disabled').removeClass('stockLimit').removeClass('jiangjia');checkItem.find('.goods').css('min-height','125px');checkItem.find('.lower_price').hide();}else if(parseInt(obj[key].c)>0){limitStockItem.push(checkItem.attr('id'));$ele.html('仅剩'+obj[key].c+"件").show();checkItem.removeClass('nostock').removeClass('disabled').addClass('stockLimit');}else if(obj[key].a=='39'){$ele.html('采购中').show();}else{$ele.html('').hide();checkItem.removeClass('nostock').removeClass('disabled').removeClass('stockLimit');}
if([2,8,9,52].indexOf(obj[key].e*1)!=-1){var weightDom=checkItem.find('.weight'),isCheck=checkItem.hasClass('selected'),weight=weightDom.data('weight');weightDom.html('不计重量');if(isCheck&&weight*1){if(weightDom.length>1){var wItemSku="";weightDom.forEach(function(wItem){wItemSku=$(wItem).closest("[attr-sku]").attr("attr-sku");if(wItemSku==key){weight=$(wItem).data('weight');}});}
var vid=checkItem.parents('.section').attr('shopid'),num=checkItem.find('input.num').val();if(!extraYunfeiObj.bigWeight[vid]){extraYunfeiObj.bigWeight[vid]=weight*num;}else{extraYunfeiObj.bigWeight[vid]=extraYunfeiObj.bigWeight[vid]+weight*num;}}}});}}
me.getExtraWeight(oCart);unusableItem.length&&me.changeCollectionDate.changeItemState(unusableItem,'onChangeUnusable');noStockItem.length&&me.changeCollectionDate.changeItemState(noStockItem,'onChangeNoStock');limitStockItem.length&&me.changeCollectionDate.changeItemState(limitStockItem,'onChangeLimitStock');}});},getBeanVerify:function(){var me=this;oSCModel.getBeanVerify({},function(obj){if(!me.getBeanVerify.close&&obj.retcode=='0'&&obj.status=='2'){huangtiao.pushTiao('beanVerify',function(){$('#beanVerifyTip').show();$('#linktoWanShan').hide();$('#jiangjiatip').hide();$('#beanVerifyTip .close').off().on('click',function(){$('#beanVerifyTip').hide();huangtiao.popTiao('beanVerify');me.getBeanVerify.close=true;});$('#beanVerifyTip .right').off().on('click',function(){$('#beanVerifyTip').hide();me.getBeanVerify.close=true;var desc='',descAll='';if(obj.data.pinstatus=='1'){desc='去完善',descAll='您当前登录的账号信息不完善，请先完善账号，转移资产，并完成实名认证。';}else if(obj.data.pinstatus=='2'||obj.data.pinstatus=='4'){desc='去绑定',descAll='您当前登录的账号信息不完善，请先绑定账号，转移资产，并完成实名认证。';}else if(obj.data.pinstatus=='3'&&obj.data.defflag=='1'){desc='去切换',descAll='您当前登录的账号信息不完善，请先切换账号，转移资产，并完成实名认证。';}else{location.href='//wq.jd.com/vipplus/LoginBrigdeAuthNameAll?callback=shiming&scene='+(JD.device.scene=='weixin'?'weixin':'qq')+'&bussinessType=518&rurl='+encodeURIComponent(location.protocol+'//wqs.jd.com/my/cart/jdshopcart.shtml');return;}
dialog({style:'confirm',confirmBtnTxt:desc,cancelBtnTxt:'取消',msg:descAll,onConfirm:function(){location.href='//wq.jd.com/vipplus/LoginBrigdeAuthNameAll?callback=shiming&scene='+(JD.device.scene=='weixin'?'weixin':'qq')+'&bussinessType=518&rurl='+encodeURIComponent(location.protocol+'//wqs.jd.com/my/cart/jdshopcart.shtml');}});});})}else{$('#beanVerifyTip').hide();huangtiao.popTiao('beanVerify');}})},showLoading:function(){oDialog=dialog({msg:'数据正在提交中，请稍后',style:'loading'});}};window.IModGift=function(){oShopCart.modGift.apply(oShopCart,Array.prototype.slice.call(arguments,0));};window.IChangeGift=function(obj){oShopCart.renderList();history.back();}
window.IFleshCoupon=function(){oShopCart.queryShopCoupon.apply(oShopCart,Array.prototype.slice.call(arguments,0));};var oAddress={viewId:'address',init:function(){mAttrCtrl.init({onClose:function(){},onFinish:function(){window.gsAddrObj=mAttrCtrl.getAddrInfo(true);oAddress.setAddrName();oShopCart.renderList(null,function(){_scrCtrl&&_scrCtrl.watch&&_scrCtrl.watch();},{isgetyb:true});}});mAttrCtrl.getAddrInfo(true);},setAddrName:function(isOnlyName){var addrInfo=window.gsAddrObj,addrName='广东_深圳市_南山区_';if(addrInfo&&addrInfo.name&&addrInfo.name.indexOf('undefined')==-1){addrName=addrInfo.name;}
dAddrName.html('<em>'+((addrName.split('_')[1]||'')+(addrName.split('_')[2]||''))+'</em>');if(!isOnlyName){gsAddrId=setAddrId(false);}}};function showNotice(str,t){if(!str)return;t=t?t:2000;$('#noticeStr').html(str);$('#noticePanel').show();$('#noticePanel').css('margin-left','-'+($('#noticePanel').width())/2+'px');setTimeout(function(){$('#noticePanel').hide();},t);};function dialog(opt){var _opt=$.extend({tmpl:'<i class="{#icon#}"></i><p>{#msg#}</p>{#btnHtml#}',confirmBtnHtml:'<p class="btns">\
                 <a href="javascript:;" class="btn btn_1" attr-tag="ok">{#confirmBtnTxt#}</a>\
                 <a href="javascript:;" class="btn">{#cancelBtnTxt#}</a>\
             </p>',icon:'icon',style:'alert',msg:'',confirmBtnTxt:'确认',cancelBtnTxt:'取消',onBeforeConfirm:function(){},onBeforeCancel:function(){},onConfirm:function(){},onCancel:function(){}},opt),dFloat=document.getElementById('dialogConent'),dMask=document.getElementById('dialogMask'),sShowCls='show',me=this;if(_opt.style=='loading'){$('#wxloading').show();}else{if(!dFloat){dFloat=document.createElement('DIV');dFloat.id='dialogConent';document.body.appendChild(dFloat);}
dFloat.innerHTML=_opt.tmpl.replace('{#msg#}',_opt.msg).replace('{#icon#}',_opt.icon).replace('{#btnHtml#}',_opt.style==='confirm'?_opt.confirmBtnHtml:'').replace('{#confirmBtnTxt#}',_opt.confirmBtnTxt).replace('{#cancelBtnTxt#}',_opt.cancelBtnTxt);dFloat.className='mod_alert fixed show';if(!dMask){dMask=document.createElement('DIV');dMask.className='mod_alert_mask show';dMask.id='dialogMask';document.body.appendChild(dMask);}else{$(dMask).addClass(sShowCls);}
$([dFloat,_opt.style==='alert'?dMask:{}]).on('click',function(e){var dSrc=e.target;if(dSrc.getAttribute('attr-tag')==='ok'){var res=_opt.onBeforeConfirm&&_opt.onBeforeConfirm.call(me);if(res!==false){_close();_opt.onConfirm&&_opt.onConfirm.call(me);}}else{var res=(_opt.onBeforeCancel&&_opt.onBeforeCancel.call(me));if(res!==false){_close();_opt.onCancel&&_opt.onCancel.call(me);}}
e.preventDefault();e.stopPropagation();});}
function _close(){$(dFloat).unbind('click').remove();$(dMask).unbind('click').removeClass(sShowCls);$('#wxloading').hide();gbIsEditing=false;}
return{close:_close};}
window.dialog=dialog;function checkGroup(opt){var _opt=$.extend({sName:'',sActiveCls:'',sMainTag:'',sShopTag:'',onChecked:function(dObj){}},opt),arrItems=document.getElementsByName(_opt.sName),dMainItem;for(var i=0;i<arrItems.length;i++){if(arrItems[i].getAttribute('attr-tag')===_opt.sMainTag){dMainItem=arrItems[i];}}
function _isCheck(dCheckObj){return dCheckObj.className.indexOf(_opt.sActiveCls)>-1;}
function _isEnable(dCheckObj){return!dCheckObj.disabled;}
function _check(dCheckObj){if(!dCheckObj.disabled){$(dCheckObj).addClass(_opt.sActiveCls);}}
function _uncheck(dCheckObj){if(!dCheckObj.disabled){$(dCheckObj).removeClass(_opt.sActiveCls);}}
function _isShop(dCheckObj){return dCheckObj.getAttribute('attr-tag')===_opt.sShopTag;}
function _getShop(dCheckObj){return $(dCheckObj).parents('.section').find('[attr-tag="'+_opt.sShopTag+'"]').get(0);}
function _getShopGood(dCheckObj){return $(dCheckObj).parents('.section').find('[attr-tag="checkItem"]').get();}
this.check=function(item){_check(item.el);setTimeout(function(){if(item.getShopItem().getShowItem().length==item.getShopItem().getCheckItem().length&&item.getShopItem().getShowItem().length!=0){var shop=_getShop(item.el);_check(shop);}
if(oShopCart.getCollectionDate.getAllShowItem().length==oShopCart.getCollectionDate.getAllCheckItem().length!=0){_check(dMainItem);}
if(oShopCart.getCollectionDate.getAllShowItem().length==0){$('.shopcart_empty').show();}else{$('.shopcart_empty').hide();}
_opt.onChecked.call(this);},0);}
this.uncheck=function(item){_uncheck(item.el);setTimeout(function(){if(item.getShopItem().getShowItem().length!=item.getShopItem().getCheckItem().length||item.getShopItem().getShowItem().length==0){var shop=_getShop(item.el);_uncheck(shop);}
if(oShopCart.getCollectionDate.getAllShowItem().length!=oShopCart.getCollectionDate.getAllCheckItem().length||oShopCart.getCollectionDate.getAllShowItem().length==0){_uncheck(dMainItem);}
if(oShopCart.getCollectionDate.getAllShowItem().length==0){$('.shopcart_empty').show();}else{$('.shopcart_empty').hide();}
_opt.onChecked.call(this);},0);}
this.isCheck=_isCheck;this.selectChecked=function(){var arrRes=[];arrItems=document.getElementsByName(_opt.sName);for(var i=0;i<arrItems.length;i++){if(arrItems[i]!==dMainItem&&_isCheck(arrItems[i])&&_isEnable(arrItems[i])){arrRes.push(arrItems[i]);}}
return arrRes;}
this.reviewAllChecked=function(dObj){_opt.onChecked.call(this,dObj);}}
function isApp(){return(JD.cookie.get('cid')=='4')||/JZYC\/([\d\.]+)*/i.test(navigator.userAgent);}
function showPinBar(quanItem){var rurl=location.href,descHtml="",urlLink="";function handleUrl(tipurl){tipurl=tipurl.replace(/^http:/,"");tipurl=replaceParam('sceneid',JD.device.scene=='weixin'?5290155:5290155,tipurl,true);return tipurl;}
oSCModel.getPinStatus({rurl:encodeURIComponent(rurl),sceneid:'',callback:'pinStatusBarCB',source:(JD.device.scene=='weixin'?'2':'1')},function(json){if(json.errcode=='0'){if(json.state=='0'&&JD.url.getUrlParam('cartBind')=="1"){JD.store.getItem("shopcart_quan",function(key,value){if(!value){draw(quanItem,function(){});}},null,true);}else if(json.state=='1'||json.state=='2'){descHtml=(quanItem&&quanItem.text.split("|")[2])||"立即完善京东账号的手机号，有机会获得15元优惠券";urlLink=replaceParam('cartBind',"1",null,true);json.url=replaceParam('rurl',encodeURIComponent(urlLink),json.url,true);}else if(json.state=='3'&&json.defaultFlag=='1'){var jdpin=json.pinList.filter(function(el){return el.defaultFlag==0;})[0];descHtml="切换至京东账号"+(jdpin?jdpin.pin:'')+"进行购物，享受会员权益";}
if(descHtml){huangtiao.pushTiao('xinren',function(){$('#jiangjiatip').hide();$('#beanVerifyTip').hide();if(JD.device.scene=='weixin'){JD.report.rd('7434.1.5');}else{JD.report.rd('7434.2.5');}
$('#linktoWanShan').html(descHtml).on('click',function(){location.href=replaceParam('ptag',JD.device.scene=='weixin'?'7434.1.1':'7434.2.1',handleUrl(json.url));}).show();});}
if(json.state=='0'||(json.state=='3'&&json.defaultFlag=='0')){JD.store.getItem("cartShimingCoupon",function(key,value){if(value){var quanArr=value.split('|');if(quanArr[0]&&quanArr[1]){JD.store.setItem('cartShimingCoupon','',null,null,null,true);oSCModel.obtainShopCoupon(quanArr[0],quanArr[1],3,function(obj){if(obj.code==999){dialog({icon:'icon icon_success',style:'confirm',msg:'领券成功,优惠券将在1分钟内到账，请稍后前往个人中心查看~',confirmBtnTxt:'确认',onConfirm:function(){}});}});}}},null,true);}}});}
function checkError(obj){gbIsEditing=false;if(obj.errId==='13'){if(isApp()){WQAPI.user.login(function(){oShopCart.renderList();});}else{var sUrl=obj.nextUrl;if(sUrl.indexOf('sid=')>-1){location.href=sUrl.split('?')[0]+'?sid='+JD.cookie.get('sid')+'&rurl='+encodeURIComponent(location.href);}else{location.href=sUrl+encodeURIComponent(location.href);}}}else if(obj.errId==='44444'){oDialog=dialog({msg:'数据请求超时，您可以选择：',confirmBtnTxt:'刷新重试',cancelBtnTxt:'继续等待',style:'confirm',onConfirm:function(){location.reload();}});}else{var aDialog=dialog({style:'alert',msg:obj.errMsg});setTimeout(function(){aDialog&&aDialog.close();},3000);$("#skuChangeCont").removeClass('show');}}
function fmtMoney(sMoney){return(sMoney*1/100).toFixed(2);}
function draw(quanItem,callback){console.log('draw:');var activeId,level,ext=JD.device.scene=="weixin"?'hj:w':'hj:q';if(quanItem&&new Date()>=new Date(quanItem.begintime)&&new Date()<=new Date(quanItem.endtime)){activeId=quanItem.text.split("|")[0];level=quanItem.text.split("|")[1];}
if(!activeId||!level){return;}
if(!window.ActiveLotteryCallBack){window.ActiveLotteryCallBack=function(data){console.log('draw:ret',data.ret);JD.store.setItem('shopcart_quan','1',null,null,null,true);if(data.ret==0){dialog({style:'confirm',confirmBtnTxt:'知道了',confirmBtnHtml:'<p class="btns">\
                   <a href="javascript:;" class="btn btn_1" attr-tag="ok">{#confirmBtnTxt#}</a>\
               </p>',msg:'恭喜绑定成功，优惠券正飞奔到你的账户里哦，1分钟后可在个人中心查看~'});}else{dialog({style:'confirm',confirmBtnTxt:'知道了',confirmBtnHtml:'<p class="btns">\
                   <a href="javascript:;" class="btn btn_1" attr-tag="ok">{#confirmBtnTxt#}</a>\
               </p>',msg:'亲，抱歉优惠券已发放完毕~'});}
try{wa('shDeviceId',{type:1,activeInfo:{active:activeId,level:level}});}catch(e){};callback&&callback();}}
var promotejs=JD.cookie.get("promotejs");if(promotejs){mLoad.loadScript({url:"//wq.jd.com/active/active_draw?ext="+ext+'&active='+activeId+'&level='+level+'&t='+Math.random()});}else{window.GetFunction=function(res){if(res.errorCode==2){return _login.login();;}
if(res.errorCode==0){res.function(res.TOKEN);}
mLoad.loadScript({url:"//wq.jd.com/active/active_draw?ext="+ext+'&active='+activeId+'&level='+level+'&t='+Math.random()});};mLoad.loadScript({url:'//wq.jd.com/active/getfunction?t='+Math.random()});}}
function setScrollTop(top){JD.store.setItem('shopcart_stop',isNaN(top)?gdContainer.scrollTop():top,null,null,null,true);}
window.setScrollTop=setScrollTop;function getCookie(name){var reg=new RegExp("(^| )"+name+"(?:=([^;]*))?(;|$)"),val=document.cookie.match(reg);return val?(val[2]?unescape(val[2]).replace(/(^")|("$)/g,""):""):null;}
function getScrollTop(){JD.store.getItem("shopcart_stop",function(key,value){if(value||value==0){gdContainer.scrollTop(value*1);}},null,true);}
function isMQQUserAgent(){if(/qq\/([\d\.]+)*/i.test(navigator.userAgent)){return true;}
return false;}
function getYunFeiStand(freightconfig){var yfItem,configItem,temp;yfStandard={isget:false,zyStand:{weightArr:[],priceArr:[]},freshStand:{weightArr:[],priceArr:[]}};for(var i=0,len=freightconfig.length;i<len;i++){yfStandard.isget=true;yfItem=freightconfig[i];temp=yfItem.sequence==0?'zyStand':'freshStand';for(var j=1,cLen=yfItem.basefreightconfig.length;j<cLen;j++){configItem=yfItem.basefreightconfig[j];yfStandard[temp].weightArr.push(configItem.fWeight*1000);yfStandard[temp].priceArr.push(configItem.rangeSt*100);}}}
function relInfactInit(){var ct=cutDown(1000,'riskInterface',function(){window.isrisk=false;});window.cbRisk=function(d){ct&&ct.stop();if(d.retcode==0&&d.userType==1&&window.isrisk){location.href="//wqs.jd.com/my/risk.shtml?rurl="+encodeURIComponent(location.href)+"&riskObject="+encodeURIComponent(JSON.stringify(d));return;}};mLoad.loadScript({url:'//wq.jd.com/user/info/QueryDangerousUser?withCredentials=true&callback=cbRisk&t='+Math.random()});}
exports.showList=function(view){if(!window._PFM_TIMING[3]&&!gbIsCheckImg){window._PFM_TIMING[3]=new Date();}
document.title='购物车';$('#giftViewFoot').hide();$('#mainViewFoot').show();if(gbInit!==true||!view){view=$("#c_jdshopcart_showList");view.html($('#mainView').html());gdContainer=$(window);oSCModel=mShopcartModel.init();if(location.hash.indexOf('wg.jd')>=0){location.hash='';}
_scrCtrl=scrollCtrl.init();if(JD.url.getUrlParam('fromzhichu')==1){var umpMsg='直出主数据json错误;'+'wid'+JD.cookie.get('wq_uin')+";jdpin"+JD.cookie.get('jdpin')+";skey"+JD.cookie.get('wq_skey');JD.report.umpBiz({bizid:'15',operation:"7",result:"1",source:'0',message:umpMsg});}
var cartStopTimer=cutDown(10000,'cartFirstStop',function(){window.firstCartData.data.errId='44444';window.isStopFir=true;JD.report.umpBiz({bizid:'15',operation:'1',result:'3',source:'0',message:"购物车主接口超时错误"});});var cartFirstTimer=null;if(window.firstCartData.isLoaded){cartStopTimer&&cartStopTimer.stop();oShopCart.init();}else{cartFirstTimer=setInterval(function(){if(window.firstCartData.isLoaded||window.isStopFir){clearInterval(cartFirstTimer);cartStopTimer&&cartStopTimer.stop();oShopCart.init();}},50);}
relInfactInit();gbInit=true;}else{getScrollTop();}}
function checkServChg(oldArr,newArr){var i,l;oldArr.sort();newArr.sort();if(oldArr.length!=newArr.length){return true;}
for(i=0,l=oldArr.length;i<l;i++){if(oldArr[i]!=newArr[i]){return true;}}
return false;}
function ybBindEvent(){var newArrObj={arr:[],hasGift:false},oldArrObj={arr:[],hasGift:false},bigImg=$('#bigImg');$('#ybWrap li.selected').each(function(i){var $this=$(this),platId=$this.attr('platformId');if(platId){oldArrObj.arr.push(platId);}else{oldArrObj.hasGift=true;}});$('#ybWrap').unbind('click').on('click','li',function(e){var $this=$(this),$target=$(e.target),$parent=$this.parent();if($target.hasClass('btn')){var skuid=$target.attr('skuid');oSCModel.getGiftCart({skuid:skuid,cacheData:giftService.loaded},function(json){if(json.errcode=='0'&&json.result&&json.result.success){giftService.loaded[skuid]=json.result.mVo[skuid];$('#giftServiceCont').html(mFJ.formatJson($('#giftServiceTpl').html(),{skuid:skuid,data:(json.result.mVo&&json.result.mVo[skuid])?json.result.mVo[skuid]:{}})).show();setTimeout(function(){$('#giftServiceCont').addClass('show');},100);}});}else if($target.hasClass('giftImgJs')){var srcStr=$target.attr('src'),urls=[],srcBig=srcStr.replace('\/s50x50_jfs\/','\/s750x750_jfs\/');if(window.WeixinJSBridge){srcBig=(~srcBig.indexOf('http')?'':location.protocol)+srcBig;urls.push(srcBig,$target.siblings('.giftImgJs')[0].src.replace('\/s50x50_jfs\/','\/s750x750_jfs\/'));WeixinJSBridge.invoke('imagePreview',{'current':srcBig,'urls':urls});}else{var image=new Image();image.onload=function(){bigImg.find('img').attr('src',srcBig);bigImg.show();};image.src=srcBig;}}else if($this.hasClass('selected')){$this.removeClass('selected');}else{$parent.find('li').removeClass('selected');$this.addClass('selected');}});bigImg.on('click',function(event){bigImg.find('img').removeAttr('src');bigImg.hide();});$("#giftServiceCont").off('click').on('click',function(e){var $this=$(this),$target=$(e.target);if($target.hasClass('close')){$this.removeClass('show');setTimeout(function(){$this.hide();},100);}else if($target.hasClass('bg_2')){var skuid=$target.attr('skuid'),reg=/\ud83c[\udc00-\udfff]|\ud83d[\udc00-\udfff]|[\u2000-\u2fff]/g,receiveName=($('#toInput').val()||'').replace(reg,''),sendName=($('#fromInput').val()||'').replace(reg,''),content=($('#giftTextArea').val()||'').replace(reg,''),giftObj=giftService.loaded[skuid]||{};if(!content){showNotice('贺卡内容不能为空或者表情哦！');return;}else if(receiveName!=giftObj.receivename||sendName!=giftObj.sendname||content!=giftObj.content){oSCModel.saveGiftCart({skuid:skuid,receiver:receiveName,sender:sendName,content:encodeURIComponent(content)},function(json){if(json.errcode=='0'&&json.result&&json.result.success){giftService.loaded[skuid]=json.result.mVo[skuid];showNotice('保存贺卡成功！');$("#giftCartEdit").html('修改贺卡');}});}else{showNotice('保存贺卡成功！');$("#giftCartEdit").html('修改贺卡');}
$this.removeClass('show');setTimeout(function(){$this.hide();},100);}});function _getYbRender(obj){history.back();oShopCart.updateCartTotal(obj.cart);oSCModel.getybitems({locationid:gsAddrId},function(json){if(json.errId=='0'){window.ybObj.platformInfos=[];if(json.platformInfos&&json.platformInfos.length>0){window.ybObj.platformInfos=json.platformInfos;oShopCart.showYb();}else{oShopCart.showYb(true);getScrollTop();}}
oDialog&&oDialog.close();oDialog=null;});}
function _loadYbInterf(action,type,commlistArr,ybCommlist,cb){oShopCart.showLoading();var _commlist=commlistArr.join('$'),_ybcommlist=ybCommlist?ybCommlist.join('$'):'';oSCModel[action]({commlist:_commlist,locationid:window.gsAddrId,ybcommlist:_ybcommlist,type:type},function(obj){if(obj.errId=='0'){if(cb){cb(obj);}else{if(type==7){var skuid=commlistArr[0].split(',')[5];if(action.indexOf('rmv')!=-1){giftService.selected[skuid]={hasYbService:false};}else{giftService.selected[skuid]={id:skuid,promoPrice:((giftService.giftSkuPag&&giftService.giftSkuPag.price*100)||15),hasYbService:false};}}
_getYbRender(obj);}}else{history.back();checkError(obj);}});}
$('#ybConfirm').unbind('click').on('click',function(){var _commlist='',giftCommlist=[],commlistArr=[],platformIdArr=[],ybWrapLiDom=$('#ybWrap .ybTwoliJs'),action='setYB',actionGift='setYB';$('#ybWrap .ybTwoliJs.selected').each(function(i,el){var $this=$(this),platId=$this.attr('platformId'),typeid=$this.attr('typeid');platformIdArr.push(platId);if(platId){newArrObj.arr.push(platId);commlistArr.push([$this.attr('platformId'),'',$this.attr('platformNum'),$this.attr('skuId'),typeid,$this.attr('skuId'),(typeid=='7'?$this.attr('rSuitId'):''),'0'].join(','));}else{newArrObj.hasGift=true;giftCommlist.push([$this.attr('giftid'),'',1,$this.attr('giftid'),1,$this.attr('skuId'),'0','0'].join(','));}});var giftChg=oldArrObj.hasGift^newArrObj.hasGift,ybChg=checkServChg(oldArrObj.arr,newArrObj.arr);if(!giftChg&&!ybChg){history.back();return;}
if(ybChg&&!giftChg){if(commlistArr.length==0){var $li=ybWrapLiDom.eq(ybWrapLiDom.length-1),typeid=$li.attr('typeid');commlistArr.push([$li.attr('skuId'),'',0,$li.attr('skuId'),typeid,$li.attr('skuId'),(typeid=='7'?$li.attr('rSuitId'):''),'0'].join(','));action='rmvYB';}
_loadYbInterf(action,2,commlistArr);}else if(!ybChg&&giftChg){if(giftCommlist.length==0){var $li=ybWrapLiDom.eq(0);giftCommlist.push([$li.attr('giftid'),'',1,$li.attr('giftid'),1,$li.attr('skuId'),'0','0'].join(','));actionGift='rmvYB';}
_loadYbInterf(actionGift,7,giftCommlist);}else{if(newArrObj.hasGift&&commlistArr.length>0){actionGift='setYbGift';_loadYbInterf(actionGift,7,giftCommlist,commlistArr);}else{if(commlistArr.length==0){var $li=ybWrapLiDom.eq(ybWrapLiDom.length-1),typeid=$li.attr('typeid');commlistArr.push([$li.attr('skuId'),'',0,$li.attr('skuId'),typeid,$li.attr('skuId'),(typeid=='7'?$li.attr('rSuitId'):''),'0'].join(','));action='rmvYB';}
_loadYbInterf(action,2,commlistArr,'',function(obj){if(giftCommlist.length==0){var $li_0=ybWrapLiDom.eq(0);giftCommlist.push([$li_0.attr('giftid'),'',1,$li_0.attr('giftid'),1,$li_0.attr('skuId'),'0','0'].join(','));actionGift='rmvYB';}
_loadYbInterf(actionGift,7,giftCommlist,'');});}}});}
window.grayFunc=function(grayCate,ratio,ratioEnd){var vk=grayCate||"";var vkSp;if(vk){vk=vk+"";vkSp=vk.slice(vk.length-2);if(ratioEnd){return vkSp?(vkSp>=ratio*100&&vkSp<ratioEnd*100):(Math.random()>=ratio&&Math.random()<ratioEnd);}else{return vkSp?(vkSp<ratio*100):(Math.random()<ratio);}}else{if(ratioEnd){return Math.random()>=ratio&&Math.random()<ratioEnd;}else{return Math.random()<ratio;}}}
exports.showyb=function(view){if(window.ybObj&&window.ybObj.platformInfos){JD.report.rd('7014.2.7');html=mFJ.formatJson($('#ybTmplNew').html(),{data:window.ybObj,giftSer:JD.url.getHashParam('giftser'),giftPag:giftService.giftSkuPag||{},skuid:JD.url.getHashParam('skuid'),typeid:JD.url.getHashParam('typeid'),suitid:JD.url.getHashParam('suitid')||''});view.html(html);$('#mainViewFoot').hide();$(window).scrollTop(0);ybBindEvent();}else{location.hash='#';}}
function cutDown(time,tag,out){clearTimeout(cutDown[tag]);cutDown[tag]=setTimeout(function(){out&&out();},time);return{stop:function(){clearTimeout(cutDown[tag]);}}}
window.replaceParam=function(param,value,url,forceReplace){url=url||location.href.replace(location.hash,"");var reg=new RegExp("([\\?&]"+param+"=)[^&#]*");if(!url.match(reg)){return(url.indexOf("?")==-1)?(url+"?"+param+"="+value):(url+"&"+param+"="+value);}
if(forceReplace){return url.replace(reg,"$1"+value);}
return url;}});
